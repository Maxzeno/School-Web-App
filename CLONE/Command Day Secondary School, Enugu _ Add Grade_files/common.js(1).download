$(function () {
    $('[data-toggle="tooltip"]').tooltip()
});
Dropzone.autoDiscover = false;
$(document).ready(function() {
    input_changed = false;

    $('.timepicker').datetimepicker({

        format: 'hh:mm A'


    });
    $(document).on('click', '.view_password',function(){
        $('input[name="password"]').attr('type', 'text');
        $(this).find('i.fa-eye').removeClass('fa-eye');
        $(this).find('i').addClass('fa-eye-slash');

        $(this).addClass('hide_password');
        $(this).removeClass('view_password');
        $(this).attr('title', 'Hide password');
    });
    $(document).on('click', '.hide_password',function(){
        $('input[name="password"]').attr('type', 'password');
        $(this).find('i.fa-eye-slash').removeClass('fa-eye-slash');
        $(this).find('i').addClass('fa-eye');
        $(this).addClass('view_password');
        $(this).removeClass('hide_password');
        $(this).attr('title', 'Show password');
    });

    //Remove Error message
    $(document).on('click', '#role_title', function() {
        $(this).parent().find('.invalid-feedback strong').text('');


    });
    $(document).on('change', '#studentClassterm', function() {
        var TermId = $(this).val();
        sessionStorage.setItem("ofeetitleldtermId", TermId);
    });

    $(document).on('change', 'select#parentstudentsessionid', function() {

        $('.student-plan-data').hide();
        var session_id = $(this).val();
        var token = $('meta[name=csrf-token]').attr('content');
        $.ajax({
            type: 'POST',
            url: '/parent/sessionStudents',
            dataType: "json",
            data: { session_id: session_id, _token: token },
            success:function(res){

                if(res.studenthtml){
                    if($('#parentChildId').length > 0){
                        $('#parentChildId').html(res.studenthtml);
                        $("#parentChildId").selectpicker('refresh');
                    }else{
                        $('#parentstudentID').html(res.studenthtml);
                        $("#parentstudentID").selectpicker('refresh');
                    }


                }else{
                    if($('#parentChildId').length > 0){
                        $('#parentChildId').html('<option value="">Select Student</option>');
                        $("#parentChildId").selectpicker('refresh');
                    }else{
                        $('#parentstudentID').html('<option value="">Select Student</option>');
                        $("#parentstudentID").selectpicker('refresh');
                    }

                }
                if(res.termhtml){
                    if($('#parentClassterm').length > 0){
                        $('#parentClassterm').html(res.termhtml);
                        $('#parentClassterm').selectpicker('refresh');
                    }else{
                        $('#depositterm').html(res.termhtml);
                        $('#depositterm').selectpicker('refresh');
                    }


                }else{
                    if($('#parentClassterm').length > 0){
                        $('#parentClassterm').html('<option value="">Select Term</option>');
                        $("#parentClassterm").selectpicker('refresh');
                    }else{
                        $('#depositterm').html('<option value="">Select Term</option>');
                        $("#depositterm").selectpicker('refresh');
                    }

                }
            }
        });
    });
    
    // parent dashboard report checker session change event handler
    $(document).on('change', 'select#parentStudentDashboardSessionId', function() {
        window.location.href = '/parent/home?session_id=' + $(this).val();
    });

    // parent dashboard report checker set term and session values
    $(document).ready(function(){
        var session_id = $('#parentStudentDashboardSessionId').val();
        var term_id = $('#parentClassTerm').val();

        if (session_id != '' && term_id != '') {
            $('.sessionId').each(function(i, item) {
                $(item).val(session_id);
            });

            $('.termId').each(function(i, item) {
                $(item).val(term_id);
            });
        }
    });

    $(document).on('change', 'select.studentFeePlan', function() {
        var term_id = $(this).attr('data-session');
        var token = $('input[name="_token"]').val();
        var class_id = $('select[name="class_id"]').val();
        var plan_id = $(this).val();
        if(class_id != '' && term_id != '' && plan_id != ''){
            $.ajax({
                type: 'POST',
                url: '/admin/getPlans',
                dataType: "json",
                data: { class_id: class_id, term_id:term_id,plan_id:plan_id, _token: token },
                success:function(res){
                    if(res['html']){
                        $('.titles-'+term_id).show();


                        $('.titles-'+term_id).html(res['html']);
                    }
                }

            });
        }
    });

    $(document).on('change', 'select#parentstudentsessionid', function() {

        $('.student-plan-data').hide();
        var session_id = $(this).val();
        var token = $('meta[name=csrf-token]').attr('content');
        $.ajax({
            type: 'POST',
            url: '/parent/sessionStudents',
            dataType: "json",
            data: { session_id: session_id, _token: token },
            success:function(res){

                if(res.studenthtml){
                    if($('#parentChildId').length > 0){
                        $('#parentChildId').html(res.studenthtml);
                        $("#parentChildId").selectpicker('refresh');
                    }else{
                        $('#parentstudentID').html(res.studenthtml);
                        $("#parentstudentID").selectpicker('refresh');
                    }


                }else{
                    if($('#parentChildId').length > 0){
                        $('#parentChildId').html('<option value="">Select Student</option>');
                        $("#parentChildId").selectpicker('refresh');
                    }else{
                        $('#parentstudentID').html('<option value="">Select Student</option>');
                        $("#parentstudentID").selectpicker('refresh');
                    }

                }
                if(res.termhtml){
                    if($('#parentClassterm').length > 0){
                        $('#parentClassterm').html(res.termhtml);
                        $('#parentClassterm').selectpicker('refresh');
                    }else{
                        $('#depositterm').html(res.termhtml);
                        $('#depositterm').selectpicker('refresh');
                    }


                }else{
                    if($('#parentClassterm').length > 0){
                        $('#parentClassterm').html('<option value="">Select Term</option>');
                        $("#parentClassterm").selectpicker('refresh');
                    }else{
                        $('#depositterm').html('<option value="">Select Term</option>');
                        $("#depositterm").selectpicker('refresh');
                    }

                }
            }
        });
    });



    $(document).on('change', '.studentSessionterm, #schoolChildId, #parentstudentID, #term, .studentSessionterm', function() {
        $('.student-plan-data').hide();

        if($('#schoolChildId'). length > 0){

            var student_id = $('#schoolChildId').val();
            var TermId = $('#term').val();

            var type='admin';
        }else if($('.studentSessionterm'). length > 0){
            var student_id = $('#parentstudentID').val();
            var TermId = $('select.studentSessionterm').find('option:selected').val();
            var type='parent';
        }else if($('#gradeSessionId'). length > 0){
            var session_id = $('#gradeSessionId').val();
        }else{
            var student_id = $('#parentstudentID').val();
            var TermId = $(this).val();
            var type='parent';
        }
        var token = $('input[name="_token"]').val();

        if(TermId != '' && student_id != ''){
            $.ajax({
                type: 'POST',
                url: '/parent/getStudentPlan',
                dataType: "json",
                data: { student_id: student_id, term_id:TermId,_token: token,type:type },

                success:function(res){

                    if(res['html']){
                        $('.student-plan-data').show();
                        $('.student-plan-data').html(res['html']);
                        $('#total_fee').val(res['finalAmount']);
                        $('#total_amount').val(res['totalAmount']);
                        $('#paid_fee').val(res['totalAmount']);
                    }
                    if(res['status'] == 400){
                        $('button[type="submit"]').attr('disabled',true);
                    }else{
                        $('button[type="submit"]').removeAttr('disabled',true);

                    }
                }

            });
        }

    });
    $(document).on('change keyup keypress paste', '.amount-paid,.overall-score',function (event) {
        if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
            event.preventDefault();
        }
        var input = $(this).val();
        if ((input.indexOf('.') != -1) && (input.substring(input.indexOf('.')).length > 2)) {
            event.preventDefault();
        }
        if($('.overall-score').length > 0){

            var total =parseFloat($(this).attr('max'));
            var thisValue =parseFloat($(this).val());

            if( thisValue > total){
                $( this ).val('');
                $( this ).parent().find('div.with-errors').html('Please enter Grade less than overall score.');
                event.preventDefault();
            }else{
                $( this ).parent().find('div.with-errors').html('');
            }
        }
        if($('.amount-paid').length > 0){
            var total =parseFloat($(this).attr('max'));
            var thisValue =parseFloat($(this).val());
            var amount = 0;
            if( thisValue > total){
                $( this ).val('');
                $( this ).parent().find('div.with-errors').html('Please enter amount equal to fee due amount or less than.');
                event.preventDefault();
            }else{
                $( this ).parent().find('div.with-errors').html('');
            }
            $(".amount-paid").each(function() {
                var val = $(this).val();
                if(val != ''){
                    amount+=parseFloat(val);
                }
            });
            var charges = $('input[name="transaction_charges"]').val();
            $('#total_fee').val(amount+parseFloat(charges));
            $('#paid_fee').val(amount);
        }
    });
    var student_id = $('#parentstudentID').val();
    var token = $('input[name="_token"]').val();
    var TermId = sessionStorage.getItem("oldtermId");
    $('#oldtermId').val(TermId);
    if(student_id){
        $.ajax({
            type: 'POST',
            url: '/parent/studentTerms',
            dataType: "json",
            data: { student_id: student_id, _token: token },
            success:function(res){
                if(res){
                    var html='<option value="">Select Term</option>';
                    $.each(res,function(key,value){
                        html += '<option value="'+key+'">'+value+'</option>';
                    });
                    $('#studentClassterm').html(html);
                    $('#studentClassterm option[value="' + TermId +'"]').prop("selected", true);
                    $("#studentClassterm").selectpicker('refresh');
                }else{
                    $('#studentClassterm').html('<option value="">Select Term</option>');
                    $("#studentClassterm").selectpicker('refresh');

                }
            }
        });
    }else{
        $('#studentClassterm').html('<option value="">Select Term</option>');
        $('#studentClassterm').selectpicker('refresh');
    }
    setTimeout(function() {
        $('.alert').fadeOut('fast');
    }, 5000);
    function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;

        if (charCode > 31 && (charCode <= 46 || charCode > 57)) {
            return false;
        }
        return true;
    }

    $(document).on('click', '.dropify-clear', function() {
        var removeimage =$(this).parent().find('input').data('image');
        $('#'+removeimage).val('');
        if($(this).parent().find('input').hasClass('requiredme')){
            $(this).parent().find('input').attr('required',true);
        }
    });




    // append row table
    $(document).on('click', '.addCF', function() {

        var row = $('form #customFields').find('tr:eq(1)').clone(true);
        var row1 = row.removeClass('has-error');
        var row =  row.removeClass('has-danger');
        var selecthtml = $('#select-model').html();

        if(row.find('.teacherIds').length > 0){
            row.find('.teacherIds').empty();
            row.find('.teacherIds').html('<select class="selectpicker code teacherIds"  data-live-search="true" name="teachers[]" tabindex="-98"><option value="">select Teacher</option>'+selecthtml+'</select>');
        }
        if(row.find('.parentIds').length > 0){
            row.find('.parentIds').empty();
            row.find('.parentIds').html('<select class="selectpicker code parentIds"  data-live-search="true" name="parent_ids[]" tabindex="-98"><option value="">select Parent</option>'+selecthtml+'</select>');
        }
        if(row.find('.relation').length > 0){
            row.find('.relation').empty();
            row.find('.relation').html('<select class="selectpicker code relation" id="customFieldtwo" name="relation[]"><option value="">Relation with Child</option><option value="Parent">Parent</option><option value="Guardians">Guardians</option></select>');


        }

        var rowhtml = row.html();


        $("#customFields").append('<tr>'+rowhtml+'</tr>');
        $('.hidden_del').show();
        $('form #customFields').find('tr:last').find('td:last').html('');
        $('form #customFields').find('tr:last').find('td input').val('');
        $('form #customFields').find('tr:last .form-group').removeClass('has-error');
        $('form #customFields').find('tr:last .list-unstyled li').html('');

        $('form #customFields').find('tr:last').find('td option:selected').prop("selected", false);
        $('form #customFields').find('tr:last').find('td:last').html('<a href="javascript:void(0);" class="remCF common_btn del_row">Remove</a>');
        $('form #customFields').find('tr:last').find('.teacherIds').selectpicker('refresh');
        $('form #customFields').find('tr:last').find('.parentIds').selectpicker('refresh');
        $('form #customFields').find('tr:last').find('.relation').selectpicker('refresh');
    });


    $(document).on('click', '.addSessionTerms', function() {
        var clone = $('.term-row:last').clone(true);
        var name = clone.find('.terminput').attr("name");
        var split_name = name.split('_');
        var index = Number(split_name[1]) + 1;

        clone.find('.terminput').attr('name', split_name[0]+'_'+index);
        clone.find('.terminput').attr('value', '');
        clone.find('.currentchk').attr('name', 'current_'+index);
        clone.find('.currentchk').removeAttr('checked');
        clone.find('.addSessionTerms').hide();
        clone.find('.del_row').show();
        clone.find('.hiddenTerm').attr('name', '');

        $("#customFields1").append('<tr class="term-row">'+clone.html()+'</tr>');
        $('.termCount').val(index);
        var length = $('.terminput').length;

        if(length >1){
            $('.del_row').show();
        }else{
            $('.del_row').hide();

        }

    });

    $(document).on('click', '.addskills', function() {
        var clone = $(this).parent().parent().parent().clone(true);
        if(clone.find('.subject-skill').attr('data-subjectId').length >0){
            var name = clone.find('.subject-skill').attr('data-subjectId');
            clone.find('.subject-skill').attr('name', name+'[]');
        }
        clone.find('.subject-skill').attr('value', '');


        clone.find('.addskills').hide();
        clone.find('.del_row').show();

        $(this).parent().parent().parent().parent().parent().find(".skills-group").append(' <div class="row skill-input">'+clone.html()+'</div>');
        var length = $(this).closest('.skills-group').find('.skill-input').length;

        if(length >1){
            $(this).closest('.skills-group').find('.del_row').show();
        }else{
            $(this).closest('.skills-group').find('.del_row').hide();
        }

    });

    $(document).on('click', '.addGradeDetail', function() {
        var clone = $('.grade-row:last').clone(true);
        var name = clone.find('.gradeinput').attr("name");
        var split_name = name.split('_');
        var index = Number(split_name[1]) + 1;

        clone.find('.gradeinput').attr('name', split_name[0]+'_'+index);
        clone.find('.gradeinput').attr('value', '');
        clone.find('.typeselect').attr('name', 'type_'+index);
        clone.find('.marksinput').attr('name', 'marks_'+index);
        clone.find('.marksinput').attr('value', '');
        clone.find('.typeselect').removeAttr('Selected');
        clone.find('.marksinput').removeAttr('readonly');

        clone.find('.addGradeDetail').hide();
        clone.find('.del_row').show();
        clone.find('.del_row').addClass('remCF1');
        clone.find('.hiddenGrade').attr('name', '');

        var average_type = clone.find('.marksinput').data('average');
        var has_ca = clone.find('.typeselect').val() == 'CA' ? true : false;
        if(average_type && has_ca) {
            var average_mark = $('#avg-ca-input').val();
            clone.find('.marksinput').attr('value', average_mark);
        }

        $("#customGradeFields1").append('<tr class="grade-row">'+clone.html()+'</tr>');
        $('.gradeCount').val(index);
        var length = $('.gradeinput').length;

        if(length >1){
            $('.del_row').show();
        }else{
            $('.del_row').hide();

        }
    });

    $(document).on('click', '.addMidtermGradeDetail', function() {
        var midtermRows = $('.midtermgrade-row').length;
        if(midtermRows <= 15) {
            var caList = gradeCADetails();
            if(caList.length > 0) {
                var existingCas = []
                $('.ca-select').each(function() {
                    if($('option:selected', this).val() != '') {
                        existingCas.push($('option:selected', this).val())
                    }
                });
                var caOptions = caList.map(function(op) {
                    var disabled = existingCas.includes(op.ref)?'disabled':'';
                    return '<option value="'+op.ref+'"'+disabled+'>'+op.name+'</option>';
                }).join('');
                var htmlrow = `
                      <tr class="midtermgrade-row">
                        <td>
                            <input type="hidden" name="midterms[${midtermRows}][midtermGrade]" class="hiddenTerm" value="">
                            <select class="form-control ca-select"  data-actions-box="true" data-style="form-control btn-default btn-outline" name="midterms[${midtermRows}][ref]" required>
                                <option value="">Select CA</option>
                                ${caOptions}
                            </select>
                        </td>
                        <td>
                            <div class="form-group pos-R">
                                <input type="number" class="form-control midtermtotalMarks midterm-mark" min="1" step="any" placeholder="Total marks"  name="midterms[${midtermRows}][marks]" value="" required="" autocomplete="new-password" onkeypress="return isNumber(event)">
                                <div class="help-block with-errors"></div>
                            </div>
                        </td>
                        <td class="text-center">
                            <a href="javascript:void(0);" class="remCF1 common_btn del_row">Remove</a>
                        </td>
                    </tr>
                `
                // `<td>
                //     <input type="hidden" name="midterms[${midtermRows}][midtermGrade]" class="hiddenTerm" value="">
                //     <input type="text" class="code form-control midterm-input" name="midterms[${midtermRows}][name]" value="" autocomplete="off" required/>
                // </td>`
                // $('#midterm-settings-table').find('.midterm-add-row').before(htmlrow)
                $('#midterm-add-row').before(htmlrow)
            } else {
                $('.midtermgrade-row').remove()
                var htmlrow = `
                <tr class="midtermgrade-row">
                    <td colspan="3">
                        <div class="help-block with-errors pos_A">Please add CA grade details</div>
                    </td>
                </tr>
            `
            }
        }
    });

    $(document).on('keyup', '#avg-ca-input', function() {
        var score = 100;
        var mark = parseInt($(this).val());
        var exam_inputs = [];
        var ca_inputs = [];
        if(mark <= 100) {
            $('.typeselect').each(function() {
                if($(this).val() == 'CA') {
                    var mark_input = $(this).parent().next().find('.marksinput');
                    ca_inputs.push(mark_input);
                    mark_input.val(mark ? mark : '');
                    mark_input.attr('disabled', true);
                    score = 100 - mark;
                } else if($(this).val() == 'EXAM') {
                    exam_inputs.push($(this).parent().next().find('.marksinput'));
                }
            })
        }

        if(exam_inputs.length > 0 && mark) {
            var exam_mark = Math.floor(score/(exam_inputs.length));
            exam_inputs.forEach(function(v) { return v.val(exam_mark) });
        }

        var exam_total = exam_inputs.reduce(function (acc,cur) {
            return acc + parseInt(cur.val())
        }, 0);
        var total = mark + parseInt(exam_total);

        if(total > 100) {
            $(this).val('');
            ca_inputs.forEach(function(v) {return v.val('')})
            $(this).parent().find('.with-errors').text('Total marks of all grades should be equal to 100.');
            return false;
        }else{
            $(this).parent().find('.with-errors').text('');
        }
    })
    // Duplicate holiday datepicker on dialog
    $(document).on('click', '#addHoliday', function () {
        $('.holidayTable tbody').append(`
            <tr>
                <td id="hol-row" style="padding: 10px;">
                    <div class="form-group hol-row">
                        <input type="text" class="form-control date_field holidaypicker"
                            name="holidays[]" onkeydown="return false">
                    </div>
                </td>
                <td style="padding: 10px;">
                    <button type="button" class="btn btn-danger rem" >Remove</button>
                </td>
            </tr>`);
        $('#remHoliday').css('display', '');
        $('.holidaypicker').datepicker({
            minDate: new Date(),
            dateFormat: 'M dd,yy',
            changeMonth: true,
            changeYear: true
        });
    });

    // Remove Holiday Row
    $(document).on('click', '.rem', function() {
        $(this).closest('tr').remove();
    });

    // Get existing holiday dates
    $(document).on('click', '#btnAddHoliday', function() {
        let holidayDates = $(this).attr('data-holidays');
        if(holidayDates && holidayDates.length) {
            let holidays = JSON.parse(holidayDates);
            holidays.forEach(function(val, ind) {
                $('#row-tr').remove();
                $('.holidayTable tbody').append(`
                    <tr>
                        <td id="hol-row" style="padding: 10px;">
                            <div class="form-group hol-row">
                                <input type="text" class="form-control date_field holidaypicker"
                                    name="holidays[]" value="${val}" onkeydown="return false">
                            </div>
                        </td>
                        <td style="padding: 10px;">
                            <button type="button" class="btn btn-danger rem" >Remove</button>
                        </td>
                    </tr>`);

                $('.holidaypicker').datepicker({
                    minDate: new Date(),
                    dateFormat: 'M dd,yy',
                    changeMonth: true,
                    changeYear: true
                });
            });
            $(this).removeAttr('data-holidays');
        }
    });

    //  Update Holiday on Table
    $(document).on('click', '#btnUpdateHolidays', function() {
        let holidays = new Array();
        let holiday = '';
        $('.holidaypicker').each(function(){
            if($(this).val().length > 0) {
                holidays.push($(this).val());
                holiday += $(this).val() + '<br />';
            }
        });
        $('#holidays-row').html(holiday);
        $('.oldHolidays').remove();
    });

    $(document).on('input', '.gradeinput', function() {
        var caVal = $(this).val()
        var caName = $(this).attr('name')
        var isPresent = false
        $('.ca-select').each(function() {
           $('option', this).each(function() {
               if($(this).val() == caName) {
                   isPresent = true
                   if(caVal !== '')
                       $(this).text(caVal)
                   else
                       $(this).remove()
               }
           })

            if(!isPresent) {
                if(caVal !== '')
                $(this).append('<option value="'+caName+'">'+caVal+'</option>')
            }
        });
    })

    $(document).on('change', '.typeselect', function() {
        var gradeInput = $(this).parent().prev().find('.gradeinput');
        var markInput = $(this).parent().next().find('.marksinput');
        var gradeRef = gradeInput.attr('name');
        var gradeName = gradeInput.val();
        var _self = $(this);
        if(gradeRef || gradeRef !== '') {
            $('.ca-select').each(function() {
                if(_self.val() != 'CA') {
                    $('option', this).each(function() {
                        if($(this).val() == gradeRef) {
                            $(this).remove();
                        }
                    })
                } else if(_self.val() == 'CA') {
                    if(gradeName !== '') {
                        $(this).append('<option value="'+gradeRef+'">'+gradeName+'</option>');
                    }
                }
            });
        }

        var average_type = markInput.data('average');
        var average_mark = $('#avg-ca-input').val();
        console.log($(this).val())
        if(average_type) {
            if($(this).val() == 'CA') {
                markInput.attr('disabled', true);
                markInput.val(average_mark);
            } else {
                markInput.attr('disabled', false);
                markInput.val('');
            }
        }
    })

    $(document).on('change', '.ca-select', function() {
        var gradeName = $(this).val();
        var selectedCas = $('.ca-select').find(':selected').map(function(op) {return $(this).val();}).toArray();
        if(selectedCas.length > 0) {
            $('.ca-select').each(function() {
                var current = $('option:selected', this).val()
                $('option', this).each(function () {

                    if ($(this).val() != '' && (selectedCas.indexOf($(this).val()) !== -1) && !(current == $(this).val())) {
                        $(this).attr('disabled', true)
                    } else {
                        $(this).removeAttr('disabled')
                    }
                })
            })
        }
    })

    function gradeCADetails() {
        var caNames = [];

        $('.grade-type-row').each(function() {
            if($(this).find('.typeselect').val() == 'CA') {
                var nameElm = $(this).prev().find('.gradeinput');
                caNames.push({
                    ref: nameElm.attr('name'),
                    name: nameElm.val(),
                });
            }
        })

        return caNames;
    }

    $(document).on('click', '.addGradeComment', function() {

        var clone = $('.grade-row:last').clone(true);
        var name = clone.find('.gradefrom').attr("name");
        var split_name = name.split('_');
        var index = Number(split_name[1]) + 1;

        clone.find('.gradefrom').attr('name', 'from_'+index);
        clone.find('.gradefrom').attr('value', '');

        clone.find('.gradeto').attr('name', 'to_'+index);
        clone.find('.gradeto').attr('value', '');

        clone.find('.gradecomment').attr('name', 'comment_'+index);
        clone.find('.gradecomment').attr('value', '');


        clone.find('.addGradeComment').hide();
        clone.find('.del_row').show();
        clone.find('.del_row').addClass('remCF1');
        clone.find('.hiddenGrade').attr('name', '');

        $("#customGradeFields1").append('<tr class="grade-row">'+clone.html()+'</tr>');
        $('.gradeCommentCount').val(index);
        var length = $('.gradefrom').length;

        if(length >1){
            $('.del_row').show();
        }else{
            $('.del_row').hide();
        }

    });
    $(document).on('click', '.bankstatus', function() {

        if($(this).hasClass("active") == true){
            $(this).parent().find('.status').val('0');
        }else{
            $(this).parent().find('.status').val('1');
        }

    });
    $(document).on('click', '.addBankDetail', function() {
        var clone = $('.bank-row:last').clone(true);
        var name = clone.find('.bankname').attr("name");
        var split_name = name.split('_');
        var index = Number(split_name[1]) + 1;

        clone.find('.bankname').attr('name', 'bankname_'+index);
        clone.find('.bankname').attr('value', '');
        clone.find('.bankname').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
        clone.find('.bankId').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
        clone.find('.accoutnumber').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');

        clone.find('.bankId').attr('name', 'bankId_'+index);
        clone.find('.bankId').removeAttr('selected', true);

        clone.find('.bankstatus').removeClass('focus');
        clone.find('.bankstatus').addClass('active');

        clone.find('.accoutnumber').attr('name', 'accoutnumber_'+index);
        clone.find('.accoutnumber').attr('value', '');

        clone.find('.status').attr('name', 'status_'+index);
        clone.find('.status').attr('value', '0');


        clone.find('.addBankDetail').hide();

        clone.find('.del_row').show();
        clone.find('.del_row').addClass('remCF1');

        clone.find('.hiddenGrade').attr('name', '');

        $("#customGradeFields1").append('<tr class="bank-row">'+clone.html()+'</tr>');
        $('.bankDetailCount').val(index);
        var length = $('.bankname').length;

        if(length >1){
            $('.del_row').show();
        }else{
            $('.del_row').hide();

        }

    });

    $(document).on('click', '.addTitle', function() {
        var clone = $('.title-row:last').clone(true);
        var clone =  clone.removeClass('has-danger');
        clone.find('.help-block').html('');
        var selecthtml = $('#select-model').html();

        var name = clone.find('.amount').attr("name");
        var split_name = name.split('_');
        var index = Number(split_name[1]) + 1;

        clone.find('.feetitle').empty();
        clone.find('.feetitle').html('<select class="selectpicker feePlanTitle"  data-live-search="true" name="title_'+index+'" tabindex="-98" required><option value="">select Fee Title </option>'+selecthtml+'</select> <div class="help-block with-errors"></div>');

        clone.find('.amount').attr('name', 'amount_'+index);
        clone.find('.amount').attr('value', '');




        clone.find('.addTitle').hide();

        clone.find('.del_row').show();
        clone.find('.del_row').addClass('remCF1');

        clone.find('.hiddenGrade').attr('name', '');

        $("#customGradeFields1").append('<tr class="title-row">'+clone.html()+'</tr>');
        $('.selectpicker').selectpicker('refresh');

        $('.feeTitleCount').val(index);
        var length = $('.feetitle').length;

        if(length >1){
            $('.del_row').show();
        }else{
            $('.del_row').hide();
        }
    });

    // add report fee account row
    $(document).on('click', '#btn_add_account_row', function() {
        let row = $('.account-row:last').clone()

        // reset clone inputs
        row.find("input").val("");
        row.find("select").prop('selectedIndex',0);
        row.appendTo('#reportPaymentTable');
    });

    // remove report account fee row
    $(document).on('click', '.btn_remove_account', function() {
        $(this).closest('tr').remove();
        amountCheck();
    });

    //  Validate Report checker amounts on value change
    // $(document).on('input', '#txt_amount, #schooltryAmount, .feeAmount', amountCheck);

    //  check amount calculation/validation
    // function amountCheck() {
    //     $('.help-block').each(function(){
    //         $(this).text('');
    //     });
    //
    //     let chargedAmount = parseFloat($('#txt_amount').val());
    //     let schooltryAmount = parseFloat($('#schooltryAmount').val());
    //     let amounts = [];
    //     amounts.push(schooltryAmount);
    //     $('.feeAmount').each(function(i) {
    //         if($(this).val() != '') {
    //             amounts.push(parseFloat($(this).val()));
    //         }
    //     })
    //
    //     if(amounts.length > 0 ) {
    //         let sum = 0;
    //         amounts.map(function(item) {
    //            sum += item;
    //         });
    //
    //         if(sum > chargedAmount) {
    //             $(this).next('.help-block').text('Total amount is greater than amount charged');
    //
    //             $('#updateSchoolProfile').submit(function(e){
    //                 e.preventDefault();
    //             });
    //         }
    //
    //         if(sum < chargedAmount) {
    //             $('#help-block')
    //                 .removeClass('with-errors')
    //                 .addClass('text-warning')
    //                 .text('Charged amount is more than amount split');
    //
    //             $('#updateSchoolProfile').submit(function(e){
    //                 e.preventDefault();
    //             });
    //         }
    //     }
    // }


    $(document).on('submit', '#updateGroupForm', function(e) {
        e.preventDefault();
        var school_id = $('input[name="school_id"]').val();
        var class_ids = $('#class_ids').val();
        var token = $('meta[name=csrf-token]').attr('content');

        if(jQuery.isEmptyObject(class_ids)){
            $('#updateGroupForm').addClass('updateGroupForm');
            $('#updateGroupForm').removeAttr('id');
            $('.updateGroupForm').submit();
        }else{
            $.ajax({
                type: 'POST', // For jQue
                url: '/admin/checkMainGroupData',
                data: {school_id : school_id, _token: token, class_ids: class_ids},
                success: function (result) {
                    if(result.code == 400){
                        swal({
                                title: "Are you sure?",
                                text:  "Currently there is data in Main School Group, all data related to class group will be lost after this",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#F36820",
                                confirmButtonText: "Yes!",
                                closeOnConfirm: false,
                                closeOnCancel: false,
                                showLoaderOnConfirm: true
                            },
                            function(isConfirm){
                                if (isConfirm) {
                                    $('#updateGroupForm').addClass('updateGroupForm');
                                    $('#updateGroupForm').removeAttr('id');
                                    $('.updateGroupForm').submit();
                                } else {
                                    swal("Cancelled", "Your data is safe :)", "error");
                                    setTimeout(function(){location.href="/admin/classGroups"} , 2000);


                                }
                            });
                    }else{
                        $('#updateGroupForm').addClass('updateGroupForm');
                        $('#updateGroupForm').removeAttr('id');
                        $('.updateGroupForm').submit();
                    }
                }
            });
        }

    });

    $(document).on('submit', 'form#submitAsignment', function(e) {
        var validate = 0;
        var description = $('textarea[name="description"]').val();
        var length = $('.dz-image-preview').length;
        if(length == 0 && description == ''){
            validate+=1;
            $('.feetotal-error_msg').show();
            $('.errormsg').html('One of field is required, either input answer or attachment');
            setTimeout(function() {
                $('.feetotal-error_msg').fadeOut('fast');
            }, 2000);

        }else{
            $('div#mydocumentdropzone').css('border', '1px solid rgba(33, 33, 33, 0.12)');
            $('#mydocumentdropzone').parent().find('.help-block').html('');
        }
        if(validate == 1){
            e.preventDefault();
            return false;
        }else{
            return true;
        }
    });
    $(document).on('submit', 'form.uploadsFilesAssessment', function(e) {

        var validate = 0;
        var description = $('textarea[name="description"]').val();
        var length = $('.dz-image-preview').length;
        var isEmpty = $('.summernote').summernote('isEmpty');

        if(length == 0 && isEmpty == true){
            validate+=1;
            $('.feetotal-error_msg').show();
            $('.errormsg').html('One of field is required, either description or attachment');
            setTimeout(function() {
                $('.feetotal-error_msg').fadeOut('fast');
            }, 2000);




        }else{
            $('.feetotal-error_msg').hide();
            $('.errormsg').html('');
        }
        if(validate == 1){
            e.preventDefault();
            return false;
        }else{
            return true;
        }


    });

    $(document).on('submit', '#transactionForm', function(e) {
        e.preventDefault();
        var student_id = $('select[name="student_id"]').val();

        var length = $('input.amount-paid').length;
        var validatezero = 0;
        if(length > 0){
            $( "input.amount-paid" ).each(function() {
                var amt = $(this).val();
                if(amt != ''){
                    if(amt > 0){
                        validatezero = 1;
                    }
                }

            });

        }
        if(validatezero == 1){
            $('.amt-error-div').hide();
            $('span.amt-error').html('');
            var class_id = $('select[name="class_id"]').val();
            if(student_id != '' && class_id != ''){
                $.ajax({
                    type: 'POST', // For jQue
                    url: '/admin/transaction_store',
                    data: $('#transactionForm').serialize()+'&type=1',
                    success: function (result) {
                        if(result.status == 200){
                            swal({
                                    title: "Transaction Successful.",
                                    text:  "Do you want to download the receipt?",
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#F36820",
                                    confirmButtonText: "Yes!",
                                    closeOnConfirm: false,
                                    closeOnCancel: false,
                                    showLoaderOnConfirm: true
                                },
                                function(isConfirm){
                                    if (isConfirm) {
                                        var downloadUrl = result.downloadUrl;

                                        setTimeout(function(){location.href=downloadUrl} , 2000);
                                        setTimeout(function(){location.href="/admin/feeTransaction"} , 4000);
                                    } else {
                                        swal("Cancelled", "Your data is safe :)", "error");
                                        setTimeout(function(){location.href="/admin/feeTransaction"} , 2000);

                                    }
                                });
                            return false;
                        }

                    }

                });
            }
        }else{
            $('.amt-error-div').show();
            $('span.amt-error').html('Paid amount should be grate than 0');
        }
    });

    $(document).on('submit', '.feePlanForm', function(e) {
        var validate = 0;
        $( "select.feePlanTitle" ).each(function() {
            if($(this).val()==''){
                validate=1;
                $(this).parent().parent().find('div.with-errors').html('Please enter value.');
                event.preventDefault();

            }
            else{
                $(this).parent().parent().find('div.with-errors').html('');
            }
        });
        $( "input.amount" ).each(function() {
            if($(this).val()==''){
                validate=1;
                $(this).parent().find('div.with-errors').html('Please enter value.');
                event.preventDefault();
            }else{
                $(this).parent().find('div.with-errors').html('');

                var class_id = $('select[name="class_id"]').val();
                if(student_id != '' && class_id != ''){
                    $.ajax({

                        type: 'POST', // For jQue
                        url: '/admin/transaction_store',

                        data: $('#transactionForm').serialize()+'&type=1',
                        success: function (result) {
                            if(result.status == 200){

                                swal({
                                        title: "Transaction Successful.",
                                        text:  "Do you want to download the receipt?",
                                        type: "warning",
                                        showCancelButton: true,
                                        confirmButtonColor: "#F36820",
                                        confirmButtonText: "Yes!",
                                        closeOnConfirm: false,
                                        closeOnCancel: false,
                                        showLoaderOnConfirm: true
                                    },
                                    function(isConfirm){
                                        if (isConfirm) {
                                            var downloadUrl = result.downloadUrl;

                                            setTimeout(function(){location.href=downloadUrl} , 2000);
                                            setTimeout(function(){location.href="/admin/feeTransaction"} , 4000);




                                        } else {
                                            swal("Cancelled", "Your data is safe :)", "error");
                                            setTimeout(function(){location.href="/admin/feeTransaction"} , 2000);

                                        }
                                    });
                                return false;
                            }

                        }


                    });
                }
            }
        });
    });




    $(".addStudent").click(function(){
        $.ajax({
            type: 'GET',
            url: '/admin/getClasses',
            dataType: "json",
            success: function (res) {

                var row = $('form #customFields').find('tr:eq(1)').clone(true).removeClass('selectpicker');
                // $('option:selected', row).prop("selected", false);
                $('input', row).val("");
                if(row.find('.classid').length > 0){

                    row.find('.classid').empty();
                    row.find('.classid').html('<select class="selectpicker code classid"  data-live-search="true" name="class_id[]" tabindex="-98">'+res['html']+'</select>');
                }
                if(row.find('.student').length > 0){

                    row.find('.student').empty();
                    row.find('.student').html('<select class="selectpicker code student"  data-live-search="true" name="student_ids[]" tabindex="-98"><option value="">Select Child</option></select>');
                }
                if(row.find('.relation').length > 0){
                    row.find('.relation').empty();
                    row.find('.relation').html('<select class="selectpicker code relation" data-live-search="true" id="customFieldtwo" name="relation[]"><option value="">Relation with Child</option><option value="Parent">Parent</option><option value="Guardians">Guardians</option></select>');
                }

                var rowhtml = row.html();


                $("#customFields").append('<tr>'+rowhtml+'</tr>');
                $('form #customFields').find('tr:last').find('td:last').html('');
                $('form #customFields').find('tr:last').find('td input').val('');
                $('form #customFields').find('tr:last').find('td option:selected').prop("selected", false);
                $('form #customFields').find('tr:last').find('td:last').html('<a href="javascript:void(0);" class="remCF common_btn del_row">Remove</a>');
                $('.selectpicker').selectpicker('refresh');
            }
        });

    });

    $(document).on('click', '.remCF', function() {
        var length = $('.remCF').length;

        $(this).parent().parent().remove();
        var checkedLength = $('.currentchk:checked').length;
        if(checkedLength == 0){
            $('.currentchk:first').attr('checked', true);
        }
    });
    $(document).on('change', ".currentchk", function() {
        $(".currentchk").prop('checked', false);
        $(this).prop('checked', true);
    });
    // append row table
    $(".addCF1").click(function(){
        $("#customFields1").append('<tr><td><div class="pos-R"><input type="text" class="code termchange" name="terms[]" value=""  />  <div class="Search_dropdown termdrpdwn" style="display:none;"><i class="fa fa-times term_cross"></i><ul><li>abdxgjk</li>li>ferf</li><li>dxewfc</li></ul></div></div></td><td><input type="radio" class="currentchk" name="current[]" placeholder="" value="1" onkeydown="return false" onclick="this.previousSibling.value=1-this.previousSibling.value"></td><td class="text-center"><a href="javascript:void(0);" class="remCF1 common_btn del_row">Remove</a></td></tr>');
    });
    $(document).on('click','.remCF1',function(){
        var index = $(this).closest('.skills-group').find('.remCF1').index(this);
        var length = $(this).closest('.skills-group').find('.remCF1').length;
        if(length == 2){
            $(this).closest('.skills-group').find('.remCF1').hide();
        }
        if(index == 0){
            $(this).closest('.skills-group').find('.addskills').eq(1).show();
        }
        if( $(this).closest('.skills-group').find('.skill-input').length >= 1){
            $(this).closest('.skill-input').remove();
        }else{
            $(this).parent().parent().remove();
        }

        if($('.terminput').length == 1 || $('.gradeinput').length == 1 || $('.gradefrom').length == 1|| $('.bankname').length == 1|| $('.amount').length == 1 ){
            $('.remCF1').hide();
            $('.addSessionTerms').show();
            $('.addGradeDetail').show();
            $('.addGradeComment').show();
        }
        if($('.addSessionTerms').length == 0 || $('.addGradeDetail').length == 0 || $('.addTitle').length == 0 || $('.addGradeComment').length == 0 || $('.addBankDetail').length == 0 ){
            $('.addSessionTerms:first').show();
            $('.addGradeDetail:first').show();
            $('.addGradeComment:first').show();
            $('.addBankDetail:first').show();
            $('.addTitle:first').show();
        }

        if( $(this).parent().parent().parent().parent().find('addskills').length > 0){
            $('.addskills:first').show();
        }

        var checkedLength = $('.currentchk:checked').length;
        if(checkedLength == 0){
            $('.currentchk:first').attr('checked', true);
        }

        if($('.ca-select').length > 0) {
            var existingCas = []
            $('.ca-select').not($(this)).each(function() {
                $('option', this).each(function() {
                    if(existingCas.includes($(this).val())) {
                        $(this).attr('disabled', true)
                    } else {
                        $(this).removeAttr('disabled')
                    }
                    existingCas.push($(this).val())
                })
            })

            var total = 0;
            $(".midtermtotalMarks").each(function() {
                if($(this).val() != '') {
                    total+=parseFloat($(this).val());
                }
            });
            $('#caTotals').html(total)
        } else {
            $('#caTotals').html('')
        }
    });

    $(function () {
        $('.datetimepicker1').datetimepicker();
    });


    $(".radio_btn1").click(function(){
        $(".auction_fields").css("display", "none");
        $(".buy_now_fields").css("display", "block");
    });

    $(".radio_btn2").click(function(){
        $(".auction_fields").css("display", "block");
        $(".buy_now_fields").css("display", "none");
    });

});


function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function(e) {
            $('.previewSource').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
}

$(".previewImage").change(function() {
    readURL(this);
});


$("#customFields").on('click','.remCF',function(){
    $(this).parent().parent().remove();
});

$(function () {
    $('#dob').datetimepicker({
        maxDate: new Date(),
        format: 'DD-MM-YYYY'
    });
    $('.due_date').datetimepicker({
        showClear: true,

        // minDate: new Date(),
        format: 'DD-MM-YYYY'
    });


    $('#datetimepicker').datetimepicker({
        format: 'DD-MM-YYYY'
    });
    $('.resumpdatepicker').datepicker({
        minDate: new Date(),
        dateFormat: 'M dd,yy',
        changeMonth: true,
        changeYear: true,
        orientation: 'auto'
    });
});

// Attendance DatePicker
$('#attendanceDate').datetimepicker({
    maxDate: new Date(),
    format: 'YYYY-MM-DD',
});

// holiday
$('.holidaypicker').datepicker({
    minDate: new Date(),
    dateFormat: 'M dd,yy',
    changeMonth: true,
    changeYear: true
});

// Attendance CheckInOut time picker
$(document).ready(
    $('.attendance_time').datetimepicker({
        format: 'LT',
    })
);
$('.attendance_time').css({'width': '110px'});

$('#date_from').datetimepicker({
    minDate: moment().millisecond(0).second(0).minute(0).hour(0),
    format: 'DD-MM-YYYY'
})

$('#date_from_edit, #date_to_edit').datetimepicker({
    format: 'DD-MM-YYYY'
})

$('#date_to').datetimepicker({
    minDate: new Date(),
    format: 'DD-MM-YYYY'
})
$("#date_from").on("dp.change", function (e) {
    $('#date_to').data("DateTimePicker").minDate(e.date);
});

$(" #date_from_edit").on("dp.change", function (e) {
    $('#date_to_edit').data("DateTimePicker").minDate(e.date.millisecond(0).second(0).minute(0).hour(0));
});


$(".radio_btn1").click(function(){
    $(".auction_fields").css("display", "none");
    $(".buy_now_fields").css("display", "block");
});

$(".radio_btn2").click(function(){
    $(".auction_fields").css("display", "block");
    $(".buy_now_fields").css("display", "none");
});


if ($("#toyearpicker").length) {
    $('#toyearpicker').datepicker({
        minViewMode: 2,
        format: 'yyyy',
    });
}

if ($("#fromyearpicker").length) {
    $('#fromyearpicker').datepicker({
        minViewMode: 2,
        format: 'yyyy',
        // startDate: new Date(),
    }).on('changeDate', function(ev,date){
        new_date = moment(ev.date,'YYYY').format('YYYY');
        $("#toyearpicker").datepicker(
            'setDate', ev.date
        );
        $("#toyearpicker").datepicker(
            'setStartDate', ev.date
        );

    });
}
$(document).on('click','.delete',function(e){
    var url = $(this).attr('data-url');
    var type = $(this).attr('data-type');
    var redirecttype = $(this).attr('data-redirecttype');
    var redirect = $(this).attr('data-redirect');
    if(typeof redirect === 'undefined'){
        redirect = ''
    }

    if(type == 'teacher_feed'){
        var change_type = 'Feed';
    }else{
        var change_type = type;

    }
    var method = $(this).data('method');
    if(typeof method === 'undefined'){
        method = 'GET';
    }

    swal({
            title: "Are you sure?",
            text: "Do you want to delete the "+change_type+" ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#F36820",
            confirmButtonText: "Yes, Delete it!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function(isConfirm){
            if (isConfirm) {
                $.ajax({
                    /* the route pointing to the post function */
                    url: url,
                    type: method != ''? method : 'GET',
                    /* send the csrf-token and the input to the controller */
                    dataType: 'JSON',
                    /* remind that 'data' is the response of the AjaxController */
                    success: function (data) {
                        if (data['success']) {
                            swal("Deleted!", type+" Deleted Successfully.", "success");
                            if(type == 'Teacher'){
                                setTimeout(function(){location.href="/admin/teachers"} , 2000);
                            }
                            if(type == 'Class'){
                                setTimeout(function(){location.href="/admin/classes"} , 2000);
                            }
                            if(type == 'Link'){
                                setTimeout(function(){location.href="/admin/links"} , 2000);
                            }
                            if(type == 'Feed'){
                                setTimeout(function(){location.href="/admin/feeds"} , 2000);
                            }
                            if(type == 'Fee Title'){
                                setTimeout(function(){location.href="/admin/fee-titles"} , 2000);
                            }
                            if(type == 'Fee Plan'){
                                setTimeout(function(){location.href="/admin/fee-plans"} , 2000);
                            }
                            if(type == 'Parent'){
                                setTimeout(function(){location.href="/admin/parents"} , 2000);
                            }
                            if(type == 'Student'){
                                setTimeout(function(){location.href="/admin/students"} , 2000);
                            }
                            if(type == 'Test'){
                                setTimeout(function(){location.href="/admin/cbt"} , 2000);
                            }
                            if(type == 'Grade'){
                                setTimeout(function(){location.href="/admin/grades"} , 2000);
                            }

                            if(type == 'Document'){
                                if(redirecttype == 'parent'){
                                    setTimeout(function(){location.href="/parent/documents"} , 2000);

                                }else{
                                    setTimeout(function(){location.href="/admin/documents"} , 2000);

                                }
                            }
                            if(type == 'Subadmin-Role'){
                                setTimeout(function(){location.href="/superadmin/roles"} , 2000);
                            }
                            if(type == 'Sub-user'){
                                setTimeout(function(){location.href="/superadmin/subusers"} , 2000);
                            }
                            if(type == 'School'){
                                setTimeout(function(){location.href="/superadmin/schools"} , 2000);
                            }
                            if(type == 'Role'){
                                setTimeout(function(){location.href="/admin/roles"} , 2000);
                            }
                            if(type == 'teacher_feed'){
                                setTimeout(function(){location.href="/teacher/feeds"} , 2000);
                            }
                            if(type == 'ClassGroup'){
                                setTimeout(function(){location.href="/admin/classGroups"} , 2000);
                            }
                            if(type == 'Session'){
                                setTimeout(function(){location.href="/admin/sessions"} , 2000);
                            }
                            if(type == 'Skill'){
                                setTimeout(function(){location.href="/admin/skills"} , 2000);
                            }
                            if(type == 'Affective Area'){
                                setTimeout(function(){location.href="/admin/affective_areas"} , 2000);
                            }
                            if(type == 'Timetable'){
                                setTimeout(function(){location.href="/admin/timetable"} , 2000);
                            }
                            if(type == 'Assessment'){
                                setTimeout(function(){location.href="/admin/assignments"} , 2000);
                            }
                            if(type == 'Assignment'){
                                setTimeout(function(){location.href="/admin/assignments"} , 2000);
                            }
                            if(type == 'Grade Batch Report'){
                                setTimeout(function(){location.href="/admin/batchreport"} , 2000);
                            }  if(type == 'Batch Invoice Download'){
                                setTimeout(function(){location.href="/admin/feebatchreport"} , 2000);
                            }
                            if(type == 'Grade Skill'){
                                setTimeout(function(){location.href="/admin/gradeskills"} , 2000);
                            }
                            if(type == 'Master Skill'){
                                setTimeout(function(){location.href="/admin/masterskills"} , 2000);
                            }
                            if(type == 'Class Arm'){
                                setTimeout(function(){location.href="/admin/classarm"} , 2000);
                            }
                            if(type == 'Partner'){
                                setTimeout(function(){location.href="/superadmin/partners"} , 2000);
                            }
                            if(type == 'Dues'){
                                setTimeout(function(){location.href="/partner/dues"} , 2000);
                            }
                            if(type == 'Hostel'){
                                setTimeout(function(){location.href="/admin/hostels"} , 2000);
                            }

                            if(redirect != ''){
                                setTimeout(function(){location.href= redirect } , 2000);
                            }

                        }
                        if (data['error']) {
                            swal("",data['error'], "info");
                        }

                    },error: function(err){

                    }
                });


            }else{
                swal("Cancelled", "Your data is safe", "error");

            }

        });
    return false;
});

//Delete Alert


$(document).on('click', '.deleteNote',function(e){
    var url = $(this).attr('data-url');
    var type = $(this).attr('data-type');
    $refreshurl  = $(this).attr('data-refreshurl');
    swal({
            title: "Are you sure?",
            text: "Do you want to delete the "+type+" ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#F36820",
            confirmButtonText: "Yes, Delete it!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function(isConfirm){
            if (isConfirm) {
                $.ajax({
                    /* the route pointing to the post function */
                    url: url,
                    type: 'GET',
                    /* send the csrf-token and the input to the controller */
                    dataType: 'JSON',
                    /* remind that 'data' is the response of the AjaxController */
                    success: function (data) {
                        if (data['success']) {
                            swal("Deleted!", type+" Deleted Successfully.", "success");
                            setTimeout(function(){location.href=$refreshurl}, 1000);

                        }
                        if (data['error']) {
                            swal("",data['error'], "info");
                        }

                    },error: function(err){
                    }
                });


            }else{
                swal("Cancelled", "Your data is safe", "error");

            }

        });
    return false;
});

$(document).on('click','.deleteTeacher',function(e){
    var url = $(this).attr('data-url');
    var type = $(this).attr('data-type');
    if(type == 'teacher_feed'){
        var change_type = 'Feed';
    }else{
        var change_type = type;
    }
    swal({
            title: "Are you sure?",
            text: "Do you want to delete the "+change_type+" ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#F36820",
            confirmButtonText: "Yes, Delete it!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function(isConfirm){
            if (isConfirm) {
                $.ajax({
                    /* the route pointing to the post function */
                    url: url,
                    type: 'GET',
                    /* send the csrf-token and the input to the controller */
                    dataType: 'JSON',
                    /* remind that 'data' is the response of the AjaxController */
                    success: function (data) {
                        if (data['success']) {
                            swal("Deleted!", type+" Deleted Successfully.", "success");
                            if(type == 'Teacher'){
                                setTimeout(function(){location.href="/teacher/teachers"} , 2000);
                            }
                            if(type == 'Assessment' || type == 'Assignment'){
                                setTimeout(function(){location.href="/teacher/assignments"} , 2000);
                            }
                            if(type == 'Class'){
                                setTimeout(function(){location.href="/teacher/classes"} , 2000);
                            }
                            if(type == 'Link'){
                                setTimeout(function(){location.href="/teacher/links"} , 2000);
                            }
                            if(type == 'Feed'){
                                setTimeout(function(){location.href="/teacher/feeds"} , 2000);
                            }
                            if(type == 'Parent'){
                                setTimeout(function(){location.href="/teacher/parents"} , 2000);
                            }
                            if(type == 'Student'){
                                setTimeout(function(){location.href="/teacher/students"} , 2000);
                            }
                            if(type == 'Grade'){
                                setTimeout(function(){location.href="/teacher/grades"} , 2000);
                            }
                            if(type == 'Document'){
                                setTimeout(function(){location.href="/teacher/documents"} , 2000);
                            }
                            if(type == 'Feed'){
                                setTimeout(function(){location.href="/teacher/feeds"} , 2000);
                            }
                            if(type == 'Comment'){
                                setTimeout(function(){location.href="/teacher/comments"} , 2000);
                            }
                            if(type == 'Grade Batch Report'){
                                setTimeout(function(){location.href="/teacher/batchreport"} , 2000);
                            }  if(type == 'Batch Invoice Download'){
                                setTimeout(function(){location.href="/teacher/feebatchreport"} , 2000);
                            }
                        }
                        if (data['error']) {
                            swal("",data['error'], "info");
                        }

                    },error: function(err){

                    }
                });


            }else{
                swal("Cancelled", "Your data is safe", "error");

            }



        });
    return false;
});


function changeStatus(id,userType,message,url) {
    swal({
            title: "Are you sure?",
            text: "Do you want to "+message+" the "+userType+" ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#F36820",
            confirmButtonText: "Yes, "+message+" it!",
            closeOnConfirm: false,
            closeOnCancel: false
        },

        function(isConfirm){


            if (isConfirm) {
                $.ajax({
                    /* the route pointing to the post function */
                    url: url,
                    type: 'GET',
                    /* send the csrf-token and the input to the controller */
                    dataType: 'JSON',
                    /* remind that 'data' is the response of the AjaxController */
                    success: function (data) {
                        swal({
                            title: "",
                            text: userType +' '+ message+' Successfully',
                            type: "success",    });
                        $('#loader').show();

                        if(userType == 'Teacher'){
                            setTimeout(function(){location.href="/admin/teachers"} , 2000);
                        }
                        if(userType == 'Subadmin'){
                            setTimeout(function(){location.href="/admin/subusers"} , 2000);
                        }
                        if(userType == 'Class'){
                            setTimeout(function(){location.href="/admin/classes"} , 2000);
                        }
                        if(userType == 'Link'){
                            setTimeout(function(){location.href="/admin/links"} , 2000);
                        }
                        if(userType == 'Event'){
                            setTimeout(function(){location.href="/admin/events"} , 2000);
                        }
                        if(userType == 'Gallery'){
                            setTimeout(function(){location.href="/admin/gallery"} , 2000);
                        }
                        if(userType == 'Feed'){
                            setTimeout(function(){location.href="/admin/feeds"} , 2000);
                        }
                        if(userType == 'Fee Title'){
                            setTimeout(function(){location.href="/admin/fee-titles"} , 2000);
                        }
                        if(userType == 'Fee Plan'){
                            setTimeout(function(){location.href="/admin/fee-plans"} , 2000);
                        }
                        if(userType == 'Parent'){
                            setTimeout(function(){location.href="/admin/parents"} , 2000);
                        }
                        if(userType == 'Assessment'){
                            setTimeout(function(){location.href="/admin/assessments"} , 2000);
                        }
                        if(userType == 'Student'){
                            setTimeout(function(){location.href="/admin/students"} , 2000);
                        }
                        if(userType == 'Grade'){
                            //setTimeout($('#loader').fadeIn(), 1000);
                            setTimeout(function(){location.href="/admin/grades"} , 4000);
                        }
                        if(userType == 'Attendance'){
                            setTimeout(function(){location.href="/admin/attendance"} , 2000);
                        }
                        if(userType == 'Sub-user'){
                            setTimeout(function(){location.href="/superadmin/subusers"} , 2000);
                        }
                        if(userType == 'School'){
                            setTimeout(function(){location.href="/superadmin/schools"} , 2000);
                        }
                        if(userType == 'Partner'){
                            setTimeout(function(){location.href="/superadmin/partners"} , 2000);
                        }
                        if(userType == 'Sub-partner'){
                            setTimeout(function(){location.href="/partner/subadmins"} , 2000);
                        }
                        if(userType == 'Dues'){
                            setTimeout(function(){location.href="/partner/dues"} , 2000);
                        }
                        if(userType == 'Template'){
                            // setTimeout(function(){location.href="/superadmin/school_edit/"+id} , 2000);
                        }
                        if(userType == 'Recurring'){
                            setTimeout(function(){location.href="/admin/accountSettings"} , 2000);
                        }
                        if(userType == 'Skill'){
                            setTimeout(function(){location.href="/admin/skills"} , 2000);
                        } if(userType == 'Affective Area'){
                            setTimeout(function(){location.href="/admin/affective_areas"} , 2000);
                        }

                    },
                    error: function(err){

                    }
                });
            }else {
                swal("Cancelled", "Your data is safe", "error");
            }

        });
    return false;

}

//Warning Message






//Warning Message
$(document).on('click','#sa-warning, .sa-warning',function(e){
    var id = $(this).attr('data-id');
    var userType = $(this).attr('data-userType');
    var url = $(this).attr('data-url');
    var message = $(this).attr('data-message');
    changeStatus(id,userType,message,url);


    return false;
});

if($('#superadminamail').length > 0){
    ($('#sendto').hasClass("active") == true) ? $('#superadminamail input[name="sendto"]').val(true) : $('#superadminamail input[name="sendto"]').val(false);
    $(document).on('click','#sendto',function(e){
        if($(this).hasClass("active") == true){
            $('#superadminamail input[name="sendto"]').val(true);
        }else{
            $('#superadminamail input[name="sendto"]').val(false);
        }

    });
}


function changeStatusTeacher(id,userType,message,url) {
    swal({
            title: "Are you sure?",
            text: "Do you want to "+message+" the "+userType+" ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#F36820",
            confirmButtonText: "Yes, "+message+" it!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function(isConfirm){
            if (isConfirm) {
                $.ajax({
                    /* the route pointing to the post function */
                    url: url,
                    type: 'GET',
                    /* send the csrf-token and the input to the controller */
                    dataType: 'JSON',
                    /* remind that 'data' is the response of the AjaxController */
                    success: function (data) {
                        swal({
                            title: "",
                            text: userType +' '+ message+' Successfully',
                            type: "success",    });


                    },
                    error: function(err){

                    }
                });
            }else {
                swal("Cancelled", "Your data is safe", "error");
            }

            if(userType == 'Event'){
                setTimeout(function(){location.href="/teacher/events"} , 2000);
            }

            if(userType == 'Feed'){
                setTimeout(function(){location.href="/teacher/feeds"} , 2000);
            }

            if(userType == 'Assessment'){
                setTimeout(function(){location.href="/teacher/assessments"} , 2000);
            }

            if(userType == 'Attendance'){
                setTimeout(function(){location.href="/teacher/attendance"} , 2000);
            }
            if(userType == 'Comment'){
                setTimeout(function(){location.href="/teacher/comments"} , 2000);
            }

        });
    return false;
}

$(document).on('click','#sa-warning-teacher','.sa-warning-teacher',function(e){
    var id = $(this).attr('data-id');
    var userType = $(this).attr('data-userType');
    var url = $(this).attr('data-url');
    var message = $(this).attr('data-message');
    changeStatusTeacher(id,userType,message,url);
    return false;
});


function changeStatusParent(id,userType,message,url) {
    swal({
            title: "Are you sure?",
            text: "Do you want to "+message+" the "+userType+" ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#F36820",
            confirmButtonText: "Yes, "+message+" it!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function(isConfirm){
            if (isConfirm) {
                $.ajax({
                    /* the route pointing to the post function */
                    url: url,
                    type: 'GET',
                    /* send the csrf-token and the input to the controller */
                    dataType: 'JSON',
                    /* remind that 'data' is the response of the AjaxController */
                    success: function (data) {
                        swal({
                            title: "",
                            text: userType +' '+ message+' Successfully',
                            type: "success",    });


                    },
                    error: function(err){

                    }
                });
            }else {
                swal("Cancelled", "Your data is safe", "error");
            }

            if(userType == 'Event'){
                setTimeout(function(){location.href="/parent/events"} , 2000);
            }

            if(userType == 'Feed'){
                setTimeout(function(){location.href="/parent/feeds"} , 2000);
            }

            if(userType == 'Assessment'){
                setTimeout(function(){location.href="/parent/assessments"} , 2000);
            }

            if(userType == 'Attendance'){
                setTimeout(function(){location.href="/parent/attendance"} , 2000);
            }
        });
    return false;
}

$(document).on('click','#sa-warning-parent','.sa-warning-parent',function(e){
    var id = $(this).attr('data-id');
    var userType = $(this).attr('data-userType');
    var url = $(this).attr('data-url');
    var message = $(this).attr('data-message');
    changeStatusParent(id,userType,message,url);
    return false;
});
$('.promote_all, .allocate_all').on('click', function(e) {
    var allVals = [];
    $(".sub_chk:checked").each(function() {
        allVals.push($(this).attr('data-id'));
    });

    if(allVals.length <=0)
    {
        swal({
            title: "",
            text: 'Please select',
            type: "info",    });
        return false;

    }else{
        var join_selected_values = allVals.join(",");
        var term_id = $('#schoolClassterm').val();
        var session_id = $('#schoolSessionId').val();
        var group_id = $('#attendanceGroup').val();
        if($('.allocate_all').length > 0){
            var token = $('input[name="student_ids"]').val(join_selected_values);

        }else{
            var token = $('input[name="student_ids"]').val($('#selected_student').val());

        }
        $('.class-term_id').val(term_id);
        $('.class-session_id').val(session_id);
        $('.class-group_id').val(group_id);
    }

});

$('.add_extra_title').on('click', function(e) {
    var allVals = [];
    $(".sub_chk:checked").each(function() {
        allVals.push($(this).attr('data-id'));
    });

    if(allVals.length <=0)
    {
        swal({
            title: "",
            text: 'Please select',
            type: "info",    });
        return false;

    }else{
        var join_selected_values = allVals.join(",");
        var term_id = $('#schoolClassterm').val();
        var session_id = $('#schoolSessionId').val();
        var group_id = $('#attendanceGroup').val();
        if($('.allocate_all').length > 0){
            var token = $('input[name="student_ids"]').val(join_selected_values);
        }else{
            var token = $('input[name="student_ids"]').val($('#selected_student').val());
        }
        $('.class-term_id').val(term_id);
        $('.class-session_id').val(session_id);
        $('.class-group_id').val(group_id);

        $(location).attr('href', 'extra_fee_title?studentIds='+join_selected_values+'&sessionId='+session_id+'&groupId='+group_id+'&termId='+term_id);
    }

});

$('.acknowledge_all').on('click', function(e) {
    e.preventDefault();
    var url =  $(this).attr('data-url');
    var type =  $(this).attr('data-type');
    var redirecttype =  $(this).attr('data-redirecttype');
    var allVals = [];
    $(".sub_chk:checked").each(function() {
        allVals.push($(this).attr('data-id'));
    });

    if(allVals.length <=0)
    {
        swal({
            title: "",
            text: 'Please select '+type,
            type: "info",    });
    }  else {
        // var check = confirm("Are you sure you want to delete this row?");
        swal({
                title: "Are you sure?",
                text: "Are you sure you want to acknowledge selected "+type+"s?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#F36820",
                confirmButtonText: "Yes, acknowledge it!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
            function(isConfirm){
                if (isConfirm) {

                    var join_selected_values = allVals.join(",");


                    $.ajax({
                        url: url,
                        type: 'POST',
                        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                        data: 'ids='+join_selected_values,
                        success: function (data) {
                            if (data['success']) {
                                $(".sub_chk:checked").each(function() {
                                    $(this).parents("tr").remove();
                                });
                                swal({
                                    title: "",
                                    text:'Selected rows Acknowledged Successfully',
                                    type: "success",    });

                            } else if (data['error']) {
                                swal({
                                    html: true,
                                    title: "",
                                    text: data['error'],
                                    type: "info",    });
                            } else {
                                swal({
                                    title: "",
                                    text: 'Whoops Something went wrong!!',
                                    type: "info",    });
                            }
                        },
                        error: function (data) {
                            // alert(data.responseText);
                        }
                    });


                    $.each(allVals, function( index, value ) {
                        $('table tr').filter("[data-row-id='" + value + "']").remove();
                    });
                } else {
                    swal("Cancelled", "Your data is safe :)", "error");
                }
                if(redirecttype=="admin"){
                    setTimeout(function(){location.href="/admin/leaves"} , 2000);
                }
                if(redirecttype=="teacher"){
                    setTimeout(function(){location.href="/teacher/leaves"} , 2000);
                }

            });
        return false;

    }
});



$(document).on('click','#sa-warning-parent','.sa-warning-parent',function(e){

    var id = $(this).attr('data-id');
    var userType = $(this).attr('data-userType');
    var url = $(this).attr('data-url');
    var message = $(this).attr('data-message');
    changeStatusParent(id,userType,message,url);


    return false;
});

// $('.promote_all, .allocate_all').on('click', function(e) {
//     var allVals = [];
//     $(".sub_chk:checked").each(function() {
//         allVals.push($(this).attr('data-id'));
//     });

//     if(allVals.length <=0)
//     {
//         swal({
//         title: "",
//         text: 'Please select',
//         type: "info",    });
//         return false;

//     }else{
//        var join_selected_values = allVals.join(",");
//        var term_id = $('#schoolClassterm').val();
//        var session_id = $('#schoolSessionId').val();
//        var group_id = $('#attendanceGroup').val();
//        var token = $('input[name="student_ids"]').val(join_selected_values);
//        $('.class-term_id').val(term_id);
//        $('.class-session_id').val(session_id);
//        $('.class-group_id').val(group_id);
//     }

// });


$('.delete_all').on('click', function(e) {
    e.preventDefault();
    var url =  $(this).attr('data-url');
    var type =  $(this).attr('data-type');
    var msg = $(this).attr('data-msg');
    if(typeof(msg) == 'undefined'){
        var msg = 'delete';
    }

    var allVals = [];
    $(".sub_chk:checked").each(function() {
        allVals.push($(this).attr('data-id'));
    });

    if(allVals.length <=0)
    {
        swal({
            title: "",
            text: 'Please select '+type,
            type: "info",    });
    } else {
        // var check = confirm("Are you sure you want to delete this row?");
        swal({
                title: "Are you sure?",
                text: "Are you sure you want to "+msg+" selected "+type+"s?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#F36820",
                confirmButtonText: "Yes, "+msg+" it!",
                closeOnConfirm: false,
                closeOnCancel: false,
                showLoaderOnConfirm: true
            },
            function(isConfirm){
                if (isConfirm) {
                    if(type == 'Grade'){
                        var join_selected_values = $('#selectedGrades').val();

                    }else{
                        var join_selected_values = allVals.join(",");

                    }

                    $.ajax({
                        url: url,
                        type: 'POST',
                        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                        data: 'ids='+join_selected_values,

                        success: function (data) {
                            // alert(JSON.stringify(data));
                            if (data['success']) {
                                $(".sub_chk:checked").each(function() {
                                    $(this).parents("tr").remove();
                                });
                                if(msg == 'publish' || msg == 'unpublish'){
                                    msg = msg+'e';
                                }
                                swal({
                                    title: "",
                                    text:'Selected rows '+msg+'d Successfully',
                                    type: "success",    });
                            }

                        },
                        complete: function(){
                            redirection(type);
                        },
                        error: function (data) {
                            // alert(data.responseText);
                        }
                    });


                    $.each(allVals, function( index, value ) {
                        $('table tr').filter("[data-row-id='" + value + "']").remove();
                    });
                } else {
                    swal("Cancelled", "Your data is safe :)", "error");
                    redirection(type);

                }

            });
        return false;

    }
});








function redirection(type){
    if(type=="teacher"){
        setTimeout(function(){location.href="/admin/teachers"} , 2000);
    }
    if(type=="Subadmin"){
        setTimeout(function(){location.href="/admin/subusers"} , 2000);
    }
    if(type=="Class"){
        setTimeout(function(){location.href="/admin/classes"} , 2000);
    }
    if(type=="Role"){
        setTimeout(function(){location.href="/admin/roles"} , 2000);
    }
    if(type=="Event"){
        setTimeout(function(){location.href="/admin/events"} , 2000);
    }
    if(type=="Link"){
        setTimeout(function(){location.href="/admin/links"} , 2000);
    }
    if(type=="Gallery"){
        setTimeout(function(){location.href="/admin/gallery"} , 2000);
    }
    if(type == 'Feed'){
        setTimeout(function(){location.href="/admin/feeds"} , 2000);
    }
    if(type == 'Fee Title'){
        setTimeout(function(){location.href="/admin/fee-titles"} , 2000);
    }
    if(type == 'Fee Plan'){
        setTimeout(function(){location.href="/admin/fee-plans"} , 2000);
    }
    if(type == 'Parent'){
        setTimeout(function(){location.href="/admin/parents"} , 2000);
    }
    if(type == 'Assessment'){
        setTimeout(function(){location.href="/admin/assessments"} , 2000);
    }
    if(type == 'Student'){
        setTimeout(function(){location.href="/admin/students"} , 2000);
    }
    if(type == 'Grade'){
        setTimeout(function(){location.href="/admin/grades"} , 2000);
    }
    if(type == 'Attendance'){
        setTimeout(function(){location.href="/admin/attendance"} , 2000);
    }
    if(type == 'Document'){
        setTimeout(function(){location.href="/admin/documents"} , 2000);
    }
    if(type == 'Enquiry'){
        setTimeout(function(){location.href="/admin/enquiries"} , 2000);
    }
    if(type == 'Leave'){
        setTimeout(function(){location.href="/admin/leaves"} , 2000);
    }
    if(type == 'Child-Leave'){
        setTimeout(function(){location.href="/parent/leaves"} , 2000);
    }
    if(type == 'Subadmin-Role'){
        setTimeout(function(){location.href="/superadmin/roles"} , 2000);
    }
    if(type == 'Sub-user'){
        setTimeout(function(){location.href="/superadmin/subusers"} , 2000);
    }
    if(type == 'School'){
        setTimeout(function(){location.href="/superadmin/schools"} , 2000);
    }
    if(type == 'Feed Data'){
        setTimeout(function(){location.href="/teacher/feeds"} , 2000);
    }
    if(type == 'Leave-teacher'){
        setTimeout(function(){location.href="/teacher/leaves"} , 2000);
    }
    if(type == 'ClassGroup'){
        setTimeout(function(){location.href="/admin/classGroups"} , 2000);
    }
    if(type == 'Session'){
        setTimeout(function(){location.href="/admin/sessions"} , 2000);
    }
    if(type == 'Skill'){
        setTimeout(function(){location.href="/admin/skills"} , 2000);
    }
    if(type == 'Affective Area'){
        setTimeout(function(){location.href="/admin/affective_areas"} , 2000);
    }
    if(type == 'Grade Attendance'){
        setTimeout(function(){location.href="/admin/grade_attendance"} , 2000);
    }
    if(type == 'Grade Skill'){
        setTimeout(function(){location.href="/admin/gradeskills"} , 2000);
    }
    if(type == 'Master Skill'){
        setTimeout(function(){location.href="/admin/masterskills"} , 2000);
    }
    if(type == 'parent'){
        setTimeout(function(){location.href="/admin/parents"} , 2000);
    }
    if(type == 'student'){
        setTimeout(function(){location.href="/admin/students"} , 2000);
    } if(type == 'data'){
        setTimeout(function(){location.href="/admin/feeReport"} , 2000);
    }
}


$('.delete_all_teacher').on('click', function(e) {
    e.preventDefault();
    var url =  $(this).attr('data-url');
    var type =  $(this).attr('data-type');
    var refreshurl = $(this).attr('data-refreshurl');
    var allVals = [];
    $(".sub_chk:checked").each(function() {
        allVals.push($(this).attr('data-id'));
    });

    if(allVals.length <=0)
    {
        swal({
            title: "",
            text: 'Please select '+type,
            type: "info",    });
    }  else {
        // var check = confirm("Are you sure you want to delete this row?");
        swal({
                title: "Are you sure?",
                text: "Are you sure you want to delete selected "+type+"s?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#F36820",
                confirmButtonText: "Yes, delete it!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
            function(isConfirm){
                if (isConfirm) {

                    var join_selected_values = allVals.join(",");


                    $.ajax({
                        url: url,
                        type: 'POST',
                        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                        data: 'ids='+join_selected_values,
                        success: function (data) {
                            // alert(JSON.stringify(data));
                            if (data['success']) {
                                $(".sub_chk:checked").each(function() {
                                    $(this).parents("tr").remove();
                                });
                                swal({
                                    title: "",
                                    text:'Selected rows Deleted Successfully',
                                    type: "success",    });

                            } else if (data['error']) {
                                swal({
                                    html: true,
                                    title: "",
                                    text: data['error'],
                                    type: "info",    });
                            } else {
                                swal({
                                    title: "",
                                    text: 'Whoops Something went wrong!!',
                                    type: "info",    });
                            }
                        },
                        error: function (data) {
                            // alert(data.responseText);
                        }
                    });


                    $.each(allVals, function( index, value ) {
                        $('table tr').filter("[data-row-id='" + value + "']").remove();
                    });
                } else {
                    swal("Cancelled", "Your data is safe :)", "error");
                }

                if(refreshurl != '' && typeof(refreshurl) != 'undefined'){
                    setTimeout(function(){location.href = refreshurl} , 2000);
                }else{
                    if(type=="Event"){
                        setTimeout(function(){location.href="/teacher/events"} , 2000);
                    }
                    if(type=="Note"){
                        setTimeout(function(){location.href="/teacher/lessonplans"} , 2000);
                    }
                    if(type == 'Feed'){
                        setTimeout(function(){location.href="/teacher/feeds"} , 2000);
                    }
                    if(type == 'Assessment'){
                        setTimeout(function(){location.href="/teacher/assessments"} , 2000);
                    }
                    if(type == 'Student'){
                        setTimeout(function(){location.href="/teacher/students"} , 2000);
                    }
                    if(type == 'Grade'){
                        setTimeout(function(){location.href="/teacher/grades"} , 2000);
                    }
                    if(type == 'Attendance'){
                        setTimeout(function(){location.href="/teacher/attendance"} , 2000);
                    }
                    if(type == 'Document'){
                        setTimeout(function(){location.href="/teacher/documents"} , 2000);
                    }
                    if(type == 'Comment Data'){
                        setTimeout(function(){location.href="/teacher/comments"} , 2000);
                    }

                }
            });
        return false;

    }

});
function checkfile(sender) {
    var validExts = new Array(".png", ".gif",".jpeg",".JPG",".jpg",".svg");
    var fileExt = sender.value;
    fileExt = fileExt.substring(fileExt.lastIndexOf('.'));

    if (validExts.indexOf(fileExt) < 0) {
        $("#input-file-now").val('');
        return false;
    }
}

function checkgradefile(sender) {
    var validExts = new Array(".csv");
    var fileExt = sender.value;
    fileExt = fileExt.substring(fileExt.lastIndexOf('.'));

    if (validExts.indexOf(fileExt) < 0) {
        $("#input-file-now").val('');
        return false;
    }



}

jQuery( function ( $ ) {
    var attachment = [];
    var show_images;
    // sa-confirm-button-container
    isNumber = function (evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode <= 45 || charCode > 57)) {
            return false;
        }
        return true;
    }

    dropzone_file_upload = function(el){

        var token = $('input[name="_token"]').val();
        Dropzone.autoDiscover = false;
        var myDropzone = new Dropzone("div#mydropzone", {
            url: "/admin/attachment_images",
            addRemoveLinks: true,
            acceptedFiles: "image/*,.xls,.xlsx,.csv,application/doc,application/pdf,application/txt,'text/csv,application/vnd.ms-excel',application/ppt,application/pptx,application/docx",
            dictRemoveFile: 'Remove',
            params: {
                _token: token
            },
            success: function(file,done) {
                attachment.push(done.success.original);
                $('#eventimages').val(attachment);
                this.emit('removedfile',file);
                var mockup = {name: done.success.original, size: done.success.size};
                this.emit('addedfile', mockup);

                var filename = (file.name); // Get extension
                var newimage = "";

                var filename = filename.toLowerCase();
                var ext = filename.split('.').pop();

                // Check extension
                if(ext != 'png' && ext != 'jpg' && ext != 'jpeg'){
                    newimage = "/images/contract.png"; // default image path

                    this.emit('thumbnail', mockup, newimage);
                }else{
                    this.emit('thumbnail', mockup, '/files/' + done.success.original);
                }

                this.emit('complete', mockup)
            },removedfile: function(file) {
                var _ref;
                if (file.previewElement) {
                    if ((_ref = file.previewElement) != null) {
                        _ref.parentNode.removeChild(file.previewElement);
                    }
                }
                var myString =  $(document).find('#eventimages').val().split(',');
                for( var i = 0; i < myString.length; i++){
                    if ( myString[i] === file.name) {
                        myString.splice(i, 1);
                    }
                }
                for( var i = 0; i < attachment.length; i++){
                    if ( attachment[i] === file.name) {
                        attachment.splice(i, 1);
                    }
                }
                $(document).find('#eventimages').val(myString.toString());
                var event_id = ($('input[name="event_id"]').val() !== undefined) ? $('input[name="event_id"]').val() : '';
                $.ajax({
                    type: 'POST',
                    url: '/admin/remove_images',
                    dataType: "json",
                    data: { FileName: file.name, _token: token, event_id: event_id },
                    success: function (result) {


                    }
                });

            }})
        $(el).each(function (key, value) {
            var file = {name: value.original, size: value.size};
            myDropzone.options.addedfile.call(myDropzone, file);

            var filename = (file.name); // Get extension
            var newimage = "";

            var filename = filename.toLowerCase();
            var ext = filename.split('.').pop();

            // Check extension
            if(ext != 'png' && ext != 'jpg' && ext != 'jpeg'){

                newimage = "/images/contract.png";
                myDropzone.options.thumbnail.call(myDropzone, file, newimage);

            }else{
                myDropzone.options.thumbnail.call(myDropzone, file, value.path);
            }

            myDropzone.emit("complete", file);
        });


    }

    if($(document).find('form').hasClass('uploadsFiles') == true){

        show_images = ($(this).find('input[name="show_exist_attachment"]').val() !== undefined) ? JSON.parse($(this).find('input[name="show_exist_attachment"]').val()) : '';
        dropzone_file_upload(show_images);
    }
});
jQuery( function ( $ ) {
    var attachment = [];
    var show_images;
    // sa-confirm-button-container
    isNumber = function (evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode <= 45 || charCode > 57)) {
            return false;
        }
        return true;
    }

    dropzone_file_upload2 = function(el){
        var token = $('input[name="_token"]').val();
        Dropzone.autoDiscover = false;
        var myDropzone = new Dropzone("div#myfeeddropzone", {
            url: "/admin/attachment_images",
            addRemoveLinks: true,
            acceptedFiles: "image/*",
            dictRemoveFile: 'Remove',
            params: {
                _token: token
            },
            success: function(file,done) {

                attachment.push(done.success.original);
                $('#feedimages').val(attachment);
                this.emit('removedfile',file);
                var mockup = {name: done.success.original, size: done.success.size};
                this.emit('addedfile', mockup);
                this.emit('thumbnail', mockup, '/files/' + done.success.original);
                this.emit('complete', mockup)
            },removedfile: function(file) {

                var _ref;
                if (file.previewElement) {
                    if ((_ref = file.previewElement) != null) {
                        _ref.parentNode.removeChild(file.previewElement);
                    }
                }
                var myString =  $(document).find('#feedimages').val().split(',');
                for( var i = 0; i < myString.length; i++){
                    if ( myString[i] === file.name) {
                        myString.splice(i, 1);
                    }
                }
                for( var i = 0; i < attachment.length; i++){
                    if ( attachment[i] === file.name) {
                        attachment.splice(i, 1);
                    }
                }
                $(document).find('#feedimages').val(myString.toString());
                var feed_id = ($('input[name="feed_id"]').val() !== undefined) ? $('input[name="feed_id"]').val() : '';
                $.ajax({
                    type: 'POST',
                    url: '/admin/remove_feedimages',
                    dataType: "json",
                    data: { FileName: file.name, _token: token, feed_id: feed_id },
                    success: function (result) {

                    }
                });
            }})
        $(el).each(function (key, value) {
            var file = {name: value.original, size: value.size};
            myDropzone.options.addedfile.call(myDropzone, file);
            myDropzone.options.thumbnail.call(myDropzone, file,  value.path);
            myDropzone.emit("complete", file);
        });


    }
    if($(document).find('form').hasClass('uploadsFeeds') == true){

        show_images = ($(this).find('input[name="show_exist_attachment"]').val() !== undefined) ? JSON.parse($(this).find('input[name="show_exist_attachment"]').val()) : '';
        dropzone_file_upload2(show_images);
    }
});

function readgradeURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();


        reader.readAsDataURL(input.files[0]);
        var form_data = new FormData();

        if($('#gradeClassIdTeacher').length > 0){
            var class_id = $('#gradeClassIdTeacher').val();
        }else{
            var class_id = $('#gradeClassId').val();
        }
        if($('#gradeSessionId').length > 0){
            var session_id = $('#gradeSessionId').val();
        }else{
            var session_id = $('#sessio').val();
        }
        var term_id = $('#term').val();
        var subject_id = $('#subject').val();

        var csrf_token = $('meta[name=csrf-token]').attr('content');
        var file_data = $('#inputGradeFile').prop('files')[0];
        form_data.append('file', file_data);
        form_data.append('_token', csrf_token);
        form_data.append('class_id', class_id);
        form_data.append('session_id', session_id);
        form_data.append('term_id', term_id);
        form_data.append('subject_id', subject_id);


        $.ajax({
            url:"/admin/importGrades",
            data: form_data,
            type: 'POST',
            contentType: false, // The content type used when sending data to the server.
            cache: false, // To unable request pages to be cached
            processData: false,
            beforeSend: function(){
                $('#loader').show();
            },
            complete: function(){
                $('#loader').hide();
            },
            success: function (res) {


                if(res){
                    if (res['html']) {

                        $('#studentDetail').html('');
                        $('#studentDetail').append(res['html']);
                    }
                }


            },
            error: function (err) {


            }
        });

    }
}

$(document).on('change','#inputGradeFile',function(e){

    readURL(this);
});

$(document).on('change','#studentSession, #studentClass', function(e){
    var session_id = $('#studentSession').val();
    var class_id = $('#studentClass').val();
    var token = $('input[name="_token"]').val();


    $.ajax({
        type: 'POST',
        url: '/admin/classPlans',
        data: { session_id: session_id, class_id: class_id, _token: token },
        beforeSend: function(){
            $('#student_loader').show();
        },
        complete: function(){
            $('#student_loader').hide();
        },

        success:function(res){

            if(res['html']){

                $("#allocatePlan").empty();
                $("#allocatePlan").append(res['html']);
                $('.selectpicker').selectpicker('refresh');

                $('.due_date').datepicker({
                    minDate: new Date(2020, 28 - 1, 25),
                    dateFormat: 'yy-mm-dd',
                    changeMonth: true,
                    changeYear: true
                });


            }else{
                $("#allocatePlan").empty();
            }


        }
    });

});

$('#country').change(function(){
    var countryID = $(this).val();
    var token = $('input[name="_token"]').val();
    if(countryID){
        $.ajax({
            type: 'POST',
            url: '/admin/states',
            data: { country_id: countryID, _token: token },
            beforeSend: function(){
                $('#student_loader').show();
            },
            complete: function(){
                $('#student_loader').hide();
            },

            success:function(res){

                if(res){

                    $("#state").empty();
                    $("#state").append(res);
                    $('.selectpicker').selectpicker('refresh');


                }else{
                    $("#state").empty();
                }
            }
        });
    }else{
        $("#state").empty();
        $("#city").empty();
    }
});

$('#state').on('change',function(){
    var stateID = $(this).val();
    var token = $('input[name="_token"]').val();

    if(stateID){
        $.ajax({
            type: 'POST',
            url: '/admin/cities',
            // dataType: "json",
            data: { state_id: stateID, _token: token },
            beforeSend: function(){
                $('#student_loader').show();
            },
            complete: function(){
                $('#student_loader').hide();
            },

            success:function(res){
                if(res){
                    $("#city").empty();
                    $("#city").append(res);
                    $('.selectpicker').selectpicker('refresh');
                }else{
                    $("#city").empty();
                }
            }
        });
    }else{
        $("#city").empty();
    }
});


    $('#gradeClassId').change(function(){
    var class_id = $(this).val();
    var session_id = $('#gradeSessionId').val();
    var token = $('meta[name=csrf-token]').attr('content');
    var term_id = $('#term').val();

    if(class_id ){

        $.ajax({
            type: 'POST',
            url: '/admin/classData',
            async:false,
            dataType: "json",
            data: { class_id: class_id, _token: token },
            beforeSend: function(){
                $('#loader-2').show();
            },
            complete: function(){
                $('#loader-2').hide();
            },

            success:function(res){
                if(res){
                    if (res['teachers']) {

                        $("#subject").html('<option value="">Select Subject</option>');
                        $('#subject').prop("disabled", true);

                        $.each(res['teachers'],function(key,value){
                            $("#subject").append('<option value="'+key+'">'+value+'</option>');
                            $('#subject').removeAttr("disabled");
                            $('#subject').selectpicker('refresh');

                        });
                        $('#subject').selectpicker('refresh');

                    }


                }

            }

        });
    }else{
        $("#subject").html('<option value="">Select Subject</option>');
        $('#subject').attr("disabled");
        $('#subject').selectpicker('refresh');



    }
    getstudents();

});

$('#gradeskillClassId, #gradeskillTerm, #gradeSessionId').change(function(){
    var class_id = $('#gradeskillClassId').val();
    var session_id = $('#gradeSessionId').val();
    var token = $('meta[name=csrf-token]').attr('content');
    var term_id = $('#gradeskillTerm').val();
    var group_id = $('#attendanceGroup').val();

    if(class_id != '' && group_id != '' && term_id != '' && session_id != ''){

        $.ajax({
            type: 'POST',
            url: '/admin/classSubjectData',
            // async:false,
            dataType: "json",
            data: { class_id: class_id, session_id: session_id,term_id:term_id, group_id: group_id, _token: token },
            beforeSend: function(){
                $('#loader-2').show();
            },
            complete: function(){
                $('#loader-2').hide();
            },

            success:function(res){

                if(res){
                    if (res['html']) {
                        $(".subjectskills").html(res['html']);

                    }
                }


            },error: function(err){


            }
        });
    }else{
        $(".subjectskills").html('');
    }

});
$('#masterskillClassId, #masterSessionId').change(function(){
    var class_id = $('#masterskillClassId').val();
    var session_id = $('#masterSessionId').val();
    var token = $('meta[name=csrf-token]').attr('content');
    // var term_id = $('#term').val();
    var group_id = $('#attendanceGroup').val();

    if(class_id != '' && group_id != '' && session_id != ''){

        $.ajax({
            type: 'POST',
            url: '/admin/getMasterSubjects',
            // async:false,
            dataType: "json",
            data: { class_id: class_id, session_id: session_id, group_id: group_id, _token: token },
            beforeSend: function(){
                $('#loader-2').show();
            },
            complete: function(){
                $('#loader-2').hide();
            },
            success:function(res){

                if(res){
                    if (res['html']) {
                        $(".subjectskills").html(res['html']);

                    }


                }

            },error: function(err){

            }
        });
    }else{
        $(".subjectskills").html('');
    }

});

$('#teachergradeskillClassId').change(function(){
    var class_id = $(this).val();
    var session_id = $('#gradeSessionId').val();
    var token = $('meta[name=csrf-token]').attr('content');

    var term_id = $('#term').val();
    var group_id = $('#teacherattendanceGroup').val();
    if(class_id != '' && group_id != '' && term_id != '' && session_id != ''){

        $.ajax({
            type: 'POST',
            url: '/teacher/classSubjectData',
            dataType: "json",
            data: { class_id: class_id, session_id: session_id,term_id:term_id, group_id: group_id, _token: token },
            beforeSend: function(){
                $('#loader-2').show();
            },
            complete: function(){
                $('#loader-2').hide();
            },

            success:function(res){

                if(res){
                    if (res['html']) {
                        $(".subjectskills").html(res['html']);

                    }

                }
            },error: function(err){

            }
        });
    }else{
        $(".subjectskills").html('');
    }

});

$('#gradeFilterSessionId, #schoolSessionId').change(function(){
    if($('#schoolSessionId').length > 0){
        var session_id = $('#schoolSessionId').val();
    }else{
        var session_id = $('#gradeFilterSessionId').val();
    }


    var token = $('input[name="_token"]').val();
    $.ajax({
        type: 'POST',
        url: '/admin/classData',
        async: false,
        dataType: "json",
        data: { session_id:session_id, _token: token , filter:1},

        success:function(res){
            if(res){
                if (res['termhtml']) {



                    $("#term").html(res['termhtml']);
                    $('#term').removeAttr("disabled");
                    $('#term').selectpicker('refresh');


                }
            }

        }, error: function(err){

        }

    });

});

$('#gradeSessionId, #sessio').change(function(){

    var session_id = $(this).val();

    var token = $('input[name="_token"]').val();

    if( session_id != ''){

        $.ajax({
            type: 'POST',
            url: '/admin/classData',
            async: false,
            dataType: "json",
            data: { session_id:session_id, _token: token },


            success:function(res){
                if(res){
                    if (res['termhtml']) {
                        $("#term").html(res['termhtml']);
                        $('#term').removeAttr("disabled");
                        $('#term').selectpicker('refresh');
                    }
                }


            }

        });
    }else{
        $(this).parent().find('.with-errors').html('This field is required.');

        $("#subject").html('<option value="">Select Subject</option>');
        $('#subject').attr("disabled");
        $('#subject').selectpicker('refresh');

        $("#term").html('<option value="">Select Term</option>');
        $('#term').attr("disabled");
        $('#term').selectpicker('refresh');

    }
    getstudents();
});

if($('#gradeClassIdTeacher').length > 0 && $('#gradeClassIdTeacher').hasClass('gradeClassIdTeacher') == true){

    if($('#gradeClassIdTeacher option').length == 2){
        $('#gradeClassIdTeacher option[value="'+$('#gradeClassIdTeacher').data('classteacherid')+'"]').prop('selected','true');
        $('#gradeClassIdTeacher').selectpicker('refresh');
        var class_id = $('#gradeClassIdTeacher').data('classteacherid');

        var session_id = $('#gradeSessionId').val();

        var token = $('input[name="_token"]').val();
        var panel = 'teacher' ;
        if($('.admin_add_lession').length){
            panel = 'admin' ;
        }
        if(class_id){
            $.ajax({
                type: 'POST',
                url: '/'+panel+'/classData',
                dataType: "json",
                data: { class_id: class_id, _token: token, session_id: session_id},
                beforeSend: function(){
                    $('#loader-2').show();
                },
                complete: function(){
                    $('#loader-2').hide();
                },

                success:function(res){
                    if(res){
                        if (res['teachers']) {

                            $("#subject").html('<option value="">Select Subject</option>');
                            $('#subject').prop("disabled", true);
                            $.each(res['teachers'],function(key,value){
                                $("#subject").append('<option value="'+key+'">'+value+'</option>');
                                $('#subject').removeAttr("disabled");
                                $('#subject').selectpicker('refresh');
                            });
                            $('#subject').selectpicker('refresh');

                        }
                    }

                }

            });
        }else{
            $("#subject").html('<option value="">Select Subject</option>');
            $('#subject').attr("disabled");

            $('#subject').selectpicker('refresh');
        }
    }


}

$('#aniimated-thumbnials').lightGallery({
    thumbnail:true
});

$('#gradeClassIdTeacher').change(function(){
    var class_id = $(this).val();
    var length= $('select[name=session]').length;
    if(length != 0){
        var session_id = $('select[name=session]').val();

    }else{
        var session_id = $('select[name=session_id]').val();

    }
    var token = $('input[name="_token"]').val();

    var panel = 'teacher' ;

    if($('.admin_add_lession').length){
        panel = 'admin' ;
    }
    if(class_id){
        $.ajax({
            type: 'POST',
            async: false,
            url: '/'+panel+'/classData',
            dataType: "json",
            data: { class_id: class_id, _token: token,session_id: session_id},
            beforeSend: function(){

                $('#loader-2').show();
            },
            complete: function(){
                $('#loader-2').hide();
            },

            success:function(res){

                if(res){
                    if (res['teachers']) {

                        $("#subject").html('<option value="">Select Subject</option>');
                        $('#subject').prop("disabled", true);

                        $.each(res['teachers'],function(key,value){
                            $("#subject").append('<option value="'+key+'">'+value+'</option>');
                            $('#subject').removeAttr("disabled");
                            $('#subject').selectpicker('refresh');
                        });
                        $('#subject').selectpicker('refresh');

                    }

                }

            }

        });
    }else{
        $("#subject").html('<option value="">Select Subject</option>');
        $('#subject').attr("disabled");
        $('#subject').selectpicker('refresh');


    }
    getstudents();


});

$('#gradeTeacherIdAdmin').change(function(){
    var teacher_id = $(this).val();
    var length= $('select[name=session]').length;
    if(length != 0){
        var session_id = $('select[name=session]').val();

    }else{
        var session_id = $('select[name=session_id]').val();
    }
    var token = $('input[name="_token"]').val();
    if(teacher_id){
        $.ajax({
            type: 'POST',
            url: '/admin/teacherClass',
            dataType: "json",
            data: { teacher_id: teacher_id, _token: token,session_id: session_id},

            success:function(res){
                if (res.html) {

                    $("#gradeClassIdTeacher").html(res.html);
                    $('#gradeClassIdTeacher').prop("disabled", false);
                    $('#gradeClassIdTeacher').selectpicker('refresh');
                }
            }

        });
    }else{
        $("#gradeClassIdTeacher").html('<option value="">Select Class</option>');
        $('#gradeClassIdTeacher').attr("disabled");
        $('#gradeClassIdTeacher').selectpicker('refresh');
    }

});

// $('body').on('change','.classid',function(){
$(document).on('change','select.classid',function(e){
    var row = $(this).parent().parent().closest('tr');

    var class_id = $(this).val();

    var token = $('input[name="_token"]').val();

    if(class_id){

        $.ajax({
            type: 'POST',
            url: '/admin/studentsData',
            dataType: "json",
            data: { class_id: class_id, _token: token },

            success:function(res){

                if(res){
                    row.find('select.student').html('<option value="">Select Child</option>');
                    $.each(res,function(key,value){
                        row.find('select.student').append('<option value="'+key+'">'+value+'</option>');
                    });
                    row.find('select.student').selectpicker('refresh');
                }else{
                    row.find('select.student').append('<option value="">Select Child</option>');

                }
            }

        });
    }else{
        row.find('select.student').html('');
        row.find('select.student').html('<option value="">Select Child</option>');

    }
});

$('body').on('change',' #schoolSessionId',function(){

    var class_arm_id = '';
    var class_id = $('#schoolClassId').val();
    if($('#class_arm_id').length > 0){
        var class_arm_id = $('#class_arm_id').val();

    }
    if($('#attendanceGroup').length > 0){
        var group_id = $('#attendanceGroup').val();
    }  if($('#teacherattendanceGroup').length > 0){
        var group_id = $('#teacherattendanceGroup').val();
    }
    var session_id = $(this).val();
    var token = $('input[name="_token"]').val();

    if(session_id &&class_id != ''){
        $('#batchca').prop('disabled', false);
        $.ajax({
            type: 'POST',
            url: '/admin/getreportstudents',
            dataType: "json",

            data: { class_id: class_id,class_arm_id:class_arm_id, session_id: session_id, group_id:group_id,_token: token },
            success:function(res){

                $('#schoolChildId').removeAttr("readOnly");
                $('#schoolChildId').prop("readOnly",false);
                if(res['students']){
                    var html='<option value="">Select Student</option>';
                    $.each(res['students'],function(key,value){




                        html += '<option value="'+key+'">'+value+'</option>';
                    });

                    $('#schoolChildId').show();
                    $('#schoolChildId').addClass('selectpicker');
                    $('#schoolChildId').html(html);
                    $("#schoolChildId").attr('required',true);
                    $("#schoolChildId").selectpicker('refresh');
                }else{

                    $('#schoolChildId').html('<option value="">Select Student</option>');
                    $("#schoolChildId").selectpicker('refresh');

                }

            },error:function(err){


            }
        });
        if($('#planClassId').length >1){
            var termtype = 1;
        }else{
            var termtype = 0;
        }

        $.ajax({
            type: 'POST',
            url: '/admin/classData',
            // dataType: "json",
            data: { class_id: class_id, session_id:session_id,termtype:termtype, _token: token },


            success:function(res){
                if(res){
                    if (res['termhtml']) {

                        if($('#planClassId').length >0 || $('#assessmentGrades').length >0){

                            $("#schoolClassterm").html('<option value="" selected>Select Term</option>'+res['termhtml']);
                            $('select#schoolClassterm').removeAttr("selected");

                            $("select#schoolClassterm").prop('selected', false);
                        }else{

                            if($('#reportTypeDiv').length > 0 || $('#reportType').length > 0){
                                $("#schoolClassterm").html(res['termhtml']+' <option value="all">Session Report</option>');

                            }else{
                                if($('#term').length > 0){
                                    $("#term").html(res['termhtml']+' <option value="all">All Term</option>');
                                }else{
                                    $("#schoolClassterm").html(res['termhtml']+' <option value="all">All Term</option>');

                                }

                            }



                        }

                        $('#schoolClassterm').selectpicker('refresh');
                    }


                }

            }, error: function(err){

            }

        });
    }else{


        $("#schoolClassterm").html('<option value="">Select Term</option>');
        $('#schoolClassterm').selectpicker('refresh');

    }
    $('#batchca').selectpicker('refresh');


});

$('body').on('change','#schoolClassId, #planClassId',function(){
    var group_id = '';
    var class_arm_id = '';
    if($('#planClassId').length > 0){
        var type = 0;
        var class_id = $('#planClassId').val();
    }else{
        var type = 1;
        var class_id = $('#schoolClassId').val();
    }

    var session_id = $('#schoolSessionId').val();
    var token = $('input[name="_token"]').val();

    if($('#attendanceGroup').length > 0){
        var group_id = $('#attendanceGroup').val();
    }
    if($('#teacherattendanceGroup').length > 0){
        var group_id = $('#teacherattendanceGroup').val();
    }
    if($('#class_arm_id').length > 0){
        var class_arm_id = $('#class_arm_id').val();
    }if($('#student_class_arm_id').length > 0){
        var class_arm_id = $('#student_class_arm_id').val();
    }

    if(class_id){
        $.ajax({
            type: 'POST',
            url: '/admin/getreportstudents',
            dataType: "json",
            data: { class_id: class_id, class_arm_id: class_arm_id, session_id:session_id,_token: token, group_id: group_id,type:type },

            success:function(res){

                $('#schoolChildId').removeAttr("readOnly");
                $('#schoolChildId').prop("readOnly",false);

                if(res['students']){
                    var html='';
                    if($('.student-plan-data').length > 0){
                        var html='<option value="">Select Student</option>';

                    }

                    $.each(res['students'],function(key,value){
                        html += '<option value="'+key+'">'+value+'</option>';
                    });

                    $('#schoolChildId').show();
                    $('#schoolChildId').addClass('selectpicker');
                    $('#schoolChildId').html(html);
                    $("#schoolChildId").attr('required',true);
                    $("#schoolChildId").selectpicker('refresh');
                }else{

                    $('#schoolChildId').html('<option value="">Select Student</option>');
                    $("#schoolChildId").selectpicker('refresh');

                }
                if($('.arm_option').length > 0){
                    if(res['count'] >= 1){
                        $('.arm_option').show();
                    }else{
                        $('.arm_option').hide();

                    }
                }
                $('input[name="class_arm_id"]').val(res['class_arm_id']);
            },error:function(err){


            }
        });

    }else{
        $('#schoolChildId').html('<option value="">Select Student</option>');
        $("#schoolChildId").selectpicker('refresh');




    }
});
$('body').on('change','#parentClassId',function(){

    var class_id = $(this).val();
    var session_id = '';
    if($('select[name="session_id"]').length > 0){
        var session_id = $('select[name="session_id"]').val();

    }


    var token = $('input[name="_token"]').val();

    if(class_id){
        $.ajax({
            type: 'POST',
            url: '/parent/getreportstudents',
            dataType: "json",

            data: { class_id: class_id, session_id:session_id, _token: token },




            success:function(res){

                $('#parentChildId').removeAttr("readOnly");
                $('#parentChildId').prop("readOnly",false);


                if(res['students']){

                    var html='';
                    $.each(res['students'],function(key,value){
                        html += '<option value="'+key+'">'+value+'</option>';
                    });

                    $('#parentChildId').show();
                    $('#parentChildId').addClass('selectpicker');
                    $('#parentChildId').html(html);
                    $("#parentChildId").attr('required',true);
                    $("#parentChildId").selectpicker('refresh');
                }else{

                    $('#parentChildId').html('<option value="">Select Student</option>');
                    $("#parentChildId").selectpicker('refresh');

                }
                if(res['format'] == 'nursery'){
                    $('.caType').hide();
                    $("#parentClassterm option[value='all']").remove();
                }else{
                    $('.caType').show();
                    if($("#parentClassterm option[value='all']").length == 0){
                        $('#parentClassterm').append(new Option('Session Report', 'all'));
                    }
                }
                $("#parentClassterm").selectpicker('refresh');


            },error:function(err){



            }
        });

    }else{



        $('#parentChildId').html('<option value="">Select Child</option>');
        $("#parentChildId").selectpicker('refresh');
    }
});

$('body').on('change','#teacherClassId',function(){

    var class_id = $(this).val();
    var group_id = '';


    var session_id = $('#teacherSession').val();
    var token = $('input[name="_token"]').val();
    if($('#teacherattendanceGroup').length > 0){
        var group_id = $('#teacherattendanceGroup').val();
    }

    if(class_id){
        $.ajax({
            type: 'POST',
            url: '/teacher/getreportstudents',
            dataType: "json",
            data: { class_id: class_id, session_id: session_id, _token: token,group_id:group_id },

            success:function(res){
                $('#teacherChildId').removeAttr("readOnly");
                $('#teacherChildId').prop("readOnly",false);
                if(res['students']){

                    var html='';
                    $.each(res['students'],function(key,value){
                        html += '<option value="'+key+'">'+value+'</option>';
                    });

                    $('#teacherChildId').show();
                    $('#teacherChildId').addClass('selectpicker');
                    $('#teacherChildId').html(html);
                    $("#teacherChildId").attr('required',true);
                    $("#teacherChildId").selectpicker('refresh');
                }else{

                    $('#teacherChildId').html('<option value="">Select Student</option>');
                    $("#teacherChildId").selectpicker('refresh');

                }
                if($('.arm_option').length > 0){
                    if(res['count'] >= 1){
                        $('.arm_option').show();
                    }else{
                        $('.arm_option').hide();

                    }

                }

            },error:function(err){
                // alert('errorr');


            }
        });


    }else{
        $('#teacherClassterm').html('<option value="">Select Term</option>');
        $('#teacherClassterm').selectpicker('refresh');

        $('#teacherChildId').html('<option value="">Select Child</option>');
        $("#teacherChildId").selectpicker('refresh');
    }

});

$('body').on('change','#teacherSession',function(){

    var session_id = $('#teacherSession').val();

    var token = $('input[name="_token"]').val();
    if(session_id){
        $("#batchca").prop('disabled', false);
        $.ajax({
            type: 'POST',
            url: '/teacher/getTerms',
            // dataType: "json",
            data: { session_id: session_id, _token: token },

            success:function(res){

                $('#teacherClassterm').removeAttr("readOnly");
                $('#teacherClassterm').prop("readOnly",false);

                if(res){

                    $('#teacherClassterm').show();
                    $('#teacherClassterm').addClass('selectpicker');
                    $('#teacherClassterm').html(res+'<option value="all">Final Term</option>');
                    $("#teacherClassterm").attr('required',true);
                    $("#teacherClassterm").selectpicker('refresh');
                }else{
                    $('#teacherClassterm').html('<option value="">Select Student</option>');
                    $("#teacherClassterm").selectpicker('refresh');
                }

            },error:function(err){


            }
        });
    }else{

        $('#teacherClassterm').html('<option value=""> Select Term</option>');
        $("#teacherClassterm").attr('required',true);
        $("#teacherClassterm").selectpicker('refresh');
    }
    $("#batchca").selectpicker('refresh');

});


$(document).on('click','#parentAllocation',function(e){
    var student_id = $(this).attr('data-studentId');
    $('input[name="student_id"]').val(student_id);
});
$(document).on('click','#planAllocation',function(e){
    var plan_id = $(this).attr('data-planId');
    $('input[name="plan_id"]').val(plan_id);
});


$(document).on('click','#promoteStudent',function(e){
    var student_id = $(this).attr('data-studentId');
    $('input[name="student_id"]').val(student_id);

});
$(document).on('click','#statusChange',function(e){
    var student_id = $(this).attr('data-studentId');
    $('#statuschange_student_id').val(student_id);

});
$(document).on('click','#previousReport',function(e){
    var student_id = $(this).attr('data-studentId');
    $('input[name="student_id"]').val(student_id);

});

$(document).on('click','.allocateStudent',function(e){
    var request_id = $(this).attr('data-id');
    $('input[name="parent_request"]').val(request_id);

});
//Superadmin pending request modal
$(document).on('click','.requestSummary',function(e){
    var studentcount = $(this).attr('data-studentcount');
    var currency = $(this).attr('data-currency');
    var contactNumber = $(this).attr('data-contactNumber');
    var duration = $(this).attr('data-duration');
    $('#requeststudentcount').text(studentcount);
    $('#requestcontactNumber').text(contactNumber);
    $('#requestcurrency').text(currency);
    $('#requestduration').text(duration);

});
$(document).ready(function(){
    $('.viewDetail').click(function(){
        window.location= $(this).data('url');
    });

});


$(document).on('click','#paymentLoader',function(e){
    $('#loader').show();
});


$(document).on('keyup', 'form input[type="text"], form input[type="email"], form input[type="password"], form textarea', function(event){
    if($(this).hasClass('is-invalid') == true  || $(this).hasClass('form-control') == true ){
        $('span.invalid-feedback').remove();
    }
});


$("#teacherGradevalidate").on("submit", function(e) {

    var validateMarks = 0;
    $( ".validateMarks" ).each(function() {

        var float= /^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/;
        var a = $(this).val();
        if($(this).val()!='' && $(this).val() != 'Optional'){
            if (float.test(a)) {

            }
            //if it's NOT valid
            else {

                validateMarks=1;
                $(this).parent().find('div.with-errors').html('Please enter numeric or float value.');
                event.preventDefault();

            }
        }

        var totalMarks =parseFloat($(this).attr('max'));
        var minMarks =parseFloat($(this).attr('min'));
        var thisValue =parseFloat($(this).val());

        if(thisValue > totalMarks){
            validateMarks=1;

            $(this).parent().find('div.with-errors').html('Please enter marks less than total.');
            event.preventDefault();
        }

    });

    if(validateMarks==1){

        return false;
    }else{
        return true;
    }


});
function generateUniqueRef() {
    var min = 10000000000000;
    var max = 99999999999999;
    var transRef = (Math.random() * (max - min) + min);
    transRef = Math.round(transRef);
    return transRef.toString(); //var reqRef = transRef + '01';
}
function PayGatePlus(meta, total, transRef, customer) {
    var handler = OnePipePopup.setup({
        requestData: {
            request_ref: transRef,//generate a unique number
            request_type: 'charge',
            api_key: '1fURIGbfsDiFoIRdzys9_4344e0e47b26474ea32b7b8d2c4e1e12', //merchant PayGatePlu API Key
            auth_provider: null,
            transaction: {
                amount: total, //amount must be in kobo without decimal places
                currency: "NGN",
                transaction_ref: transRef,//generate a unique number
                transaction_desc: 'demo payment',
                customer: customer
            },
            options:{
                close_popup: {
                    card : "onSuccess"
                },
                meta: meta

            }
        },
        callback: function (response) {

            //let's log the response
            // console.log(response);

            // Contents of data is based on what PayGatePlus returns
            let message = (response.message || response.data.message),
                reference = response.reference,
                status = response.status,
                parentTransRef = response.parentTransRef,
                transRef = response.transRef,
                paymentmethod = response.paymentmethod,
                optionsTransRef = response.optionsTransRef,
                data = response.data,
                provider_response_code = data.provider_response_code,
                provider = data.provider,
                charge_status = data.charge_status;

            if(data.error){
                $('#loader').show();
                setTimeout(function(){location.href="/parent/payNow/"} , 2000);

                error = data.error,
                    error_code = error.code,
                    error_message = error.message;
            }else{
                $('#loader').show();
                setTimeout(function(){location.href="/parent/feeupdate/"+response.reference} , 2000);
            }


            //lets just see what's passed
            var feedback = '';
            feedback += "payment method: " + paymentmethod + "\n";
            feedback += "message: " + message + "\n";
            feedback += "reference: " + reference + "\n";
            feedback += "status: " + status + "\n";
            feedback += "parentTransRef: " + parentTransRef + "\n";
            feedback += "transRef: " + transRef + "\n";

            return feedback;
            // alert(feedback);
        },
        onClose: function () {
            $('#loader').show();

            setTimeout(function(){location.href="/parent/depositFee/"} , 1000);
            // alert('You cancelled the payment process');
        }
    });

    handler.execute();

}

$("#feevalidate, #depositFee").on("submit", function(e) {
    // e.preventDefault();
    var validateFee = 0;
    $( ".amount-paid" ).each(function() {
        var float= /^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/;
        var a = $(this).val();
        if($(this).val()!='' && $(this).val() != 'Optional'){
            if (float.test(a)) {

            }
            //if it's NOT valid
            else {

                validateFee=1;
                $(this).parent().find('div.with-errors').html('Please enter numeric or float value.');
                event.preventDefault();
            }
        }
        var total =parseFloat($(this).attr('max'));
        var minMarks =parseFloat($(this).attr('min'));
        var thisValue =parseFloat($(this).val());
        if(isNaN(thisValue)){
            validateFee=1;
            $(this).val('0');

            // $(this).parent().find('div.with-errors').html('Please enter amount.');
            // event.preventDefault();
        }else{
            if(thisValue > total){
                validateFee=1;
                $(this).parent().find('div.with-errors').html('Please enter amount less than '+total+'.');
                event.preventDefault();
            }
        }
    });

    if(validateFee==1){
        return false;

    }else{
        if($('#depositFee').length > 0){
            var total = 0;
            var error = 0;
            if($(".amount-paid").length>0){
                $(".amount-paid").each(function() {
                    var paid_amount = $(this).val();
                    if(paid_amount != ''){
                        total+=parseFloat(paid_amount);
                    }

                });
                if(total < 100){
                    $('.feetotal-error_msg').show();
                    $('.errormsg').html('Total School Fees Amount To Be Paid should be greater than or equal to 100');
                    setTimeout(function() {
                        $('.feetotal-error_msg').fadeOut('fast');
                    }, 2000);
                    error+=1;
                    e.preventDefault();
                }
            }else{
                var term = $('select.studentSessionterm').find('option:selected').val();
                if(term == ''){
                    error+=1;

                    e.preventDefault();

                    $('.feetotal-error_msg').show();
                    $('.errormsg').html('Please select data');
                    setTimeout(function() {
                        $('.feetotal-error_msg').fadeOut('fast');
                    }, 2000);
                }else{

                }
            }
            if(error == 0){
                var reference = generateUniqueRef();
                var gateway = $('input[name="online_gateway"]').val();
                if(gateway == 'paygate'){
                    e.preventDefault();

                    $.ajax({
                        type: 'POST', // For jQue
                        url: '/parent/paygate_depostfee',
                        data: $('#depositFee').serialize()+'&reference='+reference,
                        success: function (result) {
                            feedback = PayGatePlus(result['subaccounts'], result['total'], reference, result['customer']);
                        }
                    });
                }
            }else{
                console.log('errorplus');
            }
        }else{
            console.log('lengthelse');

        }

        return true;
    }

});




function isNumber(evt) {
    evt = (evt) ? evt : window.event;
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    return true;
}
function isGradeNumber(evt) {
    evt = (evt) ? evt : window.event;

    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if(charCode!= 46){
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
    }

    return true;
}


$(document).on('keyup keypress', '.validateMarks', function(eve){
    $( this ).parent().find('div.with-errors').text('');
    var key = $(this).attr('data-student');
    var total = 0;
    var avg_ca = [];

    $(".studentMarks-"+key).each(function() {
        if($(this).val() != '' && $(this).val() != 'Optional'){
            if($(this).data('average'))
                avg_ca.push(parseFloat($(this).val()));
            else
                total+=parseFloat($(this).val());
        }
    });

    if(avg_ca.length > 0)
        total += Math.round(avg_ca.reduce(function(acc,val) {return acc+val})/avg_ca.length);

    $('.studentTotalMarks-'+key).html(total);
    if (eve.keyCode === 46 && this.value.split('.').length >= 2) {
        return false;
    }
});
$(document).on('keyup', '.gradetotalMarks', function(eve){
    var this_ = this;
    var avg_ca_inputs = []
    if (eve.keyCode === 46 && this.value.split('.').length >= 2) {
        return false;
    }
    var total = 0;
    $(".gradetotalMarks").each(function() {
        if($(this).val() != ''){
            if($(this).data('average')) {
                var type = $(this).parent().parent().prev().find('.typeselect')
                if(type.val() == 'CA')
                    avg_ca_inputs.push($(this))
                else
                    total+=parseFloat($(this).val());
            }
            else
                total+=parseFloat($(this).val());
        }
    });
    if(avg_ca_inputs.length > 0 && $('#avg-ca-input').val().trim() !== '')
        total += parseInt($('#avg-ca-input').val())

    if(total > 100){
        $( this_ ).val('');
        $( this_ ).parent().find('.with-errors').text('Total marks of all grades should be equal to 100.');
        return false;
    }else{
        $( this_ ).parent().find('.with-errors').text('');
    }
});

$(document).on('keyup', '.midtermtotalMarks', function(eve) {
    var this_ = this;
    if (eve.keyCode === 46 && this.value.split('.').length >= 2) {
        return false;
    }
    // var caName = $(this).parentsUntil('.midtermgrade-row').parent().first().find('.midterm-input').val();
    // var caRef = $(this).parent().parent().prev().find('.ca-select option:selected').text();
    // $(".midtermtotalMarks").each(function() {
    //     var checkRef = $(this).parent().parent().prev().find('.ca-select option:selected').text();
    //     if(checkRef == caRef) {
    //         if($(this).val() != '') {
    //             total+=parseFloat($(this).val());
    //         }
    //     }
    // });
    var total = 0;
    $(".midtermtotalMarks").each(function() {
        if($(this).val() != '') {
            total+=parseFloat($(this).val());
        }
    });
    if(total > 100){
        $( this_ ).val('');
        $( this_ ).parent().find('.with-errors').text('Total marks of the midterms should be equal to 100.');
        return false;
    }else{
        $( this_ ).parent().find('.with-errors').text('');
    }
    $('#caTotals').html(total)
});


$(document).on('change keyup keypress paste', '.number',function (event) {
    if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
        event.preventDefault();
    }
    var input = $(this).val();
    if ((input.indexOf('.') != -1) && (input.substring(input.indexOf('.')).length > 2)) {
        event.preventDefault();
    }
    // var totalMarks =parseInt($('.totalMarks').val());
    var totalMarks =parseFloat($(this).attr('max'));
    var thisValue =parseFloat($(this).val());

    if(! $(this).hasClass('totalMarks')){
        if( thisValue > totalMarks){
            $( this ).val('');
            $( this ).parent().find('div.with-errors').html('Please enter marks less than total.');
            event.preventDefault();
            // return false;
        }else{
            $( this ).parent().find('div.with-errors').html('');
        }
    }
});


$(document).on('change keyup keypress paste', '.accnumber',function (event) {
    var evt = (evt) ? evt : window.event;
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode == 46){
        return false;
    }
    if (charCode > 31 && (charCode <= 46 || charCode > 57)) {
        return false;
    }
    return true;

});

$(document).on('keyup keypress', '.textRestrict',function (event) {
    if (this.value.length >= 255) {
        return false;
    }
});

var date = $('#changedobparent').val();
var current = false;
if($('#datetimepicker_parent').val() == '' || $('#datetimepicker_parent').val() == undefined){
    current = true;
}

$('#datetimepicker_parent').datepicker({
    maxDate: new Date(date),
    dateFormat: 'M dd,yy',
    changeMonth: true,
    changeYear: true,
    yearRange: "-100Y:-15Y",

// useCurrent: current
});

if($('#datetimepicker_parent_edit').length >0){

    var datetimepicker_parent_edit = $('#datetimepicker_parent_edit').val();
    if(datetimepicker_parent_edit !=''){
        $('#datetimepicker_parent').datepicker("setDate", new Date(datetimepicker_parent_edit) );

    }
}



$('#countrySuperadmin').change(function(){
    var countryID = $(this).val();
    var token = $('input[name="_token"]').val();
    if(countryID){
        $.ajax({
            type: 'POST',
            url: '/superadmin/states',
            // dataType: "json",
            data: { country_id: countryID, _token: token },
            beforeSend: function(){
                $('#loader').show();
            },
            complete: function(){
                $('#loader').hide();
            },

            success:function(res){

                if(res){

                    $("#stateadmin").empty();
                    $("#stateadmin").append(res);
                    $('.selectpicker').selectpicker('refresh');


                }else{
                    $("#stateadmin").empty();
                }
            }
        });
    }else{
        $("#stateadmin").empty();
    }
});


function strip_html_tags(str)
{
    var str = str.replace(/<[^>]*>/g, '');

    if ((str===null) || (str==='')){
        $('#errorFeed').find('label').addClass('has-error1');
        $('#errorFeed').find('.with-errors').text('Please enter description');
        return false;
    }
    else{

        str = str.toString();
        $('#errorFeed').removeClass('has-error1');
        return true;
    }

}

$(document).on('click','#saveFeed',function(e){
    return (strip_html_tags($('#feedDescription').val()));
});


$(".summernote").on("summernote.change", function (e) {
    $('#errorFeed').find('label').removeClass('has-error1');
    $('#errorFeed').find('.with-errors').text('');
});

$('.summernote').summernote({
    toolbar: [
        // [groupName, [list of button]]
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['font', ['strikethrough', 'superscript', 'subscript']],
        ['fontsize', ['fontsize']],
        ['color', ['color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['height', ['height']],
        ['Insert', ['link']]
    ]
});

$('.rowcheckbox').change(function(){
    if($(this).prop('checked')){
        $(this).closest('.checkrow').find('td input[type="checkbox"]').each(function(){
            $(this).prop('checked', true);
        });

    }else{
        $(this).closest('.checkrow').find('td input[type="checkbox"]').each(function(){
            $(this).prop('checked', false);
        });
    }
});

$('#feeDeposit').change(function(){
    if($(this).val() == '1'){
        $('#feeSection').show();
        $('input[name="businessName"]').attr('required',true);
        $('select[name="bankId"]').prop("required", true);
        $('select[name="accountNumber"]').prop("required", true);
        $('input[name="contactEmail"]').attr('required',true);
        $('input[name="contactName"]').attr('required',true);
        $('input[name="contactPhone"]').attr('required',true);

    }else{
        $('#feeSection').hide();
        $('input[name="businessName"]').removeAttr('required',true);
        $('select[name="bankId"]').prop("required", false);
        $('select[name="accountNumber"]').prop("required", false);
        $('input[name="contactEmail"]').removeAttr('required',true);
        $('input[name="contactName"]').removeAttr('required',true);
        $('input[name="contactPhone"]').removeAttr('required',true);
    }

});



$('body').on('change','#parentstudentID',function(){
    var student_id = $(this).val();
    var token = $('input[name="_token"]').val();

    if(student_id){
        $.ajax({
            type: 'POST',
            url: '/parent/studentTerms',
            dataType: "json",
            data: { student_id: student_id, _token: token },

            success:function(res){

                if(res['terms']){

                    var html='<option value="">Select Term</option>';
                    $.each(res['terms'],function(key,value){
                        html += '<option value="'+key+'">'+value+'</option>';
                    });

                    html += '<option value="all">All Terms</option>';


                    $('#studentClassterm').html(html);
                    $("#studentClassterm").selectpicker('refresh');
                }else{

                    $('#studentClassterm').html('<option value="">Select Term</option>');
                    $("#studentClassterm").selectpicker('refresh');

                }
                if(res['html']){
                    $('#schoolfeeSessionId').append(res['html']);
                    $("#schoolfeeSessionId").selectpicker('refresh');

                }

            },error:function(err){


            }
        });

    }else{
        $('#studentClassterm').html('<option value="">Select Term</option>');
        $('#studentClassterm').selectpicker('refresh');


        // $(".student").empty();
    }

});


$(document).on('change keyup keypress paste', '.feeamount',function (event) {

    var total_amount = parseFloat($(this).val());

    var total_fee=0;
    var transaction_charges=0;
    if(!isNaN(total_amount)){
        //transaction_charges = parseFloat(((total_amount*6) / 100).toFixed(2));
        transaction_charges = parseFloat($('#transaction_charges').val());
        total_fee= parseFloat(total_amount+transaction_charges).toFixed(2);
    }


    $('#total_fee').val(total_fee);




});

$('#subAdminGroupId').on('change',function(){
    var group_id = $(this).val();
    var token = $('input[name="_token"]').val();

    if(group_id){
        $.ajax({
            type: 'POST',
            url: '/admin/rolesbygroupId',
            // dataType: "json",
            data: { group_id: group_id, _token: token },
            // beforeSend: function(){
            //      $('#student_loader').show();
            //  },
            //  complete: function(){
            //      $('#student_loader').hide();
            //  },

            success:function(res){

                if(res){
                    $("#subAdminroles").empty();
                    $("#subAdminroles").append(res);


                }else{
                    $("#subAdminroles").empty();
                }
                $('.selectpicker').selectpicker('refresh');

            }
        });
    }else{
        $("#subAdminroles").empty();
    }
});

$('#groupAdminId').on('change',function(){
    var token = $('input[name="_token"]').val();
    var group_id = $('input[name="classGroup_id"]').val();
    var admin_id = $(this).val();

    if(admin_id){
        $.ajax({
            type: 'POST',
            url: '/admin/adminRoles',
            // dataType: "json",
            data: { group_id: group_id, admin_id: admin_id,  _token: token },


            success:function(res){

                if(res['count'] == 1){

                    $('.prevAdminRole').hide();
                    $('#subAdminGroupId').removeAttr('required', true);
                    $('#subAdminroles').removeAttr('required', true);
                }else{
                    $('.prevAdminRole').show();
                    $('#subAdminGroupId').attr('required', true);
                    $('#subAdminroles').attr('required', true);


                }

            }
        });
    }else{
        $('#prevAdminRole').hide();

    }
});

$('#planGroup').on('change',function(){
    var group_id = $(this).val();
    var token = $('meta[name=csrf-token]').attr('content');


    if(group_id){
        $.ajax({
            type: 'POST',
            url: '/admin/titlesByGroupId',
            // dataType: "json",
            data: { group_id: group_id,  _token: token },


            success:function(res){
                var i=0;
                $('div.feetitle').each(function() {
                    var name = $(this).parent().parent().parent().find('.amount').attr('name');
                    if(name != undefined){
                        var split_name = name.split('_');
                        var index = Number(split_name[1]);
                        $(this).html('<select class="selectpicker code feePlanTitle"  data-live-search="true" name="title_'+index+'" tabindex="-98"><option value="">select Fee Title </option>'+res['html']+'</select> <div class="help-block with-errors"></div>');

                        // $(this).html('<option value="">select Fee Title </option>'+res['html']);
                        $('.selectpicker').selectpicker('refresh');
                    }
// i+=1;
                });
                $('#select-model').html(res['html']);


            },

        });

    }else{
        $('div.feetitle').each(function() {
            $(this).html('<select class="selectpicker code student"  data-live-search="true" name="student_ids[]" tabindex="-98"><option value="">select Fee Title </option></select>');

            $('.selectpicker').selectpicker('refresh');

        });
    }


});
$('#attendanceGroup').on('change',function(){
    var token = $('input[name="_token"]').val();
    var session_id = $('#schoolSessionId').val();
    var group_id = $(this).val();
    var report_type = '';
    if($('#reportType').length > 0){
        var report_type = $('#reportType').val();
    }


    if(group_id){
        $.ajax({
            type: 'POST',
            url: '/admin/classByGroupId',
            // dataType: "json",
            data: { group_id: group_id, session_id: session_id,  _token: token },


            success:function(res){

                if(res['html']){

                    if($('#gradeClassId').length > 0){
                        $("#gradeClassId").empty();
                        $("#gradeClassId").append(res['html']);
                        $("#gradeClassId").prop('disabled', false);

                    }else if($('#teacherClassId').length > 0){
                        $("#teacherClassId").empty();
                        $("#teacherClassId").append(res['html']);
                        $("#teacherClassId").prop('disabled', false);

                    } else if($('#gradeskillClassId').length > 0){
                        $("#gradeskillClassId").empty();
                        $("#gradeskillClassId").append(res['html']);
                        $("#gradeskillClassId").prop('disabled', false);
                    } else if($('#masterskillClassId').length > 0){
                        $("#masterskillClassId").empty();
                        $("#masterskillClassId").append(res['html']);
                        $("#masterskillClassId").prop('disabled', false);
                    }else if($('#planClassId').length > 0){
                        $("#planClassId").empty();
                        $("#planClassId").append(res['html']);
                        $("#planClassId").prop('disabled', false);
                    }else{


                        $("#class_Student").empty();
                        $("#class_Student").append(res['html']);
                        $("#class_id").empty();
                        $("#class_id").append(res['html']);
                        $("#class_id").prop('disabled', false);
                        $("#schoolClassId").empty();
                        $("#schoolClassId").append(res['html']);

                        $("#schoolClassTimetable").empty();
                        $("#schoolClassTimetable").append(res['html']);
                    }
                }else{
                    $("#class_Student").empty();
                    $("#class_id").empty();
                    $("#schoolClassId").empty();
                }
                if($('#assessmentGrades').length == 0){
                    if(res['format'] == 'nursery'){
                        $('.caType').hide();
                        $('#reportTypeDiv').hide();

                        $('select#reportType').removeAttr('required',true);
                        $('#class_arm_id_div').hide();
                        if($('.report-Type').length == 0){
                            $("#schoolClassterm option[value='all']").remove();


                        }

                    }else{
                        $('.caType').show();
                        $('#reportTypeDiv').show();
                        $('select#reportType').attr('required',true);
                        $('#class_arm_id_div').show();
                        if($('.arm_option').length == 0){
                            if($('#planClassId').length == 0){
                                if($("#schoolClassterm option[value='all']").length == 0){
                                    $('#schoolClassterm').append(new Option('Session Report', 'all'));
                                }
                            }
                        }
                    }
                }

                if(res['planHtml']){
                    if($('#class-group_plan').length){
                        $('#class-group_plan').html(res['planHtml']);
                    }

                }

                if(report_type == 1 ){
                    if(res['count'] >=1){
                        if(res['armHtml']){
                            if($('#class_arm_id').length){
                                $('.classarm-div').show();
                                $('#class_arm_id').html(res['armHtml']);
                            }
                            $('button[type="submit"]').removeAttr('disabled',true);

                            $('.reportType-errors').text('');
                        }else{
                            $('button[type="submit"]').attr('disabled',true);

                            // $('#reportType option[value="2"]').prop("selected", true);

                            $('.reportType-errors').text(res['schoolName']+' has not define class arm, please use individual class to generate report or manage class arm to define arm');
                            $('#class_arm_id').html('');


                        }
                    }else{

                        $('button[type="submit"]').attr('disabled',true);

                        // $('#reportType option[value="2"]').prop("selected", true);

                        $('.reportType-errors').text(res['schoolName']+' has not define class arm, please use individual class to generate report or manage class arm to define arm');
                        $('#class_arm_id').html('');


                    }
                }else{
                    $('button[type="submit"]').removeAttr('disabled',true);

                    $('.reportType-errors').text('');

                    $('#class_arm_id').html('');
                }

                $('.selectpicker').selectpicker('refresh');

            }


        });
    }else{
        $('#class_Student').empty();
        $('#class_id').empty();
        $('#schoolClassId').empty();

    }
});

function getClassData(class_id,  session_id){
    var panel = 'teacher';
    var token = $('input[name="_token"]').val();
    $.ajax({
        type: 'POST',
        async: false,
        url: '/'+panel+'/classData',
        dataType: "json",
        data: { class_id: class_id, _token: token,session_id: session_id},
        beforeSend: function(){
            $('#loader-2').show();
        },
        complete: function(){
            $('#loader-2').hide();
        },
        success:function(res){
            if(res){
                if (res['teachers']) {
                    $("#subject").html('<option value="">Select Subject</option>');
                    $('#subject').prop("disabled", true);

                    $.each(res['teachers'],function(key,value){
                        $("#subject").append('<option value="'+key+'">'+value+'</option>');
                        $('#subject').removeAttr("disabled");
                        $('#subject').selectpicker('refresh');
                    });
                    $('#subject').selectpicker('refresh');

                }

            }

        }

    });
}
$('#teacherClassId').on('change',function(){
    var class_id = $(this).val();
    var session_id = $('select[name="session_id"]').val();

    if(class_id){
        getClassData(class_id, session_id);
    }else{
        $("#subject").html('<option value="">Select Subject1</option>');
        $('#subject').attr("disabled");
        $('#subject').selectpicker('refresh');
    }
});
$('#teacherattendanceGroup').on('change',function(){
    var token = $('input[name="_token"]').val();
    var session_id = $('#schoolSessionId').val();
    var group_id = $(this).val();

    var report_type = '';
    if($('#reportType').length > 0){
        var report_type = $('#reportType').val();
    }

    if(group_id){
        if($('#assessmentGrades').length > 0){
            var term_id = $('#schoolClassterm').find('option:selected').val();
            gradeType(term_id);
        }
        $.ajax({
            type: 'POST',
            url: '/teacher/classByGroupId',
            data: { group_id: group_id, session_id: session_id,  _token: token },

            success:function(res){

                if(res['html']){
                    $("#class_id_students").empty();
                    $("#class_id_students").append(res['html']);

                    $("#class_id").empty();
                    $("#class_id").append(res['html']);
                    if($('#teacherClassId').length > 0){
                        $("#teacherClassId").empty();
                        $("#teacherClassId").append(res['html']);
                    }
                    if($('#gradeClassId').length > 0){
                        $("#gradeClassId").empty();
                        $("#gradeClassId").append(res['html']);
                    }
                    $("#schoolClassTimetable").empty();
                    $("#schoolClassTimetable").append(res['html']);
                }else{
                    $("#class_id_students").empty();
                    $("#class_id").empty();
                    $("#teacherClassId").empty();
                }
                if(res['format'] == 'nursery'){
                    $('.caType').hide();
                    $('#class_arm_id_div').hide();
                    $('#reportTypeDiv').hide();
                    $('select#reportType').removeAttr('required',true);

                    $("#teacherClassterm option[value='all']").remove();
                }else{
                    $('.caType').show();
                    $('#class_arm_id_div').show();
                    $('#reportTypeDiv').show();
                    $('select#reportType').attr('required',true);

                    if($("#teacherClassterm option[value='all']").length == 0){
                        $('#teacherClassterm').append(new Option('Session Report', 'all'));
                    }
                }
                if(report_type == 1 ){
                    if(res['count'] >=1){
                        if(res['armHtml']){
                            if($('#student_class_arm_id').length){
                                $('.classarm-div').show();
                                $('#student_class_arm_id').html(res['armHtml']);
                            }
                            if($('#teacher_class_arm_id').length){
                                $('.classarm-div').show();
                                $('#teacher_class_arm_id').html(res['armHtml']);
                            }

                            $('button[type="submit"]').removeAttr('disabled',true);

                            $('.reportType-errors').text('');
                        }else{
                            $('button[type="submit"]').attr('disabled',true);

                            $('.reportType-errors').text(res['schoolName']+' has not define class arm, please use individual class to generate report or manage class arm to define arm');
                            if($('#student_class_arm_id').length){
                                $('#student_class_arm_id').html('<option value="no">Select Class Arm</option>');


                            }
                            if($('#teacher_class_arm_id').length){
                                $('#teacher_class_arm_id').html('<option value="no">Select Class Arm</option>');


                            }

                        }
                    }else{
                        $('button[type="submit"]').attr('disabled',true);
                        $('.reportType-errors').text(res['schoolName']+' has not define class arm, please use individual class to generate report or manage class arm to define arm');
                        $('#class_arm_id').html('');


                    }
                }else{
                    $('button[type="submit"]').removeAttr('disabled',true);

                    $('.reportType-errors').text('');

                    $('#student_class_arm_id').html('<option value="no">Select Class Arm</option>');
                    $('#teacher_class_arm_id').html('<option value="no">Select Class Arm</option>');

                }



                $('.selectpicker').selectpicker('refresh');

            }


        });

    }else{
        $('#class_id_students').empty();
        $('#class_id').empty();
        $('#teacherClassId').empty();

    }
    $('.selectpicker').selectpicker('refresh');

});
$('#teacherTimetableGroup').on('change',function(){
    var token = $('input[name="_token"]').val();
    var session_id = $('#schoolSessionId').val();
    var group_id = $(this).val();

    if(group_id){
        $.ajax({
            type: 'POST',
            url: '/teacher/teacherClassByGroupId',
            // dataType: "json",
            data: { group_id: group_id, session_id: session_id,  _token: token },


            success:function(res){
                if(res){
                    $("#class_id_students").empty();
                    $("#class_id_students").append(res);

                    $("#class_id").empty();
                    $("#class_id").append(res);

                    $("#teacherClassId").empty();
                    $("#teacherClassId").append(res);

                    $("#schoolClassTimetable").empty();
                    $("#schoolClassTimetable").append(res);
                }else{
                    $("#class_id_students").empty();
                    $("#class_id").empty();
                    $("#teacherClassId").empty();
                }
                $('.selectpicker').selectpicker('refresh');

            }


        });
    }else{
        $('#class_id_students').empty();
        $('#class_id').empty();
        $('#teacherClassId').empty();

    }
});


$('#class_ARM_GroupId').on('change',function(){
    var group_id = $(this).val();
    var token = $('input[name="_token"]').val();

    if(group_id){
        $.ajax({
            type: 'POST',
            url: '/admin/classarmbygroupId',
            data: { group_id: group_id, _token: token },
            success:function(res){
                if(res){
                    $("#class_ids").empty();
                    $("#class_ids").append(res.html);
                }else{
                    $("#class_ids").empty();
                }
                $('.selectpicker').selectpicker('refresh');
            }
        });
    }else{
        $("#class_ids").empty();
    }
});

$('#class_arm_id').on('change', function(){
    var arm_id = $(this).val();
    var group_id = $('#attendanceGroup').val();
    var token = $('input[name="_token"]').val();
    var reportType = '';
    var reportType = $('#reportType').val();

    if(reportType == 1 && (arm_id == 'no' || arm_id == '')){
        if($('#class_id').length > 0){
            $("#class_id").html('<option value="">Select Class</option>');
        }
        if($('#schoolClassId').length){
            $("#schoolClassId").html('<option value="">Select Class</option>');
        }
        if($('#schoolChildId').length){
            $("#schoolChildId").html('<option value="">Select Class</option>');
        }

    }else{

        if(arm_id){
            $.ajax({
                type: 'POST',
                url: '/admin/classbyarm',
                data: { arm_id: arm_id, group_id:group_id, _token: token },
                success:function(res){
                    if(res){
                        if($('#class_id').length){
                            $("#class_id").html(res.html);
                        }
                        if($('#schoolClassId').length){
                            $("#schoolClassId").html(res.html);
                        }
                        if($('#schoolChildId').length){
                            $("#schoolChildId").html(res.studenthtml);
                        }
                    }else{
                        if($('#class_id').length){
                            $("#class_id").empty();
                        }
                        if($('#schoolClassId').length){
                            $("#schoolClassId").empty();
                        }
                        if($('#schoolChildId').length){
                            $("#schoolChildId").empty();
                        }
                    }
                    $('.selectpicker').selectpicker('refresh');
                }
            });
        }else{
            if($('#class_id').length){
                $("#class_id").empty();
            }
            if($('#schoolClassId').length){
                $("#schoolClassId").empty();
            }
            if($('#schoolChildId').length){
                $("#schoolChildId").empty();
            }
        }
    }
    $('.selectpicker').selectpicker('refresh');

})

$('#student_class_arm_id, #teacher_class_arm_id').on('change', function(){
    var arm_id = $(this).val();
    var session_id = '';
    var group_id = $('#teacherattendanceGroup').val();
    if($('#teacherSession').length > 0){
        var session_id = $('#teacherSession').val();

    }
    var token = $('input[name="_token"]').val();
    if(arm_id){
        $.ajax({
            type: 'POST',
            url: '/teacher/classbyarm',
            data: { arm_id: arm_id, group_id:group_id,session_id:session_id, _token: token },
            success:function(res){
                if(res){
                    if($('#class_id').length){
                        $("#class_id").html(res.html);
                    }
                    if($('#schoolClassId').length){
                        $("#schoolClassId").html(res.html);
                    }
                    if($('#teacherClassId').length){
                        $("#teacherClassId").html(res.html);
                    }
                    if($('#teacherChildId').length){
                        $("#teacherChildId").html(res.studenthtml);
                    }

                }else{
                    if($('#class_id').length){
                        $("#class_id").empty();
                    }
                    if($('#schoolClassId').length){
                        $("#schoolClassId").empty();
                    }
                    if($('#teacherClassId').length){
                        $("#teacherClassId").empty();
                    }
                    if($('#teacherChildId').length){
                        $("#teacherChildId").empty();
                    }
                }
                $('.selectpicker').selectpicker('refresh');

            }
        });
    }else{
        if($('#class_id').length){
            $("#class_id").empty();
        }
        if($('#schoolClassId').length){
            $("#schoolClassId").empty();
        }
        if($('#teacherClassId').length){
            $("#teacherClassId").empty();
        }
        if($('#teacherChildId').length){
            $("#teacherChildId").empty();
        }
        $('.selectpicker').selectpicker('refresh');

    }

})


function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function(e) {
            $('.previewSource').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
}
$(document).on('change', 'input[name="signature"]', function (e) {
    var filePath = $(this).val();
    var allowedExtensions = /(\.jpg|\.jpeg|\.png)$/i;
    if(!allowedExtensions.exec(filePath)){
        // alert('Please upload file having extensions .jpeg/.jpg/.png only.');
        $('.comment-error-msg').html('Please Select Valid File... ');
        $('.comment-error').css('display','block');
        setTimeout(function() {
            $('.comment-error').css('display','none');
        }, 2000);
        // $(this).val('');
        return false;
    } else{
        readURL(this);
    }

});
$(document).on('submit', '#allocatePlanForm', function (e) {

    e.preventDefault();
    $.ajax({
        type: 'POST', // For jQue
        url: '/admin/allocate_plan',

        data: $('#allocatePlanForm').serialize()+'&type=1',

        success: function (result) {
            if(result.status == 400){
                // $('.Confirm-txt').html(result.students+ ' has already allocated with plan. Are you sure you want to continue?');
                // $("#alocatePlanConfirm").modal("show");
                swal({
                        title: "Are you sure?",
                        text: result.students+ " has already allocated with plan.Are you sure you want to continue?",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#F36820",
                        confirmButtonText: "Confirm!",
                        closeOnConfirm: false,
                        closeOnCancel: false,
                        showLoaderOnConfirm: true
                    },
                    function(isConfirm){
                        if (isConfirm) {

                            $('#loader-2').show();
                            $.ajax({
                                type: 'POST', // For jQue
                                url: '/admin/allocate_plan',

                                data: $('#allocatePlanForm').serialize()+'&type=0',

                                success: function (result) {
                                    if(result.status == 200){
                                        swal("Allocated!", "Plan Allocated Successfully.", "success");

                                        setTimeout(function(){location.href="/admin/fee-plans"} , 2000);

                                    }
                                }
                            });
                        } else {
                            swal("Cancelled", "Your data is safe :)", "error");
                            redirection(type);
                        }
                    });
                return false;
            }
            if(result.status == 200){
                swal("Allocated!", "Plan Allocated Successfully.", "success");

                setTimeout(function(){location.href="/admin/fee-plans"} , 2000);

            }

        }

    });
});



$(document).on('submit', '#admincommentform', function (e) {

    e.preventDefault();


    var token = $('input[name="_token"]').val();

    $.ajax({
        type: 'POST', // For jQue
        url: '/admin/comment_store',

        data: $('#admincommentform').serialize(),

        success: function (result) {

            if(result.success == 200){
                $('.comment-success').show();
                $('.comment-success-msg').html(result.msg);

                setTimeout(function() {
                    $('.comment-success').fadeOut('fast');
                }, 5000);
            }else{
                $('.comment-error').show();
                $('.comment-error-msg').html(result.msg);
                setTimeout(function() {
                    $('.comment-error').fadeOut('fast');
                }, 5000);
            }

        },
        error: function(err){

        }
    });
    // }


});
$(document).on('submit', '#feetitleform', function (e) {

    e.preventDefault();
    var token = $('meta[name=csrf-token]').attr('content');
    var selected_title = $('#selectFeeTitle').val();



    $.ajax({
        type: 'POST', // For jQue
        url: '/admin/fee-titles_store',

        data: $('#feetitleform').serialize()+'&selected_title='+selected_title,

        success: function (result) {

            if(result.success == 200){
                $('.comment-success').show();
                $('.comment-success-msg').html(result.msg);

                $('#selectFeeTitle').html(result.html);
                $("#selectFeeTitle").selectpicker('refresh');
                $('#customGradeFields1').html('');
                $('#customGradeFields1').html($('#customGradeFields2').html());


                setTimeout(function() {
                        $('.comment-success').fadeOut('fast');
                    }, 500
                );
            }else{
                $('.comment-error').show();
                $('.comment-error-msg').html(result.msg);
                setTimeout(function() {
                    $('.comment-error').fadeOut('fast');
                }, 5000);
            }

        },
        error: function(err){

        }
    });
    // }


});

$(document).on('click', '#teachercommentformsubmit', function (e) {
    e.preventDefault();

    $.ajax({
        type: 'post',
        url: '/teacher/teacher_comment_store',

        data: $('#teachercommentform').serialize(),

        success: function (result) {

            if(result.success == 200){
                $('.comment-success').show();
                $('.comment-success-msg').html(result.msg);

                setTimeout(function() {
                    $('.comment-success').fadeOut('fast');
                }, 5000);
            }else{
                $('.comment-error').show();
                $('.comment-error-msg').html(result.msg);
                setTimeout(function() {
                    $('.comment-error').fadeOut('fast');
                }, 5000);


            }

        },
        error: function(err){

        }
    });
});

$(document).on('submit', '#skillstoreform', function (e) {
    e.preventDefault();


    $.ajax({
        type: 'post',
        url: '/teacher/skill_store',

        data: $('#skillstoreform').serialize(),

        success: function (result) {

            if(result.success == 200){
                $('.skill-success').show();
                $('.skill-success-msg').html(result.msg);

                setTimeout(function() {
                    $('.skill-success').fadeOut('fast');
                }, 5000);
            }else{
                $('.skill-error').show();
                $('.skill-error-msg').html(result.msg);
                setTimeout(function() {
                    $('.skill-error').fadeOut('fast');
                }, 5000);


            }

        },
        error: function(err){

        }
    });
});
$(document).on('submit', '#affectiveareastoreform', function (e) {
    e.preventDefault();


    $.ajax({
        type: 'post',
        url: '/teacher/affectivearea_store',

        data: $('#affectiveareastoreform').serialize(),

        success: function (result) {

            if(result.success == 200){
                $('.affectivearea-success').show();
                $('.affectivearea-success-msg').html(result.msg);

                setTimeout(function() {
                    $('.affectivearea-success').fadeOut('fast');
                }, 5000);
            }else{
                $('.affectivearea-error').show();
                $('.affectivearea-error-msg').html(result.msg);
                setTimeout(function() {
                    $('.affectivearea-error').fadeOut('fast');
                }, 5000);


            }

        },
        error: function(err){

        }
    });
});


$(document).on('submit', '#gradesettingclassgroup', function (e) {
    e.preventDefault();

    $.ajax({
        url: '/admin/get_gradeData',
        data: $('#gradesettingclassgroup').serialize(),
        success: function (result) {

            if(result. success == 200){
                $('#gradesettingform').html(result.html);

            }

        },
        error: function(err){

        }
    });
});

$(document).on('change','input[name=admin_comments]',function(e){
    if($(this).prop('checked')){
        $('input[name=admin_role]').show();
    }else{
        $('input[name=admin_role]').hide();
    }
});
$(document).on('submit', '#gradereportsettingclassgroup', function (e) {
    e.preventDefault();

    $.ajax({
        url: '/admin/settingByGroupId',

        data: $('#gradereportsettingclassgroup').serialize(),

        success: function (result) {



        },
        error: function(err){

        }
    });
});

$(document).on('change', '#settingGroupId, #gradeSessionId', function (e) {
    var group_id = $('#settingGroupId').val();
    var gradeSessionId = $('#gradeSessionId').val();
    var term = $('#term').val();

    $.ajax({
        url: '/admin/settingByGroupId',
        data: $('#gradereportsettingclassgroup').serialize(),
        success: function (result) {
            if(result. success == 200){
                $('#gradereportsettingform').html(result.html);
                $('#gradereportsettingform').show();

                // Sets report sheet subheading input to visible 
                // if report subheading checkbox is already checked
                // and prolly has a value, when filter by class group is successful
                let report_sheet_subheading_is_checked = $('#report_sheet_subheading_check').is(':checked');
                report_sheet_subheading_is_checked == true ? $('#report_sheet_subheading_input').show() : $('#report_sheet_subheading_input').hide();
            }

            let term_overall_average_is_checked = $('#term_overall_average_check').is(':checked');
            term_overall_average_is_checked == true ? $('#grade_determinant_block').show() : $('#grade_determinant_block').hide();

            $('.resumpdatepicker').datepicker({
                minDate: new Date(2020, 28 - 1, 25),
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true
            });
            $('.holidaypicker').datepicker({
                minDate: new Date(),
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true
            });

            if(gradeSessionId != '' && group_id != ''){

                $('#grade_report_setting').show();
            }else{


                $('#grade_report_setting').hide();

            }
            if(group_id != ''){
                $('#report_setting').show();


            }else{
                $('#report_setting').hide();
            }

        },
        error: function(err){

        }
    });
});

// Term Overall Average for Grade Determinant Section Toggle
$(document).on('change', '#term_overall_average_check', function() {
    this.checked ? $('#grade_determinant_block').show():$('#grade_determinant_block').hide();
});

// Sets report sheet subheading input to visible 
// if report subheading checkbox is already checked
// and prolly has a value, when page is loaded
$(document).ready(function() {
    let report_sheet_subheading_is_checked = $('#report_sheet_subheading_check').is(':checked');
    report_sheet_subheading_is_checked == true ? $('#report_sheet_subheading_input').show() : $('#report_sheet_subheading_input').hide(); 
});

// Show report sheet subheading input if report sheet checkbox is checked/unchecked.
$(document).on('change', '#report_sheet_subheading_check', function() {
    this.checked ? $('#report_sheet_subheading_input').show() : $('#report_sheet_subheading_input').hide();
});

// Validate report sheet subheading Length
// let minimumLengthOfSubheading = 5;
// let maximumLengthOfSubheading = 150;
// $(document).on('change keyup paste input', '#report_sheet_subheading_input', function() {
//     let character = $(this).val();
//     let characterLength = $(this).val().length;
//     if(characterLength < minLength){

//     }
// });

jQuery(function($) {
    $(".add_branch_address").click(function(){
        var clone = $('.branch_address:first').clone(true);
        clone.find('label').remove();
        clone.find('[type=text]').val('');
        clone.find('[type=email]').val('');
        clone.find('[type=hidden]').val('');
        clone.find('.remove_branch_address').addClass('remove_active').show();
        clone.find('.add_branch_address').hide();
        $(".branch_address:last").after(clone);
        $('form').validator('update');
    });
    var branch_id = [];
    $(document).on('click', '.branch_address .remove_active', function(){
        $(this).closest('.branch_address').remove();
        var branchID = $(this).data('id');
        var url = $(this).data('url');
        if(branchID){

            branch_id.push( branchID );
            $('.branch_address_remove').val(branch_id);
        }
    });

});
$(document).on('change', 'select#term', function (e) {
    var termId = $(this).val();
    if(termId != ''){
        $('input.inputChange').val('');
        $('input.inputChange').removeAttr('readOnly');


    }
    getstudents();


});
$(document).on('change', 'select#gradeSessionId', function (e) {
    getstudents();
});
$(document).on('change', 'select[name=type]', function (e) {
    var type = $(this).val();

    var term_id = $('select[name=term_id]').val();
    if(type == '' || term_id == ''){
        $('input.inputChange' ).attr('readOnly',true);
        $('input.inputChange').val('');
    }else{
        $('.inputChange' ).removeAttr('readOnly');
    }
});




$('.inputChange').on('input', function (e) {
    e.preventDefault();
    if (input_changed) {
        input_changed = false;
    } else {
        var elem = $(this);
        if (elem.val().length > 1) {
            input_changed = true;
            var form_data = new FormData();
            var csrf_token = $('meta[name=csrf-token]').attr('content');
            var search = elem.val();

            var session_id = $('#gradeSessionId').val();
            var type = $('select[name=type]').val();
            var term_id = $('select#term').val();
            form_data.append('search', search);
            form_data.append('session_id', session_id);
            form_data.append('type', type);
            form_data.append('term_id', term_id);
            form_data.append('_token', csrf_token);

            $.ajax({
                url:"/admin/autocomplete",
                data: form_data,
                type: 'POST',
                contentType: false, // The content type used when sending data to the server.
                cache: false, // To unable request pages to be cached
                processData: false,
                success: function (result) {

                    if (result.status === 'success') {

                        showAutocomplete(result.result, elem);
                    }
                },
                error: function (err) {

                }
            });

        }
    }
});

function showSweetAlert(html, status){
    if(status == 1){
        swal({
                title: "Bank Details",
                text: html,
                html:true,
                showCancelButton: true,

                confirmButtonColor: "#F36820",
                confirmButtonText: "Confirm",
                closeOnConfirm: false,
                closeOnCancel: false,
                showLoaderOnConfirm: true,
                customClass: 'swal-wide',
            },
            function(isConfirm){
                if (isConfirm) {
                    $('#updateSchoolProfile').removeAttr('id');
                    $('.updateSchoolProfile').submit();
                } else {
                    swal("Cancelled", "Your data is safe :)", "error");
                }

            });
    }else{
        swal({
                title: "Bank Details",
                text: html,
                html:true,
                showCancelButton: true,


                closeOnConfirm: false,
                closeOnCancel: false,
                showLoaderOnConfirm: true,
                customClass: 'swal-wide',
            },
            function(isConfirm){
                if (isConfirm) {

                } else {
                    swal("Cancelled", "Your data is safe :)", "error");
                }

            });
    }


    return false;
}


function verifyBankDetails(){
    var numberData =[];
    var bankData =[];
    var validate = 0;
    var length = $( "tr.bank-row" ).length;

    var name = '';
    $( "tr.bank-row" ).each(function(index1, ele) {
        var bankrow = $(this);
        if($(this).find('.accoutnumber').val() != ''){
            var accoutnumber = $(this).find('.accoutnumber').val();
            var bankId = $(this).find('.bankId').val();
            var businessName = $(this).find('.bankname').val();
            if(jQuery.inArray(accoutnumber,numberData) === -1){
                $(this).find('.accoutnumber').css('border', '1px solid rgba(33, 33, 33, 0.12)');
                $(this).find('.accoutnumber').parent().find('.with-errors').html('');
            }else{

                validate+=1;
                $(this).find('.accoutnumber').css('border-color', 'rgba(237, 111, 86, 0.5)');
                $(this).find('.accoutnumber').parent().find('.with-errors').html('Account number already exist');
            }
            numberData.push(accoutnumber);
            bankData.push(accoutnumber+'-'+bankId+'-'+businessName);
        }

        var csrf_token = $('meta[name=csrf-token]').attr('content');
        if(length-1 == index1){
            $.ajax({
                url:"/admin/getBankDetails",
                data: {bankData :bankData,_token:csrf_token},
                // async: false,
                type: 'POST',
                beforeSend: function () {
                    $('#loader-2').show();
                },
                success: function (result) {
                    $('#loader-2').hide();
                    var html = '<div class="table-responsive"><table class="table table-bordered"><thead><tr><th class="text-center">Bank Name</th><th class="text-center">Account number</th><th class="text-center">name</th></tr></thead><tbody>';
                    var htmlValidate = 0;
                    $(result ).each(function(index2, ele) {
                        if(ele.status == '00'){
                            name = ele.name;
                            if(name != ''){

                                $( "tr.bank-row" ).eq(index2).find('.bankname').val(name);
                            }else{
                                if($( "tr.bank-row" ).eq(index2).find('.bankname').val() == ''){
                                    validate+=1;
                                    $( "tr.bank-row" ).eq(index2).find('.bankname').css('border-color', 'rgba(237, 111, 86, 0.5)');
                                    $( "tr.bank-row" ).eq(index2).find('.bankname').parent().find('.with-errors').html('Name is required');
                                }
                            }
                        }else if(ele.status == 400){
                            validate+=1;
                            $( "tr.bank-row" ).eq(index2).find('.accoutnumber').css('border-color', 'rgba(237, 111, 86, 0.5)');
                            $( "tr.bank-row" ).eq(index2).find('.accoutnumber').parent().find('.with-errors').html('Account is invalid');
                            $( "tr.bank-row" ).eq(index2).find('.bankname').val('');

                        }else if(ele.status == '02'){
                            if($( "tr.bank-row" ).eq(index2).find('.bankname').val() == ''){
                                validate+=1;
                                $( "tr.bank-row" ).eq(index2).find('.bankname').css('border-color', 'rgba(237, 111, 86, 0.5)');
                                $( "tr.bank-row" ).eq(index2).find('.bankname').parent().find('.with-errors').html('Name is required');
                            }else{
                                $( "tr.bank-row" ).eq(index2).find('.bankname').css('border', '1px solid rgba(33, 33, 33, 0.12)');
                                $( "tr.bank-row" ).eq(index2).find('.bankname').parent().find('.with-errors').html('');
                            }
                        }
                        var name = $( "tr.bank-row" ).eq(index2).find('.bankname').val();
                        var bank_name = $( "tr.bank-row" ).eq(index2).find('.bankId option:selected').attr('data-name');
                        var accoutNumber = $( "tr.bank-row" ).eq(index2).find('.accoutnumber').val();
                        if(name == '' || accoutNumber == '' || bank_name == ''){
                            if(validate == 0){
                                htmlValidate = 1;
                                errorhtml = '<div class="table-responsive"><table class="table table-bordered"><tr><td class="text-centercolspan ="3"> Something went wrong Please try againn</td></tr></table></div>';
                            }
                        }

                        html += '<tr><td>'+bank_name+'</td><td>'+accoutNumber+'</td><td>'+name+'</td></tr>'
                    });
                    html += '</tbody></table></div>';
                    if(htmlValidate == 1){
                        showSweetAlert(errorhtml, 0);

                    }else{
                        if(validate == 0){
                            showSweetAlert(html, 1);
                        }
                    }
                },
                error: function (err) {
                    $('#loader-2').hide();
                }
            });
        }
    });
    return true;
}

$(document).on('submit', '#updateSchoolProfile', function(e) {
    e.preventDefault();
    var rowValidate = 0;

    var length = $("tr.bank-row").length;
    var accountvalidate = 0;
    var detailValidate = 0;
    $( "tr.bank-row" ).each(function(index, ele) {
        var accoutnumber = $(this).find('.accoutnumber').val();
        var businessName = $(this).find('.bankname').val();
        var bankId = $(this).find('.bankId').val();

        if(accoutnumber != '' || bankId != ''){
            if(accoutnumber == ''){
                rowValidate+=1;
                $(this).find('.accoutnumber').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('.with-errors').html('Account number is required');
            }else{
                $(this).find('.accoutnumber').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
            }

            if(bankId == ''){
                rowValidate+=1;

                $(this).find('.bankId').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('.with-errors').html('Bank is required');
            }else{
                $(this).find('.bankId').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
            }
        } else {
            accountvalidate+=1;
        }

        var accoutnumber = $(this).find('.accoutnumber').val();
        var bankId = $(this).find('.bankId').val();

        var hiddenaccoutnumber = $(this).find('.hiddenaccoutnumber').val();
        var hiddenbankId = $(this).find('.hiddenbankId').val();

        if(accoutnumber == hiddenaccoutnumber && bankId == hiddenbankId ){
            detailValidate+=1;
        }

        if(length-1 == index) {
            // validateReportFeeAccountDetailRows()
            if(accountvalidate == length || detailValidate == length){
                $('#updateSchoolProfile').removeAttr('id');
                $('.updateSchoolProfile').submit();
            } else {
                if(rowValidate == 0){
                    // validateReportFeeAccountDetailRows()
                    setTimeout(function(){
                        verifyBankDetails();
                    }, 1000);
                }else{
                    $('#loader-2').css('display', 'none');
                }
            }
        }
    });
});

// Report Fee Account Row
// function validateReportFeeAccountDetailRows() {
//     $('tr.account-row').each(function(i, el) {
//         var accountnumber = $(this).find('.accountnumber').val();
//         var accountName = $(this).find('.accountname').val();
//         var bankId = $(this).find('.bank').val();
//         var amount = $(this).find('.feeAmount').val();
//
//         if(accountnumber != '' || bankId != '' || amount != '' || accountName != '') {
//             if(accountnumber == '') {
//                 $(this).find('.accountnumber').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('.with-errors').html('Account number is required');
//                 return;
//             } else {
//                 $(this).find('.accountnumber').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             }
//
//             if(bankId == '') {
//                 $(this).find('.bank').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('.with-errors').html('Bank is required');
//                 return;
//             } else {
//                 $(this).find('.bank').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             }
//
//             if(accountName == '') {
//                 $(this).find('.accountname').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('.with-errors').html('Account name is required');
//                 return;
//             } else {
//                 $(this).find('.accountname').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             }
//
//             if(amount == '') {
//                 $(this).find('.feeAmount').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('.with-errors').html('Amount is required');
//                 return;
//             }else{
//                 $(this).find('.feeAmount').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             }
//         }
//         else if(accountnumber == '' && bankId == '' && amount == '' && accountName == '') {
//             // $(this).find('.accountnumber').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             // $(this).find('.bank').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             // $(this).find('.accountname').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             // $(this).find('.feeAmount').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('.with-errors').html('');
//             return true;
//         } else {
//             return;
//         }
//     });
// }

$(document).on('focusin', '.commentchange', function (e) {
    e.preventDefault();

    var elem = $(this);

    var form_data = new FormData();
    var csrf_token = $('meta[name=csrf-token]').attr('content');
    var search = elem.val();
    if($('#teacherClassId').length > 0){
        var class_id = $('#teacherClassId').val();

    }else{
        var class_id = $('#schoolClassId').val();

    }

    form_data.append('search', search);
    form_data.append('class_id', class_id);

    form_data.append('_token', csrf_token);

    $.ajax({
        url:"/admin/commentAutocomplete",
        data: form_data,
        type: 'POST',
        contentType: false, // The content type used when sending data to the server.
        cache: false, // To unable request pages to be cached
        processData: false,
        success: function (result) {

            if (result.status === 'success') {
                showCommentAutocomplete(result.result, elem);
            }
        },
        error: function (err) {


        }
    });


})
$(document).on('click', 'span.grade_name', function (e) {
    var gradeName = $(this).html();
    var totalMarks = $(this).attr('data-marks');
    $('input.totalMarks').val(totalMarks);
    $('input.totalMarks').attr('readOnly',true);
    $('#search-content-block').hide();
    $('input.inputChange').val(gradeName);
    $('input.inputChange').attr('readOnly',true);



});

function showAutocomplete(response, elem) {

    var html = '';
    if (response) {
        html += '<div class="block"><span class="title">Grades</span>';
        $(response).each(function (index, grade) {
            html += '<span class="result">' + '<span class="grade_name" data-marks='+grade.totalMarks+'>' + grade.name + '</span>' + '</a>' +  '</span>';
        });
        html += '</div>';
    }

    var form_name = elem.closest('form').attr('id');
    if (form_name === 'teacherGradevalidate') {
        $('#teacherGradevalidate .inputChange').val(elem.val());
    }

    if (response.length > 0) {
        $('#search-content-block').show();
        $('#search-content-block').html('<div class="pos-cross close_autocomplete"><i class="fa fa-times"></i></div>'+html);
    }else {
        $('#search-content-block').hide();
    }
}
function showCommentAutocomplete(response, elem) {

    var html = '';
    if (response) {
        html += '<div class="block"><span class="title"></span><ul>';
        $(response).each(function (index, grade) {
            html += '<li class="searchcomment">' +  grade.comment +  '</li>';
        });
        html += '</ul></div>';
    }


    var form_name = elem.closest('form').attr('id');
    if (form_name === 'admincommentform') {
        $('#admincommentform .commentchange').val(elem.val());
    }

    if (response.length > 0) {
        $('#search-content-block').show();
        $('#search-content-block').html('<div class="pos-cross close_autocomplete"><i class="fa fa-times"></i></div>'+html);
    }else {
        $('#search-content-block').hide();
    }
}

$(document).on('input', 'input.subjectchange', function (e) {
    var globaldata = $(this);

    e.preventDefault();
    if (input_changed) {
        input_changed = false;
    } else {
        var elem = $(this);
        if (elem.val().length > 1) {
            input_changed = true;
            var form_data = new FormData();
            var csrf_token = $('meta[name=csrf-token]').attr('content');
            var search = elem.val();
            form_data.append('search', search);
            form_data.append('_token', csrf_token);
            form_data.append('type', 'subject');

            $.ajax({
                url:"/admin/subjectautocomplete",
                data: form_data,
                type: 'POST',
                contentType: false, // The content type used when sending data to the server.
                cache: false, // To unable request pages to be cached
                processData: false,
                success: function (result) {

                    if (result.status === 'success') {

                        var response = result.result;
                        var html = '';
                        if (response) {
                            html += '<i class="fa fa-times subject_cross" ></i><ul>';

                            $(response).each(function (index, grade) {
                                html += '<li class="searchsubjectitem">' + grade.subjectName + '</li>';
                            });
                            html += '</ul>';
                        }

                        if (response.length > 0) {
                            $('.subjectdrpdwn').hide();
                            $(globaldata).parent().find('.subjectdrpdwn').show();
                            $(globaldata).parent().find('.subjectdrpdwn').html(html);


                        }else {
                            $(globaldata).parent().find('.subjectdrpdwn').hide();

                        }
                    }
                },
                error: function (err) {

                }
            });

        }
    }
})
$(document).on('click', 'li.searchsubjectitem', function (e) {
    var subjectName = $(this).html();

    $(this).parent().parent().parent().find('input.subjectchange').val(subjectName);
    $(this).parent().parent().hide();
});
$(document).on('click', 'li.searchcomment', function (e) {
    var subjectName = $(this).html();

    $(this).parent().parent().parent().parent().find('textarea.commentchange').val(subjectName);
    $(this).parent().parent().parent().hide();
});
$(document).on('click', 'i.subject_cross', function (e) {
    $(this).parent().html();
    $(this).parent().hide();

});

$(document).on('input', 'input.termchange', function (e) {
    var globaldata = $(this);

    e.preventDefault();
    if (input_changed) {
        input_changed = false;
    } else {
        var elem = $(this);
        if (elem.val().length > 1) {
            input_changed = true;
            var form_data = new FormData();
            var csrf_token = $('meta[name=csrf-token]').attr('content');
            var search = elem.val();
            form_data.append('search', search);
            form_data.append('_token', csrf_token);

            $.ajax({
                url:"/admin/termautocomplete",
                data: form_data,
                type: 'POST',
                contentType: false, // The content type used when sending data to the server.
                cache: false, // To unable request pages to be cached
                processData: false,
                success: function (result) {

                    if (result.status === 'success') {

                        var response = result.result;
                        var html = '';
                        if (response) {
                            html += '<i class="fa fa-times term_cross" ></i><ul>';

                            $(response).each(function (index, grade) {
                                html += '<li class="searchtermitem">' + grade.name + '</li>';
                            });
                            html += '</ul>';
                        }

                        if (response.length > 0) {
                            $('.termdrpdwn').hide();

                            $(globaldata).parent().find('.termdrpdwn').show();
                            $(globaldata).parent().find('.termdrpdwn').html(html);


                        }else {
                            $(globaldata).parent().find('.termdrpdwn').hide();

                        }
                    }
                },
                error: function (err) {

                }
            });

        }
    }
})
$(document).on('click', 'li.searchtermitem', function (e) {
    var name = $(this).html();

    $(this).parent().parent().parent().find('input.termchange').val(name);
    $(this).parent().parent().hide();
});
$(document).on('click', 'i.term_cross', function (e) {
    $(this).parent().html();
    $(this).parent().hide();

});



$(document).on('click', 'input.optional', function (e) {

    $(this).parent().parent().parent().parent().find('input.validateMarks').val('Optional');
    $(this).parent().parent().parent().parent().find('input.validateMarks').attr('readOnly',true);
    $(this).parent().parent().parent().parent().find('input.validateMarks').addClass('disable_bg');
    $(this).addClass('selected');
    $(this).removeClass('optional');
});
$(document).on('click', 'div.close_autocomplete', function (e) {
    $('#search-content-block').hide();

});
$(document).on('click', 'input.selected', function (e) {
    $(this).parent().parent().parent().parent().find('input.validateMarks').val('');
    $(this).parent().parent().parent().parent().find('input.validateMarks').removeAttr('readOnly');
    $(this).parent().parent().parent().parent().find('input.validateMarks').removeClass('disable_bg');

    $(this).removeClass('selected');
    $(this).addClass('optional');
});

$(document).on('click','#waitAction',function(e){

    var comment = $('#comment').val();
    if(comment == ''){
        e.preventDefault();

        $('#commentrequirederror').show();
        $(this).parent().parent().find('.form-group').addClass('has-error has-danger');
        return false;

    }else{
        $('#commentrequirederror').hide();
        $(this).parent().parent().find('.form-group').removeClass('has-error has-danger')

        return true;
    }
});
datatable_1 = false;
$('#schoolClassTimetable').on('change',function(){
    var token = $('input[name="_token"]').val();
    var session_id = $('#schoolSessionId').val();
    var class_id = $('#schoolClassTimetable').val();
    var panel = 'admin';
    if($('.teacher-panel').length){
        panel = 'teacher';
    }

    if(class_id){
        $.ajax({
            type: 'POST',
            url: '/'+panel+'/getclasstimetable',
            dataType: "json",
            data: { session_id: session_id, class_id: class_id,  _token: token },


            success:function(res){
                if( datatable_1 ){
                    datatable_1.destroy();
                    $('#lecture_list').html('');
                }

                $('#lecture_session_id').val(session_id);
                $('#lecture_class_id').val(class_id);

                $('#subject-select').html(res.subjectHtml);
                $('#lecture_list').html(res.lectureHtml);
                $('#lecture_list_table').show();
                if(res.lectureHtml == ''){
                    datatable_1 = false;
                    return ;
                }
                datatable_1 = $('#customFields_timetable_').DataTable({
                    dom: 'Blfrtip',
                    "paging":   true,
                    'lengthChange': false,
                    "columnDefs": [ {
                        "targets": 0,
                        "orderable": false
                    } ],
                    language: {
                        "emptyTable": "No Records Available"
                    },
                    buttons: [
                        {
                            extend: 'csv',
                            footer: false,
                            exportOptions: {
                                columns: "thead th:not(.noExport)"
                            }
                        },
                        {
                            extend: 'excel',
                            footer: false,
                            exportOptions: {
                                columns: "thead th:not(.noExport)"
                            }
                        },
                        {
                            extend: 'pdfHtml5',
                            orientation: 'landscape',
                            pageSize: 'LEGAL',
                            footer: false,
                            exportOptions: {
                                columns: "thead th:not(.noExport)"
                            }
                        },
                        {
                            extend: 'print',
                            footer: false,
                            exportOptions: {
                                columns: "thead th:not(.noExport)"
                            }
                        }

                    ]
                });
            }


        });
    }else{
        $('#class_Student').empty();
        $('#class_id').empty();
        $('#schoolClassId').empty();

    }
});

$(document).on('change', '#subject-select, #subject', function(){
    var subject = $(this).val();
    var token = $('input[name="_token"]').val();
    var term_id = $('#term').val();
    var session_id = $('#gradeSessionId').val();
    var class_id = $('#gradeClassId').val();
    var this_ = this;
    var panel = 'admin';
    if($('.teacher-panel').length){
        panel = 'teacher';
    }
    $.ajax({
        type: 'POST',
        url: '/'+panel+'/getsubjectteacher',
        dataType: "json",

        data: { subject: subject,  _token: token },

        success:function(res){
            $('#teacher-select').html(res.html).removeAttr("disabled");;
            $('#teacher-select').selectpicker('refresh');
            $(this_).closest('.modal-body').find('#teacher-select').html(res.html);

        }
    });

    getstudents();

});

function openLectureEditModal(timetable, lecture){
    var token = $('input[name="_token"]').val();
    var panel = 'admin';
    if($('.teacher-panel').length){
        panel = 'teacher';
    }
    $.ajax({
        type: 'POST',
        url: '/'+panel+'/getlecturemodal',
        dataType: "html",

        data: { timetable: timetable,  lecture: lecture, _token: token },

        success:function(res){
            $('#lecture_edit_modal').html(res);
            $(document).find('#timepicker3').timepicki();
            $(document).find('#timepicker4').timepicki();
            $('#lecture_edit_modal').modal('toggle');
        }
    });
}

function getstudents(){
    if($('#gradeClassId').length > 0){
        var class_id = $('#gradeClassId').val();
    }else if($('#schoolClassId').length > 0){
        var class_id = $('#schoolClassId').val();

    }else{
        var class_id = $('#gradeClassIdTeacher').val();
    }
    if(class_id == 'all'){
        var class_id = $('#class_arm_id').val();

    }
    var subject = $('#subject').val();
    var term_id = $('#term').val();
    if($('#gradeClassId').length > 0){
        var session_id = $('#gradeSessionId').val();
    }else{
        var session_id = $('#sessio').val();
    }
    var token = $('input[name="_token"]').val();
    if(class_id != '' && subject != '' && term_id != '' && session_id != ''){

        $.ajax({
            type: 'POST',
            url: '/admin/classGradeData',
            // dataType: "json",
            data: { class_id: class_id,subject: subject, term_id:term_id,session_id:session_id, _token: token },

            success:function(res){

                if(res){

                    if (res['html']) {
                        $('#studentDetail').html('');
                        $('#studentDetail').append(res['html']);
                    }
                }

            }

        });
    }else{
        $('#studentDetail').html('');
    }
}

function getSessionTerms(){
    var school_id = $('#schoolselection').val();
    var session_id = $('#sessionschool').val();
    var token = $('meta[name="csrf-token"]').attr('content');
    if(school_id != '' && session_id != ''){
        $.ajax({
            type: 'POST',
            url: '/superadmin/sessionTerms',
            // dataType: "json",
            data: { _token: token, school_id: school_id, session_id: session_id},
            success: function (res) {

                $("#sessionterm").empty();
                $("#sessionterm").html(res);
                $("#sessionterm").selectpicker('refresh');

            },
            error: function(err){

            }
        });
    }else{
        $("#sessionterm").empty();
        $("#sessionterm").html('<option value="">Select Terms</option>');
        $("#sessionterm").selectpicker('refresh');
    }
}
function getClassTerms(){
    var school_id = $('#schoolselection').val();
    var class_id = $('#mapClasses').val();
    var token = $('meta[name="csrf-token"]').attr('content');
    if(school_id != '' && class_id != ''){
        $.ajax({
            type: 'POST',
            url: '/superadmin/classTerms',
            // dataType: "json",
            data: { _token: token, school_id: school_id, class_id: class_id},
            success: function (res) {

                $("#mapclassterm").empty();
                $("#mapclassterm").html(res);
                $("#mapclassterm").selectpicker('refresh');

            },
            error: function(err){

            }
        });
    }else{
        $("#mapclassterm").empty();
        $("#mapclassterm").html('<option value="">Select Terms</option>');
        $("#mapclassterm").selectpicker('refresh');
    }
}
function getSchoolClasses(){

    var school_id = $('#schoolselection').val();
    var token = $('meta[name="csrf-token"]').attr('content');
    if(school_id != '' ){
        $.ajax({
            type: 'POST',
            url: '/superadmin/schoolClasses',
            // dataType: "json",
            data: { _token: token, school_id: school_id},
            success: function (res) {

                if($('#schoolClasses').length > 0){
                    $("#schoolClasses").empty();
                    $("#schoolClasses").html(res);
                    $("#schoolClasses").selectpicker('refresh');
                }else{
                    $("#mapClasses").empty();
                    $("#mapClasses").html(res);
                    $("#mapClasses").selectpicker('refresh');
                }
            },
            error: function(err){

            }
        });
    }else{
        $("#schoolClasses").empty();
        $("#schoolClasses").html('<option value="">Select Class</option>');
        $("#schoolClasses").selectpicker('refresh');

        $("#mapClasses").empty();
        $("#mapClasses").html('<option value="">Select Class</option>');
        $("#mapClasses").selectpicker('refresh');
    }
}

$(document).on('click', '.open_edit_lecture', function(){
    var timetable = $(this).attr('timetable');
    var lecture = $(this).attr('lecture');
    openLectureEditModal(timetable, lecture);
})


if($('#timepicker1').length >0){
    $('#timepicker1').timepicki();

}
if($('#timepicker2').length >0){

    $('#timepicker2').timepicki();
}


function lectureValidate(ele) {
    $(".days-error").text('');
    $('.start_time-error').text('');
    $('.end_time-error').text('');

    var return_  = true;
    var timetable = $('#timetable').val();
    var start_time = $('#timepicker1').val();
    var end_time = $('#timepicker2').val();
    var token = $('input[name="_token"]').val();

    if($.trim(start_time) == ''){
        $('.start_time-error').text('Please enter start time');
        return_  = false;
    }

    if($.trim(end_time) == ''){
        $('.end_time-error').text('Please enter end time');
        return_  = false;
    }

    // $.ajax({
    //     async : false,
    //     type: 'POST',
    //     url: '/admin/checklecturetime',
    //     dataType: "json",
    //     data: { timetable: timetable, start_time: start_time, end_time:end_time, _token: token },

    //     success:function(res){

    //         if(res.success){
    //             $('.start_time-error').text(res.start_time);
    //             $('.end_time-error').text(res.end_time);
    //         }else{
    //             return_  = true;
    //         }
    //     }
    // });

    if ($(".weekday:checked").length <= 0)
    {
        $(".days-error").text("Please select days.");
        return_  = false;
    }

    if($('#subject-select').val() == ""){
        return_  = false;
    }

    if($('#teacher-select').val() == 0){
        return_  = false;
    }
    return return_ ;

}

function lectureEditValidate(ele) {
    $(ele).find(".days-error").text('');
    $(ele).find('.start_time-error').text('');
    $(ele).find('.end_time-error').text('');

    var return_  = true;
    var timetable = $(ele).find('#timetable').val();
    var start_time = $(ele).find('#timepicker3').val();
    var end_time = $(ele).find('#timepicker4').val();
    var token = $(ele).find('input[name="_token"]').val();

    if($.trim(start_time) == ''){
        $(ele).find('.start_time-error').text('Please enter start time');
        return_  = false;
    }

    if($.trim(end_time) == ''){
        $(ele).find('.end_time-error').text('Please enter end time');
        return_  = false;
    }

    if ($(ele).find(".weekday:checked").length <= 0)
    {
        $(".days-error").text("Please select days.");
        return_  = false;
    }

    if($(ele).find('#subject-select').val() == ""){
        return_  = false;
    }

    if($(ele).find('#teacher-select').val() == 0){
        return_  = false;
    }
    return return_ ;

}

/*
# School module
*/
$('#msgr_loading').click(function() {

    var attendanceGroup = $('#attendanceGroup').val();
    var schoolClassId = $('#schoolClassId').val();
    var schoolSessionId = $('#schoolSessionId').val();
    var schoolChildId = $('#schoolChildId').val();
    if (schoolChildId === null) { var schoolChildId = "";}
    var schoolClassterm = $('#schoolClassterm').val();
    if(attendanceGroup != "" && schoolClassId != "" && schoolSessionId != "" && schoolChildId != "" && schoolClassterm != ""){
        $('#loader').show();
    }
});
$('#attendance_loading').click(function() {
    var attendanceGroup = $('#attendanceGroup').val();
    var class_Student = $('#class_Student').val();
    var schoolSession = $('#schoolSession').val();
    var students_List = $('#students_List').val();
    if(attendanceGroup != "" && class_Student != "" && schoolSession != "" && students_List != ""){
        $('#loader').show();
    }
});
$('#grade_loading').click(function() {
    var attendanceGroup = $('#attendanceGroup').val();
    var class_id = $('#class_id').val();
    var subject_id = $('#subject_id').val();
    if(attendanceGroup != "" && class_id != "" && subject_id != ""){
        $('#loader').show();
    }
});

$('#transaction_loading').click(function() {
    $('#loader').show();
});
$('#grade_search').click(function() {
    $('#loader').show();
});
$('#feed_search').click(function() {
    $('#loader').show();
});
/*
# Teacher module
*/
$('#teacher_report').click(function() {
    var attendanceGroup = $('#teacherattendanceGroup').val();
    var schoolClassId = $('#teacherClassId').val();
    var schoolSessionId = $('#teacherSession').val();
    var schoolChildId = $('#teacherChildId').val();
    var schoolClassterm = $('#teacherClassterm').val();
    if(attendanceGroup != "" && schoolClassId != "" && schoolSessionId != "" && schoolChildId != "" && schoolClassterm != ""){
        $('#loader').show();
    }
});
$('#attendance_report').click(function() {
    var attendanceGroup = $('#teacherattendanceGroup').val();
    var class_Student = $('#class_id_students').val();
    var schoolSession = $('#teacheressionId').val();
    if(attendanceGroup != "" && class_Student != "" && schoolSession != ""){
        $('#loader').show();
    }
});
$('#class_report').click(function() {
    var attendanceGroup = $('#teacherattendanceGroup').val();
    var class_id = $('#class_id').val();
    var subject_id = $('#subject_id').val();
    var schoolSessionId = $('#schoolSessionId').val();
    if(attendanceGroup != "" && class_id != "" && subject_id != "" && schoolSessionId != ""){
        $('#loader').show();
    }
});
/*
# Parent module
*/
$('#mcgr_search').click(function() {
    var parentClassId = $('#parentClassId').val();
    var parentChildId = $('#parentChildId').val();
    var parentClassterm = $('#parentClassterm').val();
    if(parentClassId != "" && parentChildId != "" && parentClassterm != ""){
        $('#loader').show();
    }
});
$('#p_attendance_report').click(function() {
    var parent_students = $('#parent_students').val();
    var student_ids = $('#student_ids').val();
    if(parent_students != "" && student_ids != ""){
        $('#loader').show();
    }
});

if($('#auto-greeting').length){
    $('#auto-greeting').click(function(){
        var ON = false;
        var csrf = $('meta[name="csrf-token"]').attr('content');
        if($(this).prop("checked") == true ){
            ON = true;
        }
        $.ajax({
            type: 'POST',
            url: '/admin/autogreeting',
            dataType: "json",
            data: { greeting_status: ON, _token: csrf },
            success:function(res){

            },error:function(err){

            }
        });
    });

    var config = {
        type: 'pie',
        data: {
            datasets: [{
                data: [
                    maleCount,
                    femaleCount,
                    // undisclosed
                ],
                backgroundColor: [
                    '#FC8675',
                    '#6bafbd',
                    // '#f3ce85',
                ],
                label: 'Gender Distribution'
            }],
            labels: [
                'Male',
                'Female',
                // 'Undisclosed',
            ]
        },
        options: {
            responsive: true
        }
    };

    window.onload = function() {
        var ctx = document.getElementById('gender-chart').getContext('2d');
        window.myPie = new Chart(ctx, config);
    };
}

function validateForm(ele){
    var notes = $(ele).find('#notes').val();
    $('#notes').parent().find('.with-errors').text('')

    if($.trim(notes) == ''){
        $('#notes').parent().find('.with-errors').text('Please enter your plan.')
        return false;
    }
    return true;
}

function validateSendMailForm(form){
    $('#send-to-container').css('color', '');
    $('#send-to-container').find('.with-errors').text('');
    var checked = $(".send-to:checked").length;
    if(checked <= 0){
        $('#send-to-container').find('.with-errors').css('color', '#ed6f56 !important').text('This field is required');
        $('#send-to-container').css('color', '#ed6f56 !important');
        return false;
    }
    return true;
}

$('#sendto_all').on('click', function(){
    if($(this).is(":checked")){
        $('#sendto_Students').prop('checked', true);
        $('#sendto_Parents').prop('checked', true);
        $('#sendto_Teachers').prop('checked', true);
        $('#sendto_Admins').prop('checked', true);
        $('#sendto_subAdmins').prop('checked', true);
    }else{
        $('#sendto_Students').prop('checked', false);
        $('#sendto_Parents').prop('checked', false);
        $('#sendto_Teachers').prop('checked', false);
        $('#sendto_Admins').prop('checked', false);
        $('#sendto_subAdmins').prop('checked', false);
    }
});
$('.send-to').on('click', function(){
    if($(this).is(":checked")){
        var checked = $(".send-to:checked").length;
        if(checked == $(".send-to").length){
            $('#sendto_all').prop('checked', true);
        }
    }else{
        $('#sendto_all').prop('checked', false);
    }
});

function gradeType(term_id){
    if($('#assessmentGrades').length > 0){
        var token = $('meta[name="csrf-token"]').attr('content');
        if($('#teacherattendanceGroup').length > 0){
            var group_id = $('#teacherattendanceGroup').val();
        }else{
            var group_id = $('#attendanceGroup').val();
        }
        var session_id = $('select[name="session_id"]').find('option:selected').val();
        if(session_id != '' && term_id != '' && group_id != ''){
            $.ajax({
                type: 'POST',
                url: '/admin/session_grades',
                data: { _token: token, term_id: term_id, session_id: session_id, group_id: group_id},
                success: function (res) {
                    $("#assessmentGrades").empty();
                    $("#assessmentGrades").html(res.html);
                    $("#assessmentGrades").selectpicker('refresh');
                },
                error: function(err){

                }
            });

        }else{
            $("#assessmentGrades").empty();
            $("#assessmentGrades").html('<option value="">Select Grade Type</option>');
            $("#assessmentGrades").selectpicker('refresh');
        }
    }
}
$(document).on('change', '#attendanceGroup, #schoolSessionId',function(){
    if($('#assessmentGrades').length > 0){
        var term_id = $('#schoolClassterm').find('option:selected').val();
        gradeType(term_id);
    }


});


$(document).on('change', '#schoolClassterm, #teacherClassterm',function(){
    var term_id = $(this).val();

    //batch grade report; admin/gradebatchreport
    // if(term_id == 'all'){
    //     $('#batchca option[value="combine"]').prop("selected", true);
    //     $('#batchca').prop('disabled', true);
    // }else{
    //     $('#batchca').prop('disabled', false);
    //     if($('#assessmentGrades').length > 0){

    //         gradeType(term_id);

    //     }

    // }
    $("#batchca").selectpicker('refresh');


});

$(document).on('change', '#assessmentGrades',function(){
    var gradeType = $(this).find('option:selected').val();

    var marks = $(this).find('option:selected').attr('data-marks');
    if(marks == ''){
        if(gradeType == 'no'){
            $('#gradeTypeDiv').css('display', 'block');
            $('input[name="grade_type"]').attr('required', true);
            $('.overall-score').val('');
        }else{
            $('.overall-score').val('');
            $('#gradeTypeDiv').css('display', 'none');
            $('input[name="grade_type"]').removeAttr('required', true);


        }
    }else{
        $('.overall-score').val(marks);
        $('#gradeTypeDiv').css('display', 'none');
        $('input[name="grade_type"]').removeAttr('required', true);

    }
});

$(document).on('change', '#schoolselection',function(){
    var school_id = $(this).val();
    var token = $('meta[name="csrf-token"]').attr('content');
    if(school_id != ''){
        $.ajax({
            type: 'POST',
            url: '/superadmin/schoolSessions',
            data: { _token: token, school_id: school_id},
            success: function (res) {

                $("#sessionschool").empty();
                $("#sessionschool").html(res);
                $("#sessionschool").selectpicker('refresh');
                if($('#sessionterm').length > 0){
                    getSessionTerms();
                }
                if($('#schoolClasses').length > 0 || $('#mapClasses').length > 0 ){

                    getSchoolClasses();
                }
            },
            error: function(err){

            }
        });
    }else{

    }


});

$(document).on('change', '#sessionschool',function(){
    getSessionTerms();
});
$(document).on('change', '#mapClasses',function(){
    getClassTerms();
});

$(document).on('change', '.sessionTerm',function(){
    var key = $(this).attr('data-key');
    $('.copy_'+key).prop('checked',false);
});

$(document).on('click', '.copy_all',function(){
    if($(this).is(":checked")){
        var id = $(this).attr('data-id');
        var key = $(this).attr('data-key');
        if($('select[name="session_'+id+'"]').length > 0){
            var selectedvalue = $('select[name="session_'+id+'"]').val();
            $('.session_'+key).val(selectedvalue);
            $('.copy_'+key).prop('checked', true);
            $(".session_"+key).selectpicker('refresh');
        }else{
            var selectedvalue = $('select[name="grade_'+id+'"]').val();
            $('.grade_'+key).val(selectedvalue);
            $('.copy_'+key).prop('checked', true);
            $(".grade_"+key).selectpicker('refresh');
        }
    }else{


    }
});

$('#gradeAttendanceSessionId').change(function(){
    var session_id = $(this).val();
    var token = $('input[name="_token"]').val();
    if( session_id){
        $.ajax({
            type: 'POST',
            url: '/admin/sessiontermdata',
            async: false,
            dataType: "json",
            data: { session_id:session_id, _token: token },

            success:function(res){
                if(res){
                    if (res['termhtml']) {
                        $("#gradeAttedanceTerm").html(res['termhtml']);
                        $('#gradeAttedanceTerm').removeAttr("disabled");
                        $('#gradeAttedanceTerm').selectpicker('refresh');
                    }
                }
            }, error: function(err){

            }
        });
    }else{
        $("#gradeAttedanceTerm").html('<option value="">Select Term</option>');
        $('#gradeAttedanceTerm').attr("disabled");
        $('#gradeAttedanceTerm').selectpicker('refresh');
    }
});

// if grade attendace term change
$("#gradeAttedanceTerm, #gradeAttendanceSessionId").change(function() {
    let termId = $('#gradeAttedanceTerm').val();
    if (termId) {
        $.ajax({
            type: 'GET',
            url: '/admin/days_open',
            async: false,
            dataType: "json",
            data: { term_id: termId, _token: token },

            success:function(res){
                $('#times_school_opened').val(res);
            }, error: function(err){
                $('#times_school_opened').val('');
            }
        });
    }
});

function gradeAttendanceData(){
    var term_id = $('#gradeAttedanceTerm').val();
    var class_id = $('#gradeAttendanceClass').val();
    var session_id = $('#gradeAttendanceSessionId').val();
    var token = $('input[name="_token"]').val();
    var panel = 'admin';

    if($('.teacher-panel').length){
        panel = 'teacher';
    }

    if(class_id != '' && term_id != '' && session_id != ''){
        $.ajax({
            type: 'POST',
            url: '/'+panel+'/gradeAttendanceData',
            dataType: "json",
            data: { class_id: class_id, term_id:term_id,session_id:session_id, _token: token },

            success:function(res){
                if(res){
                    if (res['html']) {
                        $('#studentDetail').html(res['html']);
                        $('#attendanceStudent').show();
                    }
                }
            }
        });
    }
}

$(document).on('keyup', '.gradeAttendanceDays', function(event){
    if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
        event.preventDefault();
    }
    var input = $(this).val();
    if ((input.indexOf('.') != -1) && (input.substring(input.indexOf('.')).length > 2)) {
        event.preventDefault();
    }
    var totalOpen = parseInt($('#times_school_opened').val());
    var thisValue = $(this).val();
    totalOpen = Number.isInteger(totalOpen) ? totalOpen : 0 ;
    if( thisValue > totalOpen){
        $( this ).val(thisValue/10 | 0 );
        $( this ).parent().find('div.with-errors').html('Please enter the times Present less than no. of times school opened.');
        return false;
    }else{
        $(this).css('border', '1px solid rgba(33, 33, 33, 0.12)');
        $(this).css('color', '#212121');
        $( this ).parent().find('div.with-errors').html('');
    }

})

function validateStudentForm(ele){
    var validate = 0;

    if($(ele).find('#email').length > 0){
        var email = $(ele).find('#email').val();
    }else{
        var email =  $(ele).find("input[name=email]").val();
    }


    var phoneNumber = $(ele).find('#phoneNumber').val();

    $(ele).find('#email-form-group input').css('border', '1px solid rgba(33, 33, 33, 0.12)');
    $(ele).find('#email-form-group label').css('color', '#212121');
    $(ele).find('#email-form-group .with-errors-custom').html('');
    if($.trim(email) == '' && $.trim(phoneNumber)==''){
        $(ele).find('#email-form-group label').css('color', '#ed6f56');
        $(ele).find('#email-form-group input').css('border-color', 'rgba(237, 111, 86, 0.5)');
        $(ele).find('#email-form-group .with-errors-custom').html('Either Email or Phone Number is required.').scrollTop();
        $(window).scrollTop($('#email-form-group').offset().top-100);
        return false;
    }
    else{
        // return true;

        var token = $('input[name="_token"]').val();
        var id = '';
        if($('input[name="student_id"]').length > 0){
            var id = $('input[name="student_id"]').val();
        }


        $.ajax({
            type: 'POST',
            url: '/admin/validateEmail',
            // dataType: "json",
            data: { email: email, _token: token, _id: id },

            success:function(res){
                if(res){
                    if(res['count'] == 1) {
                        validate = 1;
                        $(ele).find('#email-form-group label').css('color', '#ed6f56');
                        $(ele).find('#email-form-group input').css('border-color', 'rgba(237, 111, 86, 0.5)');
                        $(ele).find('#email-form-group .with-errors-custom').html('Email already exist.').scrollTop();
                        $(window).scrollTop($('#email-form-group').offset().top-100);

                    }else{
                        $(ele).find('#email-form-group input').css('border', '1px solid rgba(33, 33, 33, 0.12)');
                        $(ele).find('#email-form-group label').css('color', '#212121');
                        $(ele).find('#email-form-group .with-errors-custom').html('');
                    }
                }
            }

        });
    }


    $('#allocatePlan .studentFeePlan').each(function(){
        var plan = $(this).val();
        if(plan != ''){
            var due_date = $(this).parent().parent().parent().parent().parent().parent().find('.due_date').val();
            var ele = $(this).parent().parent().parent().parent().parent().parent().find('.due_date');
            if(due_date == ''){
                validate = 1;

                $(ele).css('border-color', 'rgba(237, 111, 86, 0.5)');
                $(ele).parent().find(' .with-errors').html('This field is required');

                // return false;


            }else{
                $(ele).css('border', '1px solid rgba(33, 33, 33, 0.12)');
                $(ele).parent().find(' .with-errors').html('');

            }
        }

    });

    if(validate == 1){
        return false;
    }else{
        return true;
    }
}

$('#times_school_opened').keyup(function(){
    var outerEle = this;
    var value = parseInt($(this).val());
    if(value == ''){
        return;
    }
    validateAttendance();
});

$("#gradeAttendanceform").on("submit", function(e) {
    validateAttendance();

});
function validateAttendance(){
    var value = $('#times_school_opened').val();
    if(value == ''){
        return;
    }
    var status = 0;

    $('#studentDetail .gradeAttendanceDays').each(function(){
        var studentPresent = parseInt($(this).val());
        if(value < studentPresent){
            var status = 1;
            $(this).css('border-color', 'rgba(237, 111, 86, 0.5)');
            $(this).css('color', '#ed6f56');
            $(this).parent().find('.with-errors').html('Student attendance must be less than or equal to no of times school opened');
            $(window).scrollTop($(this).offset().top-100);
            event.preventDefault();
        }else{
            $(this).css('border', '1px solid rgba(33, 33, 33, 0.12)');
            $(this).css('color', '#212121');
            $(this).parent().find('.with-errors').html('');
        }
    });
    if(status == 0){
        return true;
        $('#gradeAttendanceform').submit();
    }else{
        return false;
    }
}
$(document).on('submit', '#reportSettingForm', function(event){
    var sum = 0
    var avg_ca_inputs = []
    // $( ".gradetotalMarks" ).each(function() {
    //     if($(this).val() !=''){
    //         sum+=parseInt($(this).val());
    //     }
    // });
    $(".gradetotalMarks").each(function() {
        if($(this).val() != ''){
            if($(this).data('average')) {
                var type = $(this).parent().parent().prev().find('.typeselect')
                if(type.val() == 'CA')
                    avg_ca_inputs.push($(this))
                else
                    sum+=parseFloat($(this).val());
            }
            else
                sum+=parseFloat($(this).val());
        }
    });
    if(avg_ca_inputs.length > 0 && $('#avg-ca-input').val().trim() !== '')
        sum += parseInt($('#avg-ca-input').val())

    if(sum > 100 || sum < 100){
        event.preventDefault();

        $('#marksError').show();
        $('#errmessage').text('Total Marks should be equal to  100');
        return false;

    } else{
        return true;
    }

});


$('form').on('focus', 'input[type=number]', function (e) {
    $(this).on('wheel.disableScroll', function (e) {
        e.preventDefault()
    })
})
$('form').on('blur', 'input[type=number]', function (e) {
    $(this).off('wheel.disableScroll')
});

$(document).ready(function(){

    $(document).on('click', '#table_data .pagination a, #student_table .pagination a', function(event){
        event.preventDefault();
        $(this).parent().find('.pagination li .page-item').removeClass('active');
        $('.pagination a').parent().parent().find('.page-item').removeClass('active');
        $('.pagination a').parent().parent().find('.page-item').removeAttr('aria-current');
        $(this).parent().addClass('active');
        $(this).parent().attr('aria-current','page');
        var page = $(this).attr('href').split('page=')[1];
        var url = '/admin/fetch_data';
        if($('#student_table').length){
            url = $(this).attr('href');
        }
        fetch_data(page, url);
    });

    function fetch_data(page, url)
    {
        var data = {};
        if($('#schoolgradelist').length){
            data = $('#schoolgradelist').serialize()+'&page_num='+page;
        }
        if($('#studentlist').length){
            data = $('#studentlist').serialize()+'&page_num='+page;
        }

        $('#loader-2').show();
        $.ajax({
            url: url,
            type: 'POST',
            headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            data: data,
            success: function (data) {
                $('#loader-2').hide();
                if($('#student_table').length){
                    $('#student_table').html(data);
                }
                if($('#table_data').length){
                    $('#table_data').html(data);
                }
            },
            error: function (data) {
                $('#loader-2').hide();
            }
        });

    }

    // show grade determinant onload
    let term_overall_average_is_checked = $('#term_overall_average_check').is(':checked');
    term_overall_average_is_checked == true ? $('#grade_determinant_block').show() : $('#grade_determinant_block').hide();
});

$(document).on('click', '#table_data .sub_chk', function(e){
    var prevSelectedGrades = $('#selectedGrades').val();
    if($(this).prop("checked") == true ){
        if(prevSelectedGrades == ''){
            $('#selectedGrades').val($(this).attr('data-id'));
        }else{
            $('#selectedGrades').val(prevSelectedGrades+','+$(this).attr('data-id'));
        }
    }else{
        var res = prevSelectedGrades.split(",");
        var removeItem = $(this).attr('data-id');
        res = jQuery.grep(res, function(value) {
            return value != removeItem;
        });
        var join_selected_values = res.join(",");
        $('#selectedGrades').val(join_selected_values);
    }
});

$(document).on('click', '#table_data .maincheckbox', function(e){
    var prevSelectedGrades = $('#selectedGrades').val();

    if($(this).prop("checked") == true ){

        $( ".sub_chk" ).each(function() {
            $(this).prop('checked', true);
            var res = prevSelectedGrades.split(",");
            var removeItem = $(this).attr('data-id');

            if(jQuery.inArray(removeItem, res)) {
                if($('#selectedGrades').val() != ''){
                    $('#selectedGrades').val($('#selectedGrades').val()+','+removeItem);

                }else{
                    $('#selectedGrades').val(removeItem);

                }

            } else {


            }

        });
    }else{


        var res = prevSelectedGrades.split(",");
        $( ".sub_chk" ).each(function() {
            $(this).removeAttr('checked');

            var removeItem = $(this).attr('data-id');

            res = jQuery.grep(res, function(value) {
                return value != removeItem;
            });
        });
        var join_selected_values = res.join(",");

        $('#selectedGrades').val(join_selected_values);
    }



});

$(document).on('click', '#student_table .sub_chk', function(e){
    var prevSelectedGrades = $('#selected_student').val();
    if($(this).prop("checked") == true ){
        if(prevSelectedGrades == ''){
            $('#selected_student').val($(this).attr('data-id'));
        }else{
            $('#selected_student').val(prevSelectedGrades+','+$(this).attr('data-id'));
        }
    }else{
        var res = prevSelectedGrades.split(",");
        var removeItem = $(this).attr('data-id');
        res = jQuery.grep(res, function(value) {
            return value != removeItem;
        });
        var join_selected_values = res.join(",");
        $('#selected_student').val(join_selected_values);
    }
});

$(document).on('click', '#student_table .maincheckbox', function(e){
    var prevSelectedGrades = $('#selected_student').val();
    if($(this).prop("checked") == true ){
        $( ".sub_chk" ).each(function() {
            $(this).prop('checked', true);
            var res = prevSelectedGrades.split(",");
            var removeItem = $(this).attr('data-id');
            if(jQuery.inArray(removeItem, res)) {
                if($('#selected_student').val() != ''){
                    $('#selected_student').val($('#selected_student').val()+','+removeItem);
                }else{
                    $('#selected_student').val(removeItem);
                }
            }
        });
    }else{
        var res = prevSelectedGrades.split(",");
        $( ".sub_chk" ).each(function() {
            $(this).removeAttr('checked');
            var removeItem = $(this).attr('data-id');
            res = jQuery.grep(res, function(value) {
                return value != removeItem;
            });
        });
        var join_selected_values = res.join(",");
        $('#selected_student').val(join_selected_values);
    }
});

$(document).on('click', '#parent_table .sub_chk', function(e){
    var prevSelectedGrades = $('#selected_parents').val();
    if($(this).prop("checked") == true ){
        if(prevSelectedGrades == ''){
            $('#selected_parents').val($(this).attr('data-id'));
        }else{
            $('#selected_parents').val(prevSelectedGrades+','+$(this).attr('data-id'));
        }
    }else{
        var res = prevSelectedGrades.split(",");
        var removeItem = $(this).attr('data-id');
        res = jQuery.grep(res, function(value) {
            return value != removeItem;
        });
        var join_selected_values = res.join(",");
        $('#selected_parents').val(join_selected_values);
    }
});


$(document).on('click', '#parent_table .maincheckbox', function(e){
    var prevSelectedGrades = $('#selected_parents').val();
    if($(this).prop("checked") == true ){
        $( ".sub_chk" ).each(function() {
            $(this).prop('checked', true);
            var res = prevSelectedGrades.split(",");
            var removeItem = $(this).attr('data-id');
            if(jQuery.inArray(removeItem, res)) {
                if($('#selected_parents').val() != ''){
                    $('#selected_parents').val($('#selected_parents').val()+','+removeItem);
                }else{
                    $('#selected_parents').val(removeItem);
                }
            }
        });
    }else{
        var res = prevSelectedGrades.split(",");
        $( ".sub_chk" ).each(function() {
            $(this).removeAttr('checked');
            var removeItem = $(this).attr('data-id');
            res = jQuery.grep(res, function(value) {
                return value != removeItem;
            });
        });
        var join_selected_values = res.join(",");
        $('#selected_parents').val(join_selected_values);
    }
});

$(document).on('click', '#teacher_table .sub_chk', function(e){
    var prevSelectedGrades = $('#selected_teachers').val();
    if($(this).prop("checked") == true ){
        if(prevSelectedGrades == ''){
            $('#selected_teachers').val($(this).attr('data-id'));
        }else{
            $('#selected_teachers').val(prevSelectedGrades+','+$(this).attr('data-id'));
        }
    }else{
        var res = prevSelectedGrades.split(",");
        var removeItem = $(this).attr('data-id');
        res = jQuery.grep(res, function(value) {
            return value != removeItem;
        });
        var join_selected_values = res.join(",");
        $('#selected_teachers').val(join_selected_values);
    }
});
$(document).on('click', '#teacher_table .maincheckbox', function(e){
    var prevSelectedGrades = $('#selected_teachers').val();
    if($(this).prop("checked") == true ){
        $( ".sub_chk" ).each(function() {
            $(this).prop('checked', true);
            var res = prevSelectedGrades.split(",");
            var removeItem = $(this).attr('data-id');
            if(jQuery.inArray(removeItem, res)) {
                if($('#selected_teachers').val() != ''){
                    $('#selected_teachers').val($('#selected_teachers').val()+','+removeItem);
                }else{
                    $('#selected_teachers').val(removeItem);
                }
            }
        });
    }else{
        var res = prevSelectedGrades.split(",");
        $( ".sub_chk" ).each(function() {
            $(this).removeAttr('checked');
            var removeItem = $(this).attr('data-id');
            res = jQuery.grep(res, function(value) {
                return value != removeItem;
            });
        });
        var join_selected_values = res.join(",");
        $('#selected_teachers').val(join_selected_values);
    }
});


$(document).on('change', '#class_id', function(e){

    var class_id = $(this).val();
    if($('#teacherattendanceGroup').length > 0){
        var group_id = $('#teacherattendanceGroup').val();
        var type = 2;
    }else{
        var group_id = $('#attendanceGroup').val();
        var type = 1;

    }

    var panel = 'admin';
    if($('#teacherClassId').length){
        panel = 'teacher';
    }
    $.ajax({
        url: '/'+panel+'/getClassArm',
        type: 'POST',
        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
        data: { class_id: class_id, group_id:group_id, type: type},
        success: function (data) {

            if(data['count'] >= 1){
                if(data['classTeacher'] != 0){
                    $('.arm_option').show();
                }

            }else{
                $('.arm_option').hide();

            }
            if(data['classTeacher'] == 0){
                $('.arm_option').hide();
                $("input[name=arm_option][value='2']").prop("checked",true);

            }
            $('input[name="class_arm_id"]').val(data['class_arm_id']);

        },
        error: function (data) {

        }
    });



});



function displayLoader(ele){
    var group = $(ele).find('#attendanceGroup').val();
    var class_ = $(ele).find('#schoolClassId').val();
    var session = $(ele).find('#schoolSessionId').val();
    var term = $(ele).find('#schoolClassterm').val();
    if(!(group == '' || class_ == '' || session == '' || term == '')){
        $(".reportloader").show();
    }
}

// $('.notification_all').on('click', function(e) {
//     e.preventDefault();



// });

$('.student_enabled_all, .parent_enabled_all, .teacher_enabled_all, .notification_all').on('click', function(e) {
    e.preventDefault();
    var url =  $(this).attr('data-url');
    var type =  $(this).attr('data-type');
    var msg = $(this).attr('data-msg');
    if(typeof(msg) == 'undefined'){
        msg = 'delete';
    }
    var allVals = [];
    $(".sub_chk:checked").each(function() {
        allVals.push($(this).attr('data-id'));
    });

    if(allVals.length <=0)
    {
        swal({
            title: "",
            text: 'Please select '+type,
            type: "info",    });
    }  else {
        swal({
                title: "Are you sure?",
                text: "Are you sure you want to "+msg+" selected "+type+"s?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#F36820",
                confirmButtonText: "Yes, "+msg+"!",
                closeOnConfirm: false,
                closeOnCancel: false,
                showLoaderOnConfirm: true
            },
            function(isConfirm){
                if (isConfirm) {
                    if(type == 'student'){
                        var join_selected_values = $('#selected_student').val();
                    }else if(type == 'parent'){
                        var join_selected_values = $('#selected_parents').val();


                    }else if(type == 'teacher'){
                        var join_selected_values = $('#selected_teachers').val();


                    }else{
                        var join_selected_values = allVals.join(",");
                    }
                    $('#loader-2').show();
                    $.ajax({
                        url: url,
                        type: 'POST',
                        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                        data: 'ids='+join_selected_values,
                        success: function (data) {
                            $('#loader-2').hide();
                            if (data['success']) {
                                if(msg == 'publish' || msg == 'unpublish'){
                                    msg = msg+'e';
                                }
                                swal({
                                    title: "",
                                    text:'Selected rows '+msg+'d Successfully',
                                    type: "success",    });
                            } else if (data['error']) {
                                swal({
                                    html: true,
                                    title: "",
                                    text: data['error'],
                                    type: "info",    });
                            } else {
                                swal({
                                    title: "",
                                    text: 'Whoops Something went wrong!!',
                                    type: "info",    });
                            }
                        },
                        complete: function(){
                            redirection(type);
                        },
                        error: function (data) {
                        }
                    });
                } else {
                    swal("Cancelled", "Your data is safe :)", "error");
                    redirection(type);
                }

            });
        return false;

    }
});

$(document).on('click', '.reset', function(e){
    var ele = $(this);
    var type = $(this).attr('data-type');
    var id = $(this).attr('data-id');
    var token = $('meta[name=csrf-token]').attr('content');



    $.ajax({
        type: 'POST',
        url: '/admin/resetattendance',
        dataType: "json",
        data: { type: type, id: id, _token: token },

        success:function(res){

            if(res['status'] == 200){
                if(type == 'in'){
                    $('.checkinTime-'+id).show();
                    $('.checkoutTime-'+id).attr('disabled', true);
                    $('.checkoutTime-'+id).show();
                    $('#outTime-'+id).html('');
                    $('.inhidden-'+id).val('');
                    $('.outhidden-'+id).val('');
                    $('.reset-'+id).hide();


                    $('#inTime-'+id).html('');
                    ele.hide();
                }
                if(type == 'out'){
                    $('.checkoutTime-'+id).show();
                    $('#outTime-'+id).html('');
                    $('.outhidden-'+id).val('');


                    ele.hide();

                }

            }


        },error:function(err){
            // console.log(JSON.stringify(err));
        }

    });


});

$(document).on('change', '#reportType', function(e){
    var group_id = '';
    var report_type = $(this).val();
    var school_id = $('input[name="school_id"]').val();
    if($('#teacherattendanceGroup').length > 0){
        var group_id = $('#teacherattendanceGroup').val();
        var type = 2;

    }else{
        var group_id = $('#attendanceGroup').val();
        var type = 1;


    }

    var panel = 'admin';
    if($('#teacherattendanceGroup').length){
        panel = 'teacher';
    }

    var token = $('meta[name="csrf-token"]').attr('content');
    if(report_type == 1){
        $('#class_id').html('<option value="">Select Class</option>');
        $.ajax({
            url: '/'+panel+'/getClassArm',
            type: 'POST',
            headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            data: { school_id: school_id,report_type: report_type,group_id:group_id,type:type},
            success: function (data) {
                if(data['count'] >= 1){
                    if(data['armHtml']){
                        if($('#class_arm_id').length){
                            $('.classarm-div').show();
                            $('#class_arm_id').html(data['armHtml']);
                        }
                        if($('#student_class_arm_id').length > 0){
                            $('#student_class_arm_id').html(data['armHtml']);

                        }
                    }
                    $('.selectpicker').selectpicker('refresh');
                    $('button[type="submit"]').removeAttr('disabled',true);

                }else{
                    $('#class_arm_id').html('<option value="no">Select Class Arm</option>');
                    $('button[type="submit"]').attr('disabled',true);

                    $('.reportType-errors').text(data['schoolName']+' has not define class arm, please use individual class to generate report or manage class arm to define arm');

                }

            },
            error: function (data) {

            }
        });
    }else{
        $('#class_arm_id').html('<option value="no">Select Class Arm</option>');
        $('#student_class_arm_id').html('<option value="no">Select Class Arm</option>');

        var session_id = $('#schoolSessionId').val();
        if(group_id){
            if(type == 1){
                var url = '/admin/classByGroupId';
            }else{
                var url = '/teacher/classByGroupId';

            }
            $.ajax({
                type: 'POST',
                url:    url,
                data: { group_id: group_id, session_id: session_id,  _token: token,type:type },
                success:function(res){
                    if(res['html']){
                        if($('#gradeClassId').length > 0){
                            $("#gradeClassId").empty();
                            $("#gradeClassId").append(res['html']);
                            $("#gradeClassId").prop('disabled', false);
                        }else if($('#teacherClassId').length > 0){
                            $("#teacherClassId").empty();
                            $("#teacherClassId").append(res['html']);
                            $("#teacherClassId").prop('disabled', false);
                        } else if($('#gradeskillClassId').length > 0){
                            $("#gradeskillClassId").empty();
                            $("#gradeskillClassId").append(res['html']);
                            $("#gradeskillClassId").prop('disabled', false);
                        }else{
                            if($('#class_Student').length > 0){
                                $("#class_Student").empty();
                                $("#class_Student").append(res['html']);
                            }
                            if($('#class_id').length > 0){
                                $("#class_id").empty();
                                $("#class_id").append(res['html']);
                                $("#class_id").prop('disabled', false);
                            }
                            if($('#schoolClassId').length > 0){

                                $("#schoolClassId").empty();
                                $("#schoolClassId").append(res['html']);
                            }
                        }
                    }else{
                        $("#class_Student").empty();
                        $("#class_id").empty();
                        $("#schoolClassId").empty();
                    }
                    if(res['format'] == 'nursery'){
                        $('.caType').hide();
                        if($('.report-Type').length == 0){
                            $("#schoolClassterm option[value='all']").remove();

                        }

                    }else{
                        $('.caType').show();
                        if($('.arm_option').length == 0 && $('#planClassId').length == 0  ){
                            if($("#schoolClassterm option[value='all']").length == 0){
                                $('#schoolClassterm').append(new Option('Session Report', 'all'));
                            }
                        }
                    }
                    $('.selectpicker').selectpicker('refresh');

                }
            });
        }
        $('button[type="submit"]').removeAttr('disabled',true);

        $('#class_arm_id').html('');
        $('.reportType-errors').text('');

    }
    $('.selectpicker').selectpicker('refresh');

});








$(document).on('click', '.grade_question_clear', function(){
    var elements = $(this).closest('tr').find('td');
    $(elements).each(function( e, ele){
        $(ele).find('input[type="radio"]').prop('checked', false);
    });
})

var index = 0;
var getLastPartOfUrl =function($url) {
    var url = $url;
    var urlsplit = url.split("/");
    var lastpart = urlsplit[urlsplit.length-1];
    if(lastpart==='')
    {
        lastpart = urlsplit[urlsplit.length-2];
    }
    return lastpart;
}
function downloadAll(files){
    if(files.length == 0) return;
    file = files.pop();

    var theAnchor = $('<a />')
        .attr('href', file[1])
        .attr('download',file[0])

        .appendTo('body');

    theAnchor[0].click();
    theAnchor.remove();
    downloadAll(files);
}
$(document).on('click', '.download-doc-individual', function(){
    var files = $(this).attr('files');
    var this_ = this;
    files = files.split(",");


    $(files).each(function(key, val){
        g_arr=[];

        g_arr.push(getLastPartOfUrl(val));
        g_arr.push(val);

        a_arr=[];
        a_arr.push(g_arr);
        downloadAll(a_arr);
    });

});

$(document).on('click', '#online-gateway-check', function() {
    var checkedLength = $('#online-gateway-check:checked').length;
    if(checkedLength == 1){
        $('div.online-gateway').show();
    }else{
        $('div.online-gateway').hide();

    }

});
$(document).on('click', '#offline-gateway-check', function() {
    var checkedLength = $('#offline-gateway-check:checked').length;
    if(checkedLength == 1){
        $('div.offline-gateway').show();
    }else{
        $('div.offline-gateway').hide();

    }

});

$(document).on('submit', '#addSchoolForm, #editSchoolForm', function(e) {


    var offline_currency = '';
    var online_currency = '';
    var online_check_length = $('#online-gateway-check:checked').length;
    var offline_check_length = $('#offline-gateway-check:checked').length;
    if(online_check_length > 0){



        var online_gateway = $("select[name='online_gateway_id']").find('option:selected').val();

        if(online_gateway == ''){
            e.preventDefault();
            $('#loader').hide();
            $("select[name='online_gateway_id']").css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Please select payment gateway');
        }else{
            $("select[name='online_gateway_id']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
            var online_currency = $("select[name='online_currency']").find('option:selected').val();
            if(online_currency == ''){
                e.preventDefault();
                $('#loader').hide();


                $("select[name='online_currency']").css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Please select currency');

            }else{

                var commission_type =  $("select[name='online_gateway_id']").find('option:selected').attr('data-commission_type');
                var total = 0;
                if(commission_type == 'percentage'){
                    var gateway = $('input[name="online_commission_gateway"]').val();
                    if(gateway != ''){
                        total+=parseFloat(gateway);
                    }
                    var school = $('input[name="online_commission_school"]').val();
                    if(school != ''){
                        total+=parseFloat(school);
                    }
                    var thirdparty = $('input[name="online_commission_thirdparty"]').val();
                    if(school != ''){
                        total+=parseFloat(school);
                    }
                }

                if(total > 100){
                    e.preventDefault();
                    $('#loader').hide();
                    $('input[name="online_commission_gateway"]').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                    $('input[name="online_commission_school"]').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                    $('input[name="online_commission_thirdparty"]').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                }else{
                    $('input[name="online_commission_gateway"]').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().parent().find('div.with-errors').html('');
                    $('input[name="online_commission_school"]').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().parent().find('div.with-errors').html('');
                    $('input[name="online_commission_thirdparty"]').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().parent().find('div.with-errors').html('');
                }

                $("select[name='online_currency']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
            }
        }

    }
    if(offline_check_length > 0){
        var offline_gateway = $("select[name='offline_gateway_id']").find('option:selected').val();
        if(offline_gateway == '' ){
            e.preventDefault();
            $('#loader').hide();


            $("select[name='offline_gateway_id']").css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Please select payment gateway');
        }else{
            $("select[name='offline_gateway_id']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
            var offline_currency = $("select[name='offline_currency']").find('option:selected').val();
            if(offline_currency == ''){
                e.preventDefault();
                $('#loader').hide();


                $("select[name='offline_currency']").css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Please select currency');

            }else{
                var commission_type =  $("select[name='offline_gateway_id']").find('option:selected').attr('data-commission_type');
                var total = 0;
                if(commission_type == 'percentage'){
                    var gateway = $('input[name="offline_commission_gateway"]').val();
                    if(gateway != ''){
                        total+=parseFloat(gateway);
                    }
                    var school = $('input[name="offline_commission_school"]').val();
                    if(school != ''){
                        total+=parseFloat(school);
                    }
                    var thirdparty = $('input[name="offline_commission_thirdparty"]').val();
                    if(school != ''){
                        total+=parseFloat(school);
                    }
                }
                if(total > 100){
                    e.preventDefault();
                    $('#loader').hide();
                    $('input[name="offline_commission_gateway"]').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                    $('input[name="offline_commission_school"]').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                    $('input[name="offline_commission_thirdparty"]').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                }else{
                    $('input[name="offline_commission_gateway"]').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
                    $('input[name="offline_commission_school"]').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
                    $('input[name="offline_commission_thirdparty"]').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
                }


                $("select[name='offline_currency']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');

            }

        }

    }
    if(online_check_length > 0 && offline_check_length > 0){
        if ($("select[name='online_currency']").length > 0){
            var online_currency = $("select[name='online_currency']").find('option:selected').attr('data-currencyid');

        }
        if ($("select[name='offline_currency']").length > 0){
            var offline_currency = $("select[name='offline_currency']").find('option:selected').attr('data-currencyid');
        }

        if(online_currency != offline_currency){
            $('#loader').hide();
            e.preventDefault();


            $("select[name='online_currency']").css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Online and offline currency should be same');
            $("select[name='offline_currency']").css('border-color', 'rgba(237, 111, 86, 0.5)').parent().find('div.with-errors').html('Online and offline currency should be same');
        }else{

            $("select[name='offline_currency']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
            $("select[name='online_currency']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');

        }

    }else{
        $("select[name='offline_currency']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
        $("select[name='online_currency']").css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
    }


});

$(document).on('change', '.commission_type', function(e) {
    var type = $(this).val();
    if(type == 'percentage'){
        $('div.input-group-addon').show();
    }else{
        $('div.input-group-addon').hide();

    }

});


$(document).on('submit', '#updateGateway', function(e) {
    var commission_type = $('.commission_type').val();
    if ($("input[class='commission_type'][value='percentage']").prop("checked")){

        var validate = 0;
        $(".currency-row").each(function() {
            total = 0;
            var gateway = $(this).find('.gatewayComm').val();
            var school = $(this).find('.schoolComm').val();
            var thirdparty = $(this).find('.thirdComm').val();
            if(gateway != ''){
                total+=parseFloat(gateway);
            }
            if(school != ''){
                total+=parseFloat(school);
            }
            if(thirdparty != ''){
                total+=parseFloat(thirdparty);
            }

            if(total > 100){
                validate+=1;
                $( this ).find('.gatewayComm').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                $( this ).find('.schoolComm').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');
                $( this ).find('.schoolComm').css('border-color', 'rgba(237, 111, 86, 0.5)').parent().parent().find('div.with-errors').html('Total of commission should be less than or equal to 100.');

            }else{
                $( this ).find('.gatewayComm').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().parent().find('div.with-errors').html('');
                $( this ).find('.schoolComm').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().parent().find('div.with-errors').html('');
                $( this ).find('.schoolComm').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().parent().find('div.with-errors').html('');

            }

        });

        if(validate > 0){
            e.preventDefault();
            return false;
        }else{
            return true;
        }
    }else{
        $(".currency-row").each(function() {
            $( this ).find('.gatewayComm').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
            $( this ).find('.schoolComm').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
            $( this ).find('.schoolComm').css('border', '1px solid rgba(33, 33, 33, 0.12)').parent().find('div.with-errors').html('');
        });
    }

});


$(document).on('change', 'select.gateway', function() {
    var type = $(this).attr('data-type');
    var token = $('meta[name=csrf-token]').attr('content');
    var gateway_id = $(this).val();
    var school_id = '';
    var thisele = $(this).parent().parent().parent().parent().parent().parent();

    if($('input[name=school_id]').length > 0){
        var school_id = $('input[name=school_id]').val();

    }
    if(gateway_id != '' ){
        $.ajax({
            type: 'POST',
            url: '/superadmin/getCurrencies',
            dataType: "json",
            data: { gateway_id: gateway_id, school_id: school_id, _token: token, type:type },

            success:function(res){

                if(res['html']){
                    var html = res['html'];
                    thisele.find('select.currency').html(html);

                }
                if(res['currencyHtml']){
                    thisele.find('div.currency-detail').html(res['currencyHtml']);
                    thisele.find('div.currency-detail').show();
                }

            }

        });
    }else{
        thisele.find('select.currency').html('<option value="">Select Currency</option>');
        thisele.find('div.currency-detail').hide();
    }
});
$(document).on('change', 'select.currency', function() {
    var type = $(this).attr('data-type');
    var token = $('meta[name=csrf-token]').attr('content');
    var currency_id = $(this).val();
    var thisele = $(this).parent().parent().parent();

    if(currency_id != '' ){
        $.ajax({
            type: 'POST',
            url: '/superadmin/getCurrencyDetail',
            dataType: "json",
            data: { currency_id: currency_id, _token: token },

            success:function(res){
                if(res['html']){
                    var html = res['html'];
                    thisele.find('div.currency-detail').html(html);
                    thisele.find('div.currency-detail').show();

                }else{
                    thisele.find('div.currency-detail').hide();

                }

            }

        });
    }
});
